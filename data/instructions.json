{"html": "<style>\n  .inst-hero { text-align: center; margin-bottom: var(--space-8); padding: var(--space-8) 0 var(--space-4); }\n  .inst-hero h1 { font-size: 28px; font-weight: 800; letter-spacing: -0.02em; margin: 0; }\n  .inst-hero p { font-size: var(--text-sm); color: var(--muted); margin-top: var(--space-2); }\n  .inst-card {\n    background: var(--card-bg); border: 1px solid var(--border); border-radius: var(--radius-lg);\n    padding: var(--space-5) var(--space-6); margin-bottom: var(--space-4);\n    transition: border-color var(--duration-fast) var(--ease-default);\n  }\n  .inst-card:hover { border-color: var(--border-strong); }\n  .inst-card.inst-accent {\n    border-color: var(--apple-indigo);\n    background: linear-gradient(135deg, var(--card-bg) 0%, rgba(88,86,214,0.05) 100%);\n  }\n  .inst-card.inst-creative {\n    border-color: var(--apple-pink);\n    background: linear-gradient(135deg, var(--card-bg) 0%, rgba(255,55,95,0.04) 100%);\n  }\n  .inst-card.inst-status {\n    border-color: var(--apple-green);\n    background: linear-gradient(135deg, var(--card-bg) 0%, rgba(52,199,89,0.04) 100%);\n  }\n  .inst-card h2 { font-size: 16px; font-weight: 700; margin: 0 0 var(--space-3); letter-spacing: -0.01em; }\n  .inst-card h3 { font-size: 13px; font-weight: 600; margin: var(--space-4) 0 var(--space-2); color: var(--fg); }\n  .inst-card p, .inst-card li { font-size: var(--text-sm); color: var(--fg-secondary); line-height: var(--leading-relaxed); }\n  .inst-card ul { list-style: none; padding: 0; margin: var(--space-2) 0; }\n  .inst-card li { padding: var(--space-1) 0 var(--space-1) var(--space-4); position: relative; }\n  .inst-card li::before { content: \"\\2014\"; position: absolute; left: 0; color: var(--muted); }\n  .inst-card table { width: 100%; border-collapse: collapse; font-size: var(--text-xs); margin: var(--space-2) 0; }\n  .inst-card th, .inst-card td { padding: 6px 10px; text-align: left; border-bottom: 1px solid var(--border); }\n  .inst-card th { font-weight: 600; color: var(--fg); font-size: 11px; text-transform: uppercase; letter-spacing: 0.04em; }\n  .inst-card code { font-family: var(--font-mono); font-size: 0.88em; color: var(--apple-blue); }\n  .inst-card td.done { color: var(--apple-green); font-weight: 600; }\n  .inst-grid { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-4); }\n  @media (max-width: 900px) { .inst-grid { grid-template-columns: 1fr; } }\n  .inst-pill {\n    display: inline-block; font-size: 10px; font-weight: 600; text-transform: uppercase;\n    letter-spacing: 0.05em; padding: 2px 8px; border-radius: var(--radius-full);\n    margin-bottom: var(--space-2);\n  }\n  .inst-pill-indigo { color: var(--apple-indigo); background: color-mix(in srgb, var(--apple-indigo) 12%, transparent); }\n  .inst-pill-pink { color: var(--apple-pink); background: color-mix(in srgb, var(--apple-pink) 12%, transparent); }\n  .inst-pill-green { color: var(--apple-green); background: color-mix(in srgb, var(--apple-green) 12%, transparent); }\n  .inst-pill-blue { color: var(--apple-blue); background: color-mix(in srgb, var(--apple-blue) 12%, transparent); }\n  .inst-pill-orange { color: var(--apple-orange); background: color-mix(in srgb, var(--apple-orange) 12%, transparent); }\n  .inst-pill-teal { color: var(--apple-teal); background: color-mix(in srgb, var(--apple-teal) 12%, transparent); }\n  .app-trio { display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-3); margin: var(--space-3) 0; }\n  .app-box { background: var(--hover-overlay); border-radius: var(--radius-md); padding: var(--space-3) var(--space-4); }\n  .app-box strong { display: block; font-size: 14px; margin-bottom: 4px; }\n  .app-box p { font-size: 12px; margin: 0; color: var(--muted); line-height: 1.5; }\n  @media (max-width: 700px) { .app-trio { grid-template-columns: 1fr; } }\n</style>\n\n<div class=\"inst-hero\">\n  <h1>System Instructions</h1>\n  <p>Everything needed to work on MADphotos effectively. Updated 2026-02-07.</p>\n</div>\n\n<!-- \u2550\u2550\u2550 PROJECT BRIEFING \u2550\u2550\u2550 -->\n<div class=\"inst-card inst-accent\">\n  <span class=\"inst-pill inst-pill-indigo\">Briefing</span>\n  <h2>MADphotos</h2>\n  <p>A solo art project by <strong>LAEH</strong>. 9,011 unedited photographs shot over a decade with five cameras, turned into the most richly-understood image collection ever built. Every image gets every possible signal. Then camera-aware enhancement.</p>\n\n  <div class=\"app-trio\">\n    <div class=\"app-box\">\n      <strong>Show</strong>\n      <p>Blow people&rsquo;s minds. Continuously release new experiences guided by signals and new ideas. Delightful, playful, elegant, smart, teasing, revealing, exciting &mdash; on every screen.</p>\n    </div>\n    <div class=\"app-box\">\n      <strong>State</strong>\n      <p>The dashboard. The control room. Every signal, every model, every image &mdash; tracked, measured, monitored.</p>\n    </div>\n    <div class=\"app-box\">\n      <strong>See</strong>\n      <p>The native power image viewer and editor. MADCurator &mdash; 55 fields, 21 filters with union/intersection modes, inline label editing (9 Gemini fields + vibes), full-resolution display. The human eye decides what&rsquo;s worth showing.</p>\n    </div>\n  </div>\n</div>\n\n<!-- \u2550\u2550\u2550 CREATIVE DIRECTION \u2550\u2550\u2550 -->\n<div class=\"inst-card inst-creative\">\n  <span class=\"inst-pill inst-pill-pink\">Creative Direction</span>\n  <h2>Show Is an Art Experience</h2>\n  <p>Not just a gallery. Not a tech demo. Every experience must be designed by someone who is simultaneously the best developer, architect, ML engineer, exigent Apple-level minimalist designer, and deeply creative, emotionally intelligent curator.</p>\n  <ul>\n    <li><strong>Signal-aware storytelling.</strong> Two laughing faces side by side IS funny. A rose-themed image next to rose-accent colors IS pretty. Two grumpy people together IS a statement. Signals create emotional moments &mdash; surprise, beauty, humor, mystery, melancholy.</li>\n    <li><strong>Minimalist UI, maximally expressive content.</strong> Dark, sparse, no chrome. Let the images talk. Fewer images shown beautifully beats more images shown generically.</li>\n    <li><strong>Every experience should feel designed by someone who LOVES photography.</strong> An experience that makes you want to look at every single image.</li>\n  </ul>\n</div>\n\n<!-- \u2550\u2550\u2550 STATUS \u2550\u2550\u2550 -->\n<div class=\"inst-card inst-status\">\n  <span class=\"inst-pill inst-pill-green\">Status</span>\n  <h2>What&rsquo;s Done vs. What&rsquo;s Next</h2>\n  <p><strong>Done (17/20):</strong> Rendering (97,898 tiers). EXIF. Pixel Analysis. Dominant Colors. Image Hashes. Vectors (DINOv2+SigLIP+CLIP). Aesthetic Scoring. Depth Estimation. Scene Classification. Style Classification. BLIP Captions. Facial Emotions. Enhancement Plans (v1+v2). <strong>Gemini 2.5 Pro analysis (9,011/9,011 &mdash; 100%).</strong> OCR / Text Detection (16,704 detections). &mdash; Dashboard + Journal. MADCurator. 14 web experiences. GCS upload (135,518 files: 72k original + 63k enhanced). Gallery export with GCS public URLs.</p>\n  <p><strong>Sparse signals (complete but partial by nature):</strong> Face Detections (1,676 images). Object Detections (5,363 images). OCR is also sparse &mdash; not every photo contains text.</p>\n  <p><strong>In progress:</strong> Curate in MADCurator (accept/reject + inline editing of 9 Gemini fields + vibe add/remove now live).</p>\n  <p><strong>Next:</strong> Imagen AI variants at scale. Location intelligence from EXIF GPS. Deploy Show to Firebase.</p>\n</div>\n\n<!-- \u2550\u2550\u2550 CAMERAS + ARCHITECTURE \u2550\u2550\u2550 -->\n<div class=\"inst-grid\">\n\n<div class=\"inst-card\">\n  <span class=\"inst-pill inst-pill-orange\">Hardware</span>\n  <h2>Five Cameras</h2>\n  <table>\n    <thead><tr><th>Camera</th><th>Count</th><th>Rule</th></tr></thead>\n    <tbody>\n      <tr><td>Leica M8</td><td>3,533</td><td>CCD warmth is character. Correct WB only 50%.</td></tr>\n      <tr><td>DJI Osmo Pro</td><td>3,032</td><td>1,459 have GPS. Best auto WB.</td></tr>\n      <tr><td>Leica MP</td><td>1,126</td><td>Portra 400 VC. Film grain is sacred &mdash; never denoise.</td></tr>\n      <tr><td>Leica Monochrom</td><td>1,099</td><td><strong>NEVER color-correct.</strong> Pure luminance sensor.</td></tr>\n      <tr><td>G12 / Memo</td><td>221</td><td>Worst WB. Most aggressive correction (70%).</td></tr>\n    </tbody>\n  </table>\n</div>\n\n<div class=\"inst-card\">\n  <span class=\"inst-pill inst-pill-blue\">Architecture</span>\n  <h2>19 Python Scripts (backend/)</h2>\n  <table>\n    <thead><tr><th>Script</th><th>Purpose</th></tr></thead>\n    <tbody>\n      <tr><td><code>pipeline.py</code></td><td>Phase orchestrator</td></tr>\n      <tr><td><code>completions.py</code></td><td>Master orchestrator &mdash; checks all 20 stages, fixes gaps, updates State</td></tr>\n      <tr><td><code>render.py</code></td><td>6-tier resolution pyramid</td></tr>\n      <tr><td><code>gemini.py</code></td><td>Gemini 2.5 Pro structured analysis</td></tr>\n      <tr><td><code>imagen.py</code></td><td>4 AI variants via Imagen 3</td></tr>\n      <tr><td><code>upload.py</code></td><td>Upload to GCS</td></tr>\n      <tr><td><code>database.py</code></td><td>SQLite schema (24 tables)</td></tr>\n      <tr><td><code>enhance.py</code></td><td>Camera-aware 6-step enhancement</td></tr>\n      <tr><td><code>signals_advanced.py</code></td><td>11 ML models</td></tr>\n      <tr><td><code>dashboard.py</code></td><td>Dashboard + Journal</td></tr>\n      <tr><td><code>export_gallery.py</code></td><td>Gallery data export to JSON</td></tr>\n      <tr><td><code>serve_show.py</code></td><td>Local dev server</td></tr>\n      <tr><td><code>signals.py</code></td><td>EXIF, colors, faces, objects, hashes</td></tr>\n      <tr><td><code>pixel_analysis.py</code></td><td>Pixel-level analysis for enhancement</td></tr>\n      <tr><td><code>vectors.py</code></td><td>DINOv2/SigLIP/CLIP embeddings</td></tr>\n      <tr><td><code>mosaics.py</code></td><td>4096px mosaic generator</td></tr>\n      <tr><td><code>enhance_v2.py</code></td><td>Signal-aware enhancement v2</td></tr>\n      <tr><td><code>render_enhanced.py</code></td><td>Enhanced image tier rendering</td></tr>\n      <tr><td><code>prep_blind_test.py</code></td><td>A/B blind test preparation</td></tr>\n    </tbody>\n  </table>\n</div>\n\n</div>\n\n<!-- \u2550\u2550\u2550 TECHNICAL RULES \u2550\u2550\u2550 -->\n<div class=\"inst-card\">\n  <span class=\"inst-pill inst-pill-teal\">Rules</span>\n  <h2>Critical Technical Rules</h2>\n  <div class=\"inst-grid\" style=\"gap:var(--space-2);\">\n    <ul>\n      <li><strong>Python 3.9.6</strong> &mdash; <code>from __future__ import annotations</code>, <code>Optional[X]</code> not <code>X | None</code></li>\n      <li><strong>Vertex AI + ADC only</strong> &mdash; NEVER API keys</li>\n      <li><strong>Flat layout</strong> &mdash; <code>images/rendered/{tier}/{format}/{uuid}.ext</code>. Never <code>rendered/originals/</code> (plural)</li>\n      <li><strong>DNG color</strong> &mdash; <code>sips -m sRGB Profile.icc</code> to avoid P3 purple cast</li>\n      <li><strong>UUID5</strong> &mdash; DNS namespace, deterministic from relative path</li>\n    </ul>\n    <ul>\n      <li><strong>Tiers</strong>: full (3840), display (2048), mobile (1280), thumb (480), micro (64), gemini (2048)</li>\n      <li><strong>GCS</strong> &mdash; <code>v/{version}/{tier}/{format}/{uuid}.ext</code></li>\n      <li><strong>google-genai 1.47</strong> &mdash; <code>edit_image()</code> needs <code>vertexai=True</code></li>\n      <li><strong>JPEGmini Pro</strong> &mdash; GUI app, serving tiers only (display/mobile/thumb/micro)</li>\n      <li><strong>Monochrome</strong> &mdash; zero saturation, zero color correction, ever</li>\n    </ul>\n  </div>\n</div>\n\n<!-- \u2550\u2550\u2550 HOSTING \u2550\u2550\u2550 -->\n<div class=\"inst-grid\">\n\n<div class=\"inst-card\">\n  <span class=\"inst-pill inst-pill-blue\">Infrastructure</span>\n  <h2>GCS Image Hosting Strategy</h2>\n  <ul>\n    <li><strong>GCP Project:</strong> madbox-e4a35 &mdash; account: laeh@madbits.ai</li>\n    <li><strong>Bucket:</strong> <code>gs://myproject-public-assets/art/MADphotos/</code></li>\n    <li><strong>URL pattern:</strong> <code>https://storage.googleapis.com/myproject-public-assets/art/MADphotos/v/{version}/{tier}/{format}/{uuid}.ext</code></li>\n  </ul>\n  <h3>Versioned Directory Structure</h3>\n  <table>\n    <thead><tr><th>Version</th><th>Content</th><th>Tiers Uploaded</th></tr></thead>\n    <tbody>\n      <tr><td><code>original</code></td><td>Unmodified rendered tiers</td><td>display, mobile, thumb, micro &times; jpeg + webp</td></tr>\n      <tr><td><code>enhanced</code></td><td>Camera-aware enhanced</td><td>display, mobile, thumb, micro &times; jpeg + webp</td></tr>\n      <tr><td><code>blind</code></td><td>Blind test comparison images</td><td>display/jpeg only</td></tr>\n    </tbody>\n  </table>\n  <h3>Deployment Map</h3>\n  <table>\n    <thead><tr><th>App</th><th>Platform</th><th>URL</th></tr></thead>\n    <tbody>\n      <tr><td><strong>State</strong></td><td>GitHub Pages</td><td>laeh.github.io/MADphotos/</td></tr>\n      <tr><td><strong>Show</strong></td><td>Firebase Hosting</td><td>madphotos-efbfb.web.app</td></tr>\n      <tr><td><strong>Images</strong></td><td>GCS public bucket</td><td>storage.googleapis.com/myproject-public-assets/...</td></tr>\n    </tbody>\n  </table>\n  <ul>\n    <li><strong>Show does NOT host images.</strong> All image URLs point to GCS. Firebase only serves HTML/CSS/JS + data JSONs.</li>\n    <li><strong>upload.py</strong> uploads serving tiers only. Full/gemini tiers stay local (AI pipeline input).</li>\n    <li><strong>Upload command:</strong> <code>python3 backend/upload.py --version original</code> (or enhanced, blind)</li>\n  </ul>\n</div>\n\n<div class=\"inst-card\">\n  <h2>Web Gallery (Show) &mdash; 14 Experiences</h2>\n  <ul>\n    <li><code>backend/export_gallery.py</code> &rarr; 5 JSON files (photos, faces, game_rounds, stream_sequence, drift_neighbors)</li>\n    <li><code>backend/serve_show.py</code> &rarr; localhost:3000</li>\n    <li>18 files: index.html, style.css, app.js + 14 experience modules + data/</li>\n    <li>La Grille, Le Bento, La Similarit&eacute;, La D&eacute;rive, Les Couleurs, Le Jeu, Chambre Noire, Le Flot, Les Visages, La Boussole, L&rsquo;Observatoire, La Carte, Machine &Agrave; &Eacute;crire, Le Pendule</li>\n    <li>Dark minimalist design system: 40+ CSS tokens (motion grammar, emotion colors, depth layers, category colors), Apple HIG curves, prefers-reduced-motion support</li>\n    <li>Vanilla JS, no framework. 60fps animations via rAF, IntersectionObserver lazy loading, timer leak prevention</li>\n  </ul>\n</div>\n\n</div>\n\n<!-- \u2550\u2550\u2550 SIGNAL INVENTORY \u2550\u2550\u2550 -->\n<div class=\"inst-card\">\n  <span class=\"inst-pill inst-pill-teal\">Signals</span>\n  <h2>Signal Inventory &mdash; 18 Signals per Image</h2>\n  <table>\n    <thead><tr><th>Signal</th><th>Source</th><th>Status</th><th>Key Fields</th></tr></thead>\n    <tbody>\n      <tr><td>EXIF</td><td>Pillow</td><td class=\"done\">9,011 &check;</td><td>Camera, lens, focal, aperture, shutter, ISO, GPS</td></tr>\n      <tr><td>Pixel Analysis</td><td>NumPy/OpenCV</td><td class=\"done\">9,011 &check;</td><td>Brightness, saturation, contrast, noise, WB shifts</td></tr>\n      <tr><td>Dominant Colors</td><td>K-means (LAB)</td><td class=\"done\">9,011 &check;</td><td>5 clusters: hex, RGB, LAB, percentage</td></tr>\n      <tr><td>Faces</td><td>YuNet</td><td class=\"done\">1,676 images &check;</td><td>3,187 faces: boxes, landmarks, confidence, area %</td></tr>\n      <tr><td>Objects</td><td>YOLOv8n</td><td class=\"done\">5,363 images &check;</td><td>14,534 detections, 80 COCO classes</td></tr>\n      <tr><td>Hashes</td><td>imagehash</td><td class=\"done\">9,011 &check;</td><td>pHash, aHash, dHash, wHash, blur, sharpness</td></tr>\n      <tr><td>Vectors</td><td>DINOv2+SigLIP+CLIP</td><td class=\"done\">9,011 &check;</td><td>768d+768d+512d = 2,048 dims (LanceDB)</td></tr>\n      <tr><td>Gemini</td><td>Gemini 2.5 Pro</td><td class=\"done\">9,011 &check;</td><td>Alt, vibes, exposure, composition, grading, edit prompt</td></tr>\n      <tr><td>Aesthetic</td><td>LAION (CLIP MLP)</td><td class=\"done\">9,011 &check;</td><td>Score 1&ndash;10</td></tr>\n      <tr><td>Depth</td><td>Depth Anything v2</td><td class=\"done\">9,011 &check;</td><td>Near/mid/far %, complexity bucket</td></tr>\n      <tr><td>Scenes</td><td>Places365</td><td class=\"done\">9,011 &check;</td><td>Top 3 labels, indoor/outdoor</td></tr>\n      <tr><td>Style</td><td>Derived</td><td class=\"done\">9,011 &check;</td><td>street, portrait, landscape, macro, etc.</td></tr>\n      <tr><td>OCR</td><td>EasyOCR</td><td class=\"done\">16,704 detections &check;</td><td>Text regions, language, confidence (sparse &mdash; not all images have text)</td></tr>\n      <tr><td>Captions</td><td>BLIP (Salesforce)</td><td class=\"done\">9,011 &check;</td><td>Natural language description</td></tr>\n      <tr><td>Emotions</td><td>ViT expression</td><td class=\"done\">1,676 &check;</td><td>7-class scores per face (3,185 emotion entries)</td></tr>\n      <tr><td>Enhancement</td><td>Camera engine</td><td class=\"done\">9,011 &check;</td><td>WB, gamma, shadows, contrast, saturation, sharpening</td></tr>\n      <tr><td>Enhancement v2</td><td>Camera engine v2</td><td class=\"done\">9,011 &check;</td><td>Updated parameters</td></tr>\n      <tr><td>AI Variants</td><td>Imagen 3</td><td>216/9,011</td><td>gemini_edit, pro_edit, nano_feel, cartoon</td></tr>\n    </tbody>\n  </table>\n</div>\n\n<!-- \u2550\u2550\u2550 INCREMENTAL INGESTION \u2550\u2550\u2550 -->\n<div class=\"inst-card\">\n  <span class=\"inst-pill inst-pill-orange\">Pipeline</span>\n  <h2>New Image Ingestion</h2>\n  <p>User will add more images over time. <strong>Every script MUST handle incremental ingestion.</strong> Full process for new images:</p>\n  <p style=\"font-family:var(--font-mono);font-size:12px;color:var(--muted);line-height:1.8;\">\n    register &rarr; render tiers &rarr; pixel analysis &rarr; Gemini analysis &rarr; signal extraction &rarr; vector embeddings &rarr; enhancement &rarr; export gallery data &rarr; curation\n  </p>\n  <ul>\n    <li>All scripts check for existing results and skip processed images</li>\n    <li>Processing can be interrupted and resumed at any point</li>\n    <li>After ingestion, re-run <code>backend/export_gallery.py</code> to update web data</li>\n    <li>Consistency: same parameters, same models, same quality for all images</li>\n  </ul>\n</div>\n\n<!-- \u2550\u2550\u2550 JOURNAL \u2550\u2550\u2550 -->\n<div class=\"inst-card\">\n  <h2>Journal de Bord</h2>\n  <p>File: <code>docs/journal.md</code>. Write after EVERY significant action. Format: <code>### HH:MM &mdash; Title</code> under <code>## YYYY-MM-DD</code> headers. Include intent, what happened, what was learned. Rendered as timeline with auto-classified event type labels.</p>\n</div>"}