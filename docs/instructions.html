<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MADphotos Dashboard</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%23111'/></svg>">
<style>
  :root {
    --font-sans: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", system-ui, sans-serif;
    --font-display: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", system-ui, sans-serif;
    --font-mono: "SF Mono", ui-monospace, "Cascadia Code", monospace;
    --text-xs: 11px; --text-sm: 13px; --text-base: 15px; --text-lg: 17px;
    --text-xl: 20px; --text-2xl: 22px; --text-3xl: 28px;
    --space-1: 4px; --space-2: 8px; --space-3: 12px; --space-4: 16px;
    --space-5: 20px; --space-6: 24px; --space-8: 32px; --space-10: 40px;
    --radius-sm: 6px; --radius-md: 10px; --radius-lg: 14px;
    --sidebar-w: 220px;
    --apple-blue: #007AFF; --apple-green: #34C759;
    --leading-normal: 1.47; --leading-relaxed: 1.6;
    --tracking-tight: -0.01em; --tracking-caps: 0.06em;
    --duration-fast: 150ms; --ease-default: cubic-bezier(0.25, 0.1, 0.25, 1);
  }
  [data-theme="light"] {
    --bg: #F5F5F7; --bg-secondary: #FFFFFF; --fg: #1D1D1F;
    --fg-secondary: #3A3A3C; --muted: #86868B;
    --border: rgba(0,0,0,0.08); --border-strong: rgba(0,0,0,0.14);
    --card-bg: #FFFFFF; --sidebar-bg: #FFFFFF;
    --sidebar-active-bg: rgba(0,0,0,0.04); --hover-overlay: rgba(0,0,0,0.03);
    color-scheme: light;
  }
  [data-theme="dark"] {
    --bg: #1C1C1E; --bg-secondary: #2C2C2E; --fg: #F5F5F7;
    --fg-secondary: #D1D1D6; --muted: #98989D;
    --border: rgba(255,255,255,0.08); --border-strong: rgba(255,255,255,0.14);
    --card-bg: #2C2C2E; --sidebar-bg: #2C2C2E;
    --sidebar-active-bg: rgba(255,255,255,0.06); --hover-overlay: rgba(255,255,255,0.04);
    color-scheme: dark;
  }
  html { scroll-behavior: smooth; }
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: var(--font-sans); font-size: var(--text-base);
    line-height: var(--leading-normal); background: var(--bg); color: var(--fg);
    display: flex; min-height: 100vh;
    -webkit-font-smoothing: antialiased;
  }
  .sidebar {
    width: var(--sidebar-w); min-width: var(--sidebar-w);
    background: var(--sidebar-bg); border-right: 1px solid var(--border);
    padding: var(--space-5) 0; position: sticky; top: 0; height: 100vh;
    overflow-y: auto; display: flex; flex-direction: column;
    transition: width var(--duration-normal) var(--ease-default),
                min-width var(--duration-normal) var(--ease-default);
  }
  .sidebar .sb-title {
    font-family: var(--font-display); font-size: var(--text-lg); font-weight: 700;
    letter-spacing: var(--tracking-tight); padding: 0 var(--space-5) var(--space-4);
    border-bottom: 1px solid var(--border); margin-bottom: var(--space-2);
  }
  .sidebar a {
    display: flex; align-items: center; gap: var(--space-2);
    padding: var(--space-2) var(--space-5); color: var(--muted);
    text-decoration: none; font-size: var(--text-sm);
    transition: background var(--duration-fast) var(--ease-default),
                color var(--duration-fast) var(--ease-default);
  }
  .sidebar a:hover { background: var(--sidebar-active-bg); color: var(--fg); }
  .sidebar a.active {
    color: var(--fg); font-weight: 600; background: var(--sidebar-active-bg);
    border-left: 3px solid var(--apple-blue);
    padding-left: calc(var(--space-5) - 3px);
  }
  .sidebar .sb-sep { height: 1px; background: var(--border); margin: var(--space-2) var(--space-5); }
  .sidebar .sb-group {
    font-size: var(--text-xs); font-weight: 600; text-transform: uppercase;
    letter-spacing: var(--tracking-caps); color: var(--muted);
    padding: var(--space-3) var(--space-5) var(--space-1);
  }
  .sidebar .sb-bottom {
    margin-top: auto; padding: var(--space-3) var(--space-5);
    border-top: 1px solid var(--border);
  }
  .theme-toggle {
    display: flex; align-items: center; gap: var(--space-2);
    font-size: var(--text-sm); color: var(--muted); cursor: pointer;
    padding: var(--space-2) 0; background: none; border: none;
    font-family: inherit; width: 100%;
    transition: color var(--duration-fast);
  }
  .theme-toggle:hover { color: var(--fg); }
  .theme-toggle .theme-icon { font-size: 16px; }
  .sb-collapse {
    display: flex; align-items: center; gap: var(--space-2);
    font-size: var(--text-sm); color: var(--muted); cursor: pointer;
    padding: var(--space-2) 0; background: none; border: none;
    font-family: inherit; width: 100%; transition: color var(--duration-fast);
    margin-bottom: var(--space-2); white-space: nowrap; overflow: hidden;
  }
  .sb-collapse:hover { color: var(--fg); }
  .sb-expand {
    display: none; position: fixed; top: var(--space-4); left: var(--space-4);
    z-index: 50; width: 36px; height: 36px; border-radius: var(--radius-sm);
    border: 1px solid var(--border); background: var(--card-bg);
    cursor: pointer; color: var(--muted); box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    align-items: center; justify-content: center; font-size: 18px;
    transition: color var(--duration-fast), box-shadow var(--duration-fast);
  }
  .sb-expand:hover { color: var(--fg); box-shadow: 0 4px 16px rgba(0,0,0,0.15); }
  body.sb-collapsed .sidebar { width: 0; min-width: 0; overflow: hidden; padding: 0; border-right: none; }
  body.sb-collapsed .sb-expand { display: flex; }
  .sb-hamburger {
    display: none; align-items: center; justify-content: center;
    width: 36px; height: 36px; background: none; border: none;
    cursor: pointer; color: var(--fg); font-size: 20px;
    border-radius: var(--radius-sm); flex-shrink: 0;
  }
  .main-content {
    flex: 1; padding: var(--space-10) var(--space-8);
    max-width: 900px; min-width: 0; margin: 0 auto;
  }
  @media (max-width: 900px) {
    body { flex-direction: column; }
    body.sb-collapsed .sidebar {
      width: 100%; min-width: unset; overflow: visible; padding: var(--space-2) var(--space-3);
      border-right: none; border-bottom: 1px solid var(--border);
    }
    body.sb-collapsed .sb-expand { display: none; }
    .sb-collapse { display: none !important; }
    .sidebar { width: 100%; min-width: unset; height: auto; position: sticky; top: 0;
               z-index: 100; border-right: none; border-bottom: 1px solid var(--border);
               flex-direction: row; flex-wrap: wrap; padding: var(--space-2) var(--space-3);
               backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
               background: color-mix(in srgb, var(--sidebar-bg) 85%, transparent); }
    .sidebar .sb-title { width: auto; border-bottom: none; padding: 0 var(--space-2) 0 0; margin-bottom: 0; font-size: var(--text-base); }
    .sb-hamburger { display: flex; margin-left: auto; }
    .sidebar > a, .sidebar .sb-group, .sidebar .sb-sep, .sidebar .sb-bottom { display: none; }
    .sidebar.open > a { display: flex; width: 100%; }
    .sidebar.open .sb-sep { display: block; width: 100%; }
    .sidebar.open .sb-bottom { display: block; width: 100%; }
    .main-content { padding: var(--space-6); }
  }
  h1 { font-family: var(--font-display); font-size: var(--text-3xl); font-weight: 700;
       letter-spacing: var(--tracking-tight); margin-bottom: var(--space-2); }
  h2 { font-family: var(--font-display); font-size: var(--text-xl); font-weight: 700;
       margin: var(--space-8) 0 var(--space-3); color: var(--fg);
       border-bottom: 1px solid var(--border); padding-bottom: var(--space-2); }
  h3 { font-size: var(--text-lg); font-weight: 600; margin: var(--space-6) 0 var(--space-2); color: var(--fg); }
  h4 { font-size: var(--text-base); font-weight: 600; margin: var(--space-4) 0 var(--space-2); color: var(--muted); }
  p { font-size: var(--text-sm); margin: var(--space-2) 0; line-height: var(--leading-relaxed); }
  ul { font-size: var(--text-sm); margin: var(--space-2) 0 var(--space-2) var(--space-5); }
  li { margin: var(--space-1) 0; }
  table { width: 100%; border-collapse: collapse; font-size: var(--text-sm); margin: var(--space-3) 0 var(--space-4); }
  th { text-align: left; font-size: var(--text-xs); font-weight: 600; text-transform: uppercase;
       letter-spacing: var(--tracking-caps); color: var(--muted);
       border-bottom: 1px solid var(--border-strong); padding: var(--space-2) var(--space-3); }
  td { padding: var(--space-2) var(--space-3); border-bottom: 1px solid var(--border); }
  code { background: var(--hover-overlay); padding: 2px var(--space-2); font-size: var(--text-sm);
         font-family: var(--font-mono); border-radius: var(--radius-sm); }
  strong { font-weight: 700; }
  a { color: var(--fg); }
  blockquote { font-size: var(--text-sm); color: var(--muted); border-left: 3px solid var(--border);
               padding-left: var(--space-4); margin: var(--space-2) 0; font-style: normal; }
  footer { margin-top: var(--space-10); padding-top: var(--space-4);
           border-top: 1px solid var(--border); font-size: var(--text-xs); color: var(--muted); }
  footer a { color: var(--muted); text-decoration: none; }
  
</style>
</head>
<body>
<button class="sb-expand" onclick="toggleSidebar()" title="Show sidebar">&#9776;</button>
<nav class="sidebar" id="sidebar">
  <div class="sb-title">MADphotos</div>
  <button class="sb-hamburger" onclick="document.getElementById('sidebar').classList.toggle('open')" aria-label="Menu">&#9776;</button>
  <a href="index.html">README</a>
  <a href="state.html">State</a>
  <a href="journal.html">Journal de Bord</a>
  <a href="instructions.html" class="active">System Instructions</a>
  <div class="sb-sep"></div>
  <div class="sb-group">Experiments</div>
  <a href="drift.html">Drift</a>
  <a href="blind-test.html">Blind Test</a>
  <a href="mosaics.html">Mosaics</a>
  <div class="sb-bottom">
    <button class="sb-collapse" onclick="toggleSidebar()">&#x276E; Hide sidebar</button>
    <button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">
      <span class="theme-icon" id="themeIcon">&#9790;</span>
      <span id="themeLabel">Dark Mode</span>
    </button>
  </div>
</nav>
<div class="main-content">
<h1>System Instructions</h1>
<p style="font-size:var(--text-sm);color:var(--muted);margin-bottom:var(--space-6);">
  Everything an AI assistant needs to know to work on this project effectively.
</p>

<div style="background: linear-gradient(135deg, var(--card-bg) 0%, rgba(88,86,214,0.06) 100%);
            border: 1px solid var(--apple-indigo); border-radius: var(--radius-lg);
            padding: var(--space-6); margin-bottom: var(--space-8);">

<h2 style="margin-top:0;">Project Briefing</h2>
<p>This is <strong>MADphotos</strong> &mdash; a solo art project by <strong>LAEH</strong> to take 9,011 unedited photographs
shot over a decade with five cameras and turn them into the most richly-understood image collection ever built.
Every image gets every possible signal (AI analysis, pixel metrics, vector embeddings, depth, scenes, objects, faces, emotions, captions, OCR, colors, hashes, aesthetic scores). Then camera-aware enhancement. Then human curation. Then a public gallery that only shows the accepted best.</p>

<h3>The Three Apps</h3>
<ul>
  <li><strong>See</strong> (MADCurator) &mdash; Native SwiftUI macOS app. The private power tool. 55 data fields per image, 18 filter dimensions, faceted search with boolean logic, Keep/Reject workflow. The human decides what&rsquo;s worth showing.</li>
  <li><strong>Show</strong> &mdash; Public web gallery. 14 experiences: La Grille (filter grid), Le Bento (algorithmic mosaic), La Similarit&eacute; (semantic neighbors), La D&eacute;rive (structural drift), Les Couleurs (color space), Le Terrain de Jeu (connection game), Le Flot (curated stream), La Chambre Noire (signal layers), Les Visages (face exploration), La Boussole (4-axis compass), L&rsquo;Observatoire (data panels), La Carte (GPS map), La Machine &agrave; &Eacute;crire (text search), Le Pendule (taste test).</li>
  <li><strong>State</strong> &mdash; This dashboard. Live system monitoring, Journal de Bord, signal inventory. The control room.</li>
</ul>

<h3>The Five Cameras</h3>
<table>
  <thead><tr><th>Camera</th><th>Type</th><th>Count</th><th>Key Characteristics</th></tr></thead>
  <tbody>
    <tr><td>Leica M8</td><td>Digital CCD</td><td>3,533</td><td>Known IR sensitivity &mdash; adds magenta to dark fabrics. Some warmth is CCD character, preserve it.</td></tr>
    <tr><td>DJI Osmo Pro</td><td>Action camera</td><td>3,032</td><td>Wide lens, helmet-mounted. 1,459 have GPS. Best auto WB of the set.</td></tr>
    <tr><td>Leica MP</td><td>Analog (Portra 400 VC)</td><td>1,126</td><td>Film grain (noise=4.3) is real silver halide &mdash; preserve, don&rsquo;t denoise. Warm shifts are film character.</td></tr>
    <tr><td>Leica Monochrom</td><td>B&amp;W sensor</td><td>1,099</td><td><strong>NEVER color-correct.</strong> No Bayer filter = pure luminance. Only tone curves. Zero saturation always.</td></tr>
    <tr><td>Canon G12 / DJI Memo</td><td>Compact</td><td>221</td><td>Worst auto WB (+0.167 red shift). Gets most aggressive correction (70%).</td></tr>
  </tbody>
</table>

<h3>Architecture: 9 Python Scripts</h3>
<table>
  <thead><tr><th>Script</th><th>Purpose</th><th>Key Detail</th></tr></thead>
  <tbody>
    <tr><td><code>mad_pipeline.py</code></td><td>Orchestrator</td><td>Runs phases in order. Entry point for full pipeline.</td></tr>
    <tr><td><code>render_pipeline.py</code></td><td>6-tier resolution pyramid</td><td>Output: <code>rendered/{tier}/{format}/{uuid}.ext</code>. FLAT layout, no category subdirs.</td></tr>
    <tr><td><code>photography_engine.py</code></td><td>Gemini 2.5 Pro analysis</td><td>Structured JSON: vibes, exposure, composition, grading, edit prompt. Uses Vertex AI + ADC.</td></tr>
    <tr><td><code>imagen_engine.py</code></td><td>4 AI variants via Imagen 3</td><td>Two-stage: edits from original (gemini_edit, pro_edit), styles from gemini_edit (nano_feel, cartoon).</td></tr>
    <tr><td><code>gcs_sync.py</code></td><td>Upload to GCS</td><td>Versioned: <code>v/{version}/{tier}/{format}/</code>. Supports original, enhanced, future variants.</td></tr>
    <tr><td><code>mad_database.py</code></td><td>SQLite schema</td><td>23 tables, single source of truth. Deterministic UUID5 from DNS namespace + relative path.</td></tr>
    <tr><td><code>enhance_engine.py</code></td><td>Camera-aware enhancement</td><td>6 steps: WB, exposure, shadow/highlight, contrast, saturation, sharpening. Per-camera profiles.</td></tr>
    <tr><td><code>advanced_signals.py</code></td><td>11 ML models</td><td>Depth, scenes, style, aesthetic, faces, objects, colors, hashes, OCR, captions, emotions.</td></tr>
    <tr><td><code>generate_status_page.py</code></td><td>Dashboard + Journal</td><td>This file. ~4,000 lines. Live server (<code>--serve</code>) + static generator.</td></tr>
  </tbody>
</table>

<h3>Critical Technical Rules</h3>
<ul>
  <li><strong>Python 3.9.6</strong> &mdash; Must use <code>from __future__ import annotations</code> and <code>Optional[X]</code>, NOT <code>X | None</code>.</li>
  <li><strong>Vertex AI only</strong> &mdash; Both Gemini and Imagen use Application Default Credentials (ADC). NEVER use API keys (one was committed and had to be scrubbed from git history).</li>
  <li><strong>Flat rendered layout</strong> &mdash; <code>rendered/{tier}/{format}/{uuid}.ext</code>. NEVER create <code>rendered/originals/</code> (plural) &mdash; this bug caused hours of cleanup.</li>
  <li><strong>DNG color space</strong> &mdash; <code>sips</code> must convert with <code>-m sRGB Profile.icc</code> to avoid Display P3 purple cast on DNG/RAW files.</li>
  <li><strong>GCS bucket structure</strong> &mdash; <code>v/{version}/{tier}/{format}/{uuid}.ext</code>. Public root: <code>https://storage.googleapis.com/myproject-public-assets/art/MADphotos/v/</code></li>
  <li><strong>UUID namespace</strong> &mdash; DNS (6ba7b810-...), deterministic from relative path to <code>originals/</code>.</li>
  <li><strong>google-genai 1.47.0</strong> &mdash; <code>edit_image()</code> requires <code>vertexai=True</code> client.</li>
  <li><strong>Tiers</strong>: full (3840px), display (2048px), mobile (1280px), thumb (480px), micro (64px), gemini (2048px). Formats: JPEG always, WebP for display/mobile/thumb/micro.</li>
  <li><strong>JPEGmini Pro</strong> &mdash; User runs it manually (GUI app) on serving tiers ONLY (display, mobile, thumb, micro). NOT on full/gemini/original.</li>
</ul>

<h3>Hard-Won Lessons</h3>
<ul>
  <li><strong>Monochrome sensor is sacred.</strong> The Leica Monochrom has no Bayer filter. Zero saturation, zero color correction, ever. Only tone curves (brightness, contrast, shadow/highlight).</li>
  <li><strong>Film grain is an asset.</strong> Portra 400 VC has noise=4.3 (3&times; digital). That&rsquo;s real silver halide texture. Preserve it &mdash; never denoise film.</li>
  <li><strong>CCD warmth is character.</strong> The Leica M8&rsquo;s CCD gives warm tones. Correct WB only 50% &mdash; too aggressive kills the look.</li>
  <li><strong>Enhanced v1 &cong; v2.</strong> Signal-aware v2 enhancement adds negligible perceptual difference (mean pixel diff 0.50). V1 is the primary enhanced version.</li>
  <li><strong>TensorFlow + PyTorch don&rsquo;t mix.</strong> Installing TF for DeepFace caused C++ mutex crashes in all PyTorch models. Solution: ViT emotion classifier on pure PyTorch.</li>
  <li><strong>LAION aesthetic scores are useless.</strong> 91% of 9,011 images scored &ldquo;excellent&rdquo; (8.22&ndash;10.0). Needs recalibration or a different model.</li>
  <li><strong>EasyOCR is CPU-bound and slow.</strong> 0.2 img/s single-threaded. Use <code>--shard N/M</code> for parallel workers (3&times; throughput).</li>
  <li><strong>SQLite contention.</strong> Multiple writers need <code>PRAGMA busy_timeout=120000</code> and retry loops with exponential backoff.</li>
  <li><strong>Vibe field is JSON array.</strong> In SwiftUI, parse with <code>JSONSerialization</code>, NOT comma-split. Otherwise you get bracket artifacts.</li>
  <li><strong>gsutil rsync &ne; cp.</strong> The <code>-j</code> flag (content compression) works with <code>cp</code> but NOT with <code>rsync</code>.</li>
</ul>

<h3>GCS Bucket &amp; Hosting</h3>
<ul>
  <li><strong>Project</strong>: madbox-e4a35, account: laeh@madbits.ai</li>
  <li><strong>Bucket</strong>: <code>gs://myproject-public-assets/art/MADphotos/</code></li>
  <li><strong>Versions uploaded</strong>: <code>original</code> (all serving tiers), <code>enhanced</code> (all serving tiers), <code>blind</code> (test images)</li>
  <li><strong>Serving tiers on GCS</strong>: display, mobile, thumb, micro &times; JPEG + WebP = 8 directories per version</li>
  <li><strong>Public URL pattern</strong>: <code>https://storage.googleapis.com/myproject-public-assets/art/MADphotos/v/{version}/{tier}/{format}/{uuid}.ext</code></li>
  <li><strong>GitHub Pages</strong>: <code>docs/</code> folder, auto-deploy via GitHub Actions</li>
</ul>

<h3>MADCurator (SwiftUI App)</h3>
<ul>
  <li>Located at <code>MADCurator/</code> in the project root. Uses Swift Package Manager (<code>Package.swift</code>).</li>
  <li>SQLite3 C API directly (no ORM). Reads from <code>mad_photos.db</code>.</li>
  <li>55 data fields per PhotoItem, loaded via 9-table JOIN query.</li>
  <li>18 filter dimensions: camera, category, vibe, grading, time, setting, composition, exposure, rotation, color, location, style, aesthetic, hasText, plus custom search.</li>
  <li>Keyboard shortcuts: K (keep), R (reject), &larr;/&rarr; (navigate), E (toggle enhanced), Space (fullscreen), I (info panel), Y/N (accept/reject location).</li>
  <li>Thumbnail cache: NSCache with 2,000 image limit.</li>
  <li>Build: <code>cd MADCurator && swift build</code></li>
</ul>

<h3>Web Gallery (Show)</h3>
<ul>
  <li><code>export_gallery_data.py</code> &rarr; <code>web/data/photos.json</code></li>
  <li><code>serve_gallery.py</code> &rarr; <code>http://localhost:3000</code></li>
  <li>16 web files: index.html, style.css, app.js + 13 experience modules (grid, similarity, drift, colors, bento, game, stream, darkroom, faces, compass, observatory, map, typewriter, pendulum)</li>
  <li>Dark (#0a0a0a), monospace, glassmorphism. No framework &mdash; vanilla HTML/CSS/JS.</li>
  <li>Progressive loading: micro &rarr; thumb &rarr; display. Lazy via IntersectionObserver.</li>
</ul>

<h3>Journal de Bord</h3>
<ul>
  <li>File: <code>docs/journal.md</code>. Write to it after EVERY significant action. Not optional.</li>
  <li>Format: <code>### HH:MM &mdash; Title *(&ldquo;user quote&rdquo;)*</code> with <code>**Intent.**</code> paragraphs, <code>&gt; blockquote</code> actions, <code>**Discovered.**</code> insights.</li>
  <li>Group entries under <code>## YYYY-MM-DD</code> date headers.</li>
  <li>The <code>/journal</code> page renders it as a timeline with auto-classified event type labels (Pipeline, AI, UI/UX, Deploy, etc.).</li>
</ul>

<h3>What&rsquo;s Done vs. What&rsquo;s Next</h3>
<p><strong>Done:</strong> Full pipeline built and running. 16/16 signals extracted for all 9,011 images. Enhancement v1 complete. GCS hosting live (original + enhanced tiers). Dashboard with 17-element intelligence grid. MADCurator native app with 55 fields, 18 filters. Journal de Bord with event labels. Blind test system. Vector similarity search (DINOv2 + SigLIP + CLIP). Web gallery with 14 experiences: launcher, filter grid, bento mosaic, similarity, creative drift, color space, connection game, curated stream, signal darkroom, face wall, compass navigation, data observatory, GPS map, text search, taste test.</p>
<p><strong>In progress:</strong> Gemini analysis (6,203/9,011). 78 BLIP captions need retry. 309 faces without emotion labels.</p>
<p><strong>Next:</strong> Curate images in MADCurator (accept/reject). Precompute DINOv2 structural neighbors for creative drift. SigLIP text&rarr;image search API. Location intelligence (GPS propagation from 1,820 tagged images).</p>

</div>

<h2>Development Principles</h2>

<h3>Vision</h3>
<p>9,011 photographs. Every one should carry the richest possible set of reliable, valuable signals &mdash;
extracted from every available open-source model and programmatic method. The goal is not just
to organize images but to <strong>deeply understand</strong> each one: its technical properties,
its semantic content, its emotional resonance, its relationship to every other image in the collection.</p>
<p>Three apps serve three purposes: <strong>See</strong> (native macOS curator &mdash; the human decides),
<strong>Show</strong> (public web gallery &mdash; the curated experience),
<strong>State</strong> (this dashboard &mdash; the control room).</p>

<h2>Creative Direction for Show</h2>
<p><strong>Show is not just a gallery &mdash; it is an art experience.</strong> Every experience must be designed by someone who is simultaneously the best developer, architect, ML engineer, Apple-level minimalist designer, and most importantly, a deeply creative, emotionally intelligent curator.</p>
<ul>
  <li><strong>Signal-aware storytelling.</strong> Two laughing faces side by side IS funny. A rose-themed image next to rose-accent colors IS pretty. Two grumpy people together IS a statement. Use signals not just for filtering but for creating emotional moments &mdash; surprise, beauty, humor, mystery, melancholy.</li>
  <li><strong>Minimalist UI, maximally expressive content.</strong> Dark, sparse, no chrome. Let the images do the talking. Quality over quantity &mdash; fewer images shown beautifully beats more images shown generically.</li>
  <li><strong>Every experience should feel designed by someone who LOVES photography.</strong> Not a tech demo. Not a data visualization. An experience that makes you want to look at every single image.</li>
</ul>

<h2>Signal Completeness</h2>
<ul>
  <li><strong>100% coverage is the target.</strong> Every image must have every signal. After any pipeline run, verify all tables have full coverage. Partial = something failed silently.</li>
  <li><strong>Check for gaps.</strong> Always run a count before declaring complete. Compare table rows against total image count.</li>
  <li><strong>No duplicates.</strong> UUIDs are deterministic (UUID5, DNS namespace + relative path). Run <code>GROUP BY image_uuid HAVING COUNT(*) &gt; 1</code> to verify.</li>
  <li><strong>New models welcome.</strong> When a better open-source model appears for any signal, integrate it. More signals = richer understanding.</li>
</ul>

<h2>Performance</h2>
<ul>
  <li><strong>Batch processing.</strong> Always batch, never one-at-a-time. Use GPU/MPS where available.</li>
  <li><strong>Incremental.</strong> Never reprocess completed images. Every script checks for existing results and skips. Processing can be interrupted and resumed.</li>
  <li><strong>Parallel where possible.</strong> Independent phases run concurrently. Monitor throughput (images/second). If it drops, investigate.</li>
</ul>

<h2>Data Integrity</h2>
<ul>
  <li><strong>Single source of truth.</strong> <code>mad_photos.db</code> is authoritative. All scripts read/write to it.</li>
  <li><strong>Flat rendered layout.</strong> <code>rendered/{tier}/{format}/{uuid}.ext</code> &mdash; NO category subdirectories. Never create <code>rendered/originals/</code> (plural).</li>
  <li><strong>DNG/RAW color space.</strong> Convert with <code>sips -m sRGB Profile.icc</code> to avoid Display P3 purple cast.</li>
  <li><strong>Monochrome sensor.</strong> Leica Monochrom has no Bayer filter. NEVER color-correct Monochrome images.</li>
  <li><strong>Deterministic UUIDs.</strong> UUID5 from DNS namespace + relative path. Every script must produce the same UUID for the same image.</li>
</ul>

<h2>Code Quality</h2>
<ul>
  <li><strong>Python 3.9 compatibility.</strong> <code>from __future__ import annotations</code>, <code>Optional[X]</code> not <code>X | None</code>.</li>
  <li><strong>Clean repository.</strong> No dead code, no commented-out blocks, no unused imports. Every file has a purpose.</li>
  <li><strong>Error resilience.</strong> Never crash silently. Log failures, track them, continue. One bad image must not stop a 9,011-image batch.</li>
</ul>

<h2>AI Analysis</h2>
<ul>
  <li><strong>Vertex AI + ADC only.</strong> Never use API keys. Both Gemini and Imagen use Application Default Credentials.</li>
  <li><strong>Structured output.</strong> Keep raw JSON for future re-extraction. Parse into individual columns for fast queries.</li>
  <li><strong>Source quality.</strong> Imagen uses <code>full</code> tier (3840px). Gemini uses <code>gemini</code> tier (2048px).</li>
  <li><strong>Two-stage variants.</strong> Stage 1 from original. Stage 2 from gemini_edit. Chain preserves quality.</li>
</ul>

<h2>Dashboard &amp; Monitoring</h2>
<ul>
  <li><strong>Live polling every 5s.</strong> Dashboard reflects true system state at all times.</li>
  <li><strong>Journal de Bord.</strong> Every significant action gets a journal entry. Format: <code>### HH:MM &mdash; Title</code>. This is the project narrative.</li>
  <li><strong>Consistent UI.</strong> All label+count data uses pill/tag format. Sidebar on every page. These become filters.</li>
</ul>

<h2>Signal Inventory</h2>
<table>
  <thead><tr><th>Signal</th><th>Source</th><th>Status</th><th>Key Fields</th></tr></thead>
  <tbody>
    <tr><td>EXIF</td><td>Pillow</td><td>9,011 / 9,011</td><td>Camera, lens, focal length, aperture, shutter, ISO, GPS, flash, WB</td></tr>
    <tr><td>Pixel Analysis</td><td>NumPy / OpenCV</td><td>9,011 / 9,011</td><td>Brightness, saturation, contrast, noise, WB shifts, color temp, histograms</td></tr>
    <tr><td>Dominant Colors</td><td>K-means (LAB)</td><td>9,011 / 9,011</td><td>5 clusters: hex, RGB, LAB, percentage, CSS name</td></tr>
    <tr><td>Face Detection</td><td>YuNet</td><td>9,011 / 9,011</td><td>Bounding boxes, 5 landmarks, confidence, face area %</td></tr>
    <tr><td>Object Detection</td><td>YOLOv8n</td><td>9,011 / 9,011</td><td>80 COCO classes, bounding boxes, confidence</td></tr>
    <tr><td>Perceptual Hashes</td><td>imagehash</td><td>9,011 / 9,011</td><td>pHash, aHash, dHash, wHash, blur, sharpness, entropy</td></tr>
    <tr><td>Vectors</td><td>DINOv2 + SigLIP + CLIP</td><td>9,011 / 9,011</td><td>768d + 768d + 512d = 2,048 dimensions per image</td></tr>
    <tr><td>Gemini Analysis</td><td>Gemini 2.5 Pro</td><td>6,203 / 9,011</td><td>Alt text, vibes, exposure, composition, grading, time, setting, pops, edit prompt</td></tr>
    <tr><td>Aesthetic Scoring</td><td>LAION aesthetic (CLIP MLP)</td><td>9,011 / 9,011</td><td>Score 1&ndash;10, label (excellent/good/average/poor)</td></tr>
    <tr><td>Depth Estimation</td><td>Depth Anything v2</td><td>9,011 / 9,011</td><td>Near/mid/far percentages, complexity bucket</td></tr>
    <tr><td>Scene Classification</td><td>Places365 (ResNet50)</td><td>9,011 / 9,011</td><td>Top 3 scene labels, environment (indoor/outdoor)</td></tr>
    <tr><td>Style Classification</td><td>Scene + composition derived</td><td>9,011 / 9,011</td><td>Style label (street, portrait, landscape, etc.)</td></tr>
    <tr><td>OCR / Text Detection</td><td>EasyOCR</td><td>9,011 / 9,011</td><td>Detected text regions, language, confidence</td></tr>
    <tr><td>Image Captions</td><td>BLIP (Salesforce)</td><td>8,933 / 9,011</td><td>Natural language caption per image (78 retrying)</td></tr>
    <tr><td>Facial Emotions</td><td>ViT face expression</td><td>1,367 / 1,676 faces</td><td>Dominant emotion, 7-class scores per face</td></tr>
    <tr><td>Enhancement Plans</td><td>Camera-aware engine</td><td>9,011 / 9,011</td><td>WB correction, gamma, shadows, highlights, contrast, saturation, sharpening</td></tr>
  </tbody>
</table>

<h2>Future Signals</h2>
<ul>
  <li><strong>Segmentation</strong> &mdash; SAM (Segment Anything) for object masks</li>
  <li><strong>Better aesthetic scoring</strong> &mdash; Current LAION model gives no discrimination (91% score &ldquo;excellent&rdquo;). Needs recalibration or alternative model.</li>
</ul>

<footer>MADphotos &mdash; <a href="https://github.com/LAEH/MADphotos">github.com/LAEH/MADphotos</a></footer>
</div>
<script>
(function() {
  function getTheme() { return localStorage.getItem('mad-theme') || 'light'; }
  function applyTheme(t) {
    document.documentElement.setAttribute('data-theme', t);
    var icon = document.getElementById('themeIcon');
    var label = document.getElementById('themeLabel');
    if (icon) icon.textContent = t === 'dark' ? '\u2600' : '\u263E';
    if (label) label.textContent = t === 'dark' ? 'Light Mode' : 'Dark Mode';
  }
  window.toggleTheme = function() {
    var t = getTheme() === 'dark' ? 'light' : 'dark';
    localStorage.setItem('mad-theme', t);
    applyTheme(t);
  };
  window.toggleSidebar = function() {
    document.body.classList.toggle('sb-collapsed');
    localStorage.setItem('mad-sidebar', document.body.classList.contains('sb-collapsed') ? 'collapsed' : 'expanded');
  };
  applyTheme(getTheme());
  if (localStorage.getItem('mad-sidebar') === 'collapsed') {
    document.body.classList.add('sb-collapsed');
  }
})();
</script>

</body>
</html>