<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MADphotos Dashboard</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%23111'/></svg>">
<style>
  :root {
    --font-sans: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", system-ui, sans-serif;
    --font-display: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", system-ui, sans-serif;
    --font-mono: "SF Mono", ui-monospace, "Cascadia Code", monospace;
    --text-xs: 11px; --text-sm: 13px; --text-base: 15px; --text-lg: 17px;
    --text-xl: 20px; --text-2xl: 22px; --text-3xl: 28px;
    --space-1: 4px; --space-2: 8px; --space-3: 12px; --space-4: 16px;
    --space-5: 20px; --space-6: 24px; --space-8: 32px; --space-10: 40px;
    --radius-sm: 6px; --radius-md: 10px; --radius-lg: 14px;
    --sidebar-w: 220px;
    --apple-blue: #007AFF; --apple-green: #34C759;
    --leading-normal: 1.47; --leading-relaxed: 1.6;
    --tracking-tight: -0.01em; --tracking-caps: 0.06em;
    --duration-fast: 150ms; --ease-default: cubic-bezier(0.25, 0.1, 0.25, 1);
    --apple-purple: #AF52DE; --apple-pink: #FF2D55; --apple-orange: #FF9500;
  }
  [data-theme="light"] {
    --bg: #F5F5F7; --bg-secondary: #FFFFFF; --fg: #1D1D1F;
    --fg-secondary: #3A3A3C; --muted: #86868B;
    --border: rgba(0,0,0,0.08); --border-strong: rgba(0,0,0,0.14);
    --card-bg: #FFFFFF; --sidebar-bg: #FFFFFF;
    --sidebar-active-bg: rgba(0,0,0,0.04); --hover-overlay: rgba(0,0,0,0.03);
    color-scheme: light;
  }
  [data-theme="dark"] {
    --bg: #1C1C1E; --bg-secondary: #2C2C2E; --fg: #F5F5F7;
    --fg-secondary: #D1D1D6; --muted: #98989D;
    --border: rgba(255,255,255,0.08); --border-strong: rgba(255,255,255,0.14);
    --card-bg: #2C2C2E; --sidebar-bg: #2C2C2E;
    --sidebar-active-bg: rgba(255,255,255,0.06); --hover-overlay: rgba(255,255,255,0.04);
    color-scheme: dark;
  }
  @keyframes ai-gradient {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  @keyframes fade-up {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }
  html { scroll-behavior: smooth; }
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: var(--font-sans); font-size: var(--text-base);
    line-height: var(--leading-normal); background: var(--bg); color: var(--fg);
    display: flex; min-height: 100vh;
    -webkit-font-smoothing: antialiased;
  }
  .sidebar {
    width: var(--sidebar-w); min-width: var(--sidebar-w);
    background: var(--sidebar-bg); border-right: 1px solid var(--border);
    padding: var(--space-5) 0; position: sticky; top: 0; height: 100vh;
    overflow-y: auto; display: flex; flex-direction: column;
    transition: width var(--duration-normal) var(--ease-default),
                min-width var(--duration-normal) var(--ease-default);
  }
  .sidebar::after {
    content: '';
    position: absolute; top: 0; right: 0; width: 2px; height: 100%;
    background: linear-gradient(180deg, var(--apple-blue) 0%, var(--apple-purple) 35%, var(--apple-pink) 65%, var(--apple-orange) 100%);
    opacity: 0.35; background-size: 100% 300%; animation: ai-gradient 8s ease infinite;
  }
  .sidebar .sb-title {
    font-family: var(--font-display); font-size: var(--text-lg); font-weight: 700;
    letter-spacing: var(--tracking-tight); padding: 0 var(--space-5) var(--space-4);
    border-bottom: 1px solid var(--border); margin-bottom: var(--space-2);
  }
  .sidebar a {
    display: flex; align-items: center; gap: var(--space-2);
    padding: var(--space-2) var(--space-5); color: var(--muted);
    text-decoration: none; font-size: var(--text-sm);
    transition: background var(--duration-fast) var(--ease-default),
                color var(--duration-fast) var(--ease-default);
  }
  .sidebar a:hover { background: var(--sidebar-active-bg); color: var(--fg); }
  .sidebar a.active {
    color: var(--fg); font-weight: 600; background: var(--sidebar-active-bg);
  }
  .sidebar a.sb-sub { padding-left: var(--space-8); font-size: var(--text-xs); }
  .sidebar .sb-sep { height: 1px; background: var(--border); margin: var(--space-2) var(--space-5); }
  .sidebar .sb-group {
    font-size: var(--text-xs); font-weight: 600; text-transform: uppercase;
    letter-spacing: var(--tracking-caps); color: var(--muted);
    padding: var(--space-3) var(--space-5) var(--space-1);
  }
  .sidebar .sb-bottom {
    margin-top: auto; padding: var(--space-3) var(--space-5);
    border-top: 1px solid var(--border);
  }
  .theme-toggle {
    display: flex; align-items: center; gap: var(--space-2);
    font-size: var(--text-sm); color: var(--muted); cursor: pointer;
    padding: var(--space-2) 0; background: none; border: none;
    font-family: inherit; width: 100%;
    transition: color var(--duration-fast);
  }
  .theme-toggle:hover { color: var(--fg); }
  .theme-toggle .theme-icon { font-size: 16px; }
  .sb-collapse {
    display: flex; align-items: center; gap: var(--space-2);
    font-size: var(--text-sm); color: var(--muted); cursor: pointer;
    padding: var(--space-2) 0; background: none; border: none;
    font-family: inherit; width: 100%; transition: color var(--duration-fast);
    margin-bottom: var(--space-2); white-space: nowrap; overflow: hidden;
  }
  .sb-collapse:hover { color: var(--fg); }
  .sb-expand {
    display: none; position: fixed; top: var(--space-4); left: var(--space-4);
    z-index: 50; width: 36px; height: 36px; border-radius: var(--radius-sm);
    border: 1px solid var(--border); background: var(--card-bg);
    cursor: pointer; color: var(--muted); box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    align-items: center; justify-content: center; font-size: 18px;
    transition: color var(--duration-fast), box-shadow var(--duration-fast);
  }
  .sb-expand:hover { color: var(--fg); box-shadow: 0 4px 16px rgba(0,0,0,0.15); }
  body.sb-collapsed .sidebar { width: 0; min-width: 0; overflow: hidden; padding: 0; border-right: none; }
  body.sb-collapsed .sb-expand { display: flex; }
  .sb-hamburger {
    display: none; align-items: center; justify-content: center;
    width: 36px; height: 36px; background: none; border: none;
    cursor: pointer; color: var(--fg); font-size: 20px;
    border-radius: var(--radius-sm); flex-shrink: 0;
  }
  .main-content {
    flex: 1; padding: var(--space-10) var(--space-8);
    max-width: 900px; min-width: 0; margin: 0 auto;
    animation: fade-up 0.5s var(--ease-default) both;
  }
  @media (max-width: 900px) {
    body { flex-direction: column; }
    body.sb-collapsed .sidebar {
      width: 100%; min-width: unset; overflow: visible; padding: var(--space-2) var(--space-3);
      border-right: none; border-bottom: 1px solid var(--border);
    }
    body.sb-collapsed .sb-expand { display: none; }
    .sb-collapse { display: none !important; }
    .sidebar { width: 100%; min-width: unset; height: auto; position: sticky; top: 0;
               z-index: 100; border-right: none; border-bottom: 1px solid var(--border);
               flex-direction: row; flex-wrap: wrap; padding: var(--space-2) var(--space-3);
               backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
               background: color-mix(in srgb, var(--sidebar-bg) 85%, transparent); }
    .sidebar .sb-title { width: auto; border-bottom: none; padding: 0 var(--space-2) 0 0; margin-bottom: 0; font-size: var(--text-base); }
    .sb-hamburger { display: flex; margin-left: auto; }
    .sidebar > a, .sidebar .sb-group, .sidebar .sb-sep, .sidebar .sb-bottom { display: none; }
    .sidebar.open > a { display: flex; width: 100%; }
    .sidebar.open .sb-sep { display: block; width: 100%; }
    .sidebar.open .sb-bottom { display: block; width: 100%; }
    .main-content { padding: var(--space-6); }
  }
  h1 { font-family: var(--font-display); font-size: var(--text-3xl); font-weight: 700;
       letter-spacing: var(--tracking-tight); margin-bottom: var(--space-2); }
  h2 { font-family: var(--font-display); font-size: var(--text-xl); font-weight: 700;
       margin: var(--space-8) 0 var(--space-3); color: var(--fg);
       border-bottom: 1px solid var(--border); padding-bottom: var(--space-2); }
  h3 { font-size: var(--text-lg); font-weight: 600; margin: var(--space-6) 0 var(--space-2); color: var(--fg); }
  h4 { font-size: var(--text-base); font-weight: 600; margin: var(--space-4) 0 var(--space-2); color: var(--muted); }
  p { font-size: var(--text-sm); margin: var(--space-2) 0; line-height: var(--leading-relaxed); }
  ul { font-size: var(--text-sm); margin: var(--space-2) 0 var(--space-2) var(--space-5); }
  li { margin: var(--space-1) 0; }
  table { width: 100%; border-collapse: collapse; font-size: var(--text-sm); margin: var(--space-3) 0 var(--space-4); }
  th { text-align: left; font-size: var(--text-xs); font-weight: 600; text-transform: uppercase;
       letter-spacing: var(--tracking-caps); color: var(--muted);
       border-bottom: 1px solid var(--border-strong); padding: var(--space-2) var(--space-3); }
  td { padding: var(--space-2) var(--space-3); border-bottom: 1px solid var(--border); }
  code { background: var(--hover-overlay); padding: 2px var(--space-2); font-size: var(--text-sm);
         font-family: var(--font-mono); border-radius: var(--radius-sm); }
  strong { font-weight: 700; }
  a { color: var(--fg); }
  blockquote { font-size: var(--text-sm); color: var(--muted); border-left: 3px solid var(--border);
               padding-left: var(--space-4); margin: var(--space-2) 0; font-style: normal; }
  footer { margin-top: var(--space-10); padding-top: var(--space-4);
           border-top: 1px solid var(--border); font-size: var(--text-xs); color: var(--muted); }
  footer a { color: var(--muted); text-decoration: none; }
  
</style>
</head>
<body>
<button class="sb-expand" onclick="toggleSidebar()" title="Show sidebar">&#9776;</button>
<nav class="sidebar" id="sidebar">
  <div class="sb-title">MADphotos</div>
  <button class="sb-hamburger" onclick="document.getElementById('sidebar').classList.toggle('open')" aria-label="Menu">&#9776;</button>
  <a href="state.html">State</a>
  <a href="journal.html">Journal de Bord</a>
  <a href="instructions.html" class="active">System Instructions</a>
  <div class="sb-sep"></div>
  <div class="sb-group">Experiments</div>
  <a href="drift.html">Similarity</a>
  <a href="creative-drift.html">Drift</a>
  <a href="blind-test.html">Blind Test</a>
  <a href="mosaics.html">Mosaics</a>
  <div class="sb-sep"></div>
  <div class="sb-bottom">
    <button class="sb-collapse" onclick="toggleSidebar()">&#x276E; Hide sidebar</button>
    <button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">
      <span class="theme-icon" id="themeIcon">&#9790;</span>
      <span id="themeLabel">Dark Mode</span>
    </button>
  </div>
</nav>
<div class="main-content">
<style>
  .inst-hero { text-align: center; margin-bottom: var(--space-8); padding: var(--space-8) 0 var(--space-4); }
  .inst-hero h1 { font-size: 28px; font-weight: 800; letter-spacing: -0.02em; margin: 0; }
  .inst-hero p { font-size: var(--text-sm); color: var(--muted); margin-top: var(--space-2); }
  .inst-card {
    background: var(--card-bg); border: 1px solid var(--border); border-radius: var(--radius-lg);
    padding: var(--space-5) var(--space-6); margin-bottom: var(--space-4);
    transition: border-color var(--duration-fast) var(--ease-default);
  }
  .inst-card:hover { border-color: var(--border-strong); }
  .inst-card.inst-accent {
    border-color: var(--apple-indigo);
    background: linear-gradient(135deg, var(--card-bg) 0%, rgba(88,86,214,0.05) 100%);
  }
  .inst-card.inst-creative {
    border-color: var(--apple-pink);
    background: linear-gradient(135deg, var(--card-bg) 0%, rgba(255,55,95,0.04) 100%);
  }
  .inst-card.inst-status {
    border-color: var(--apple-green);
    background: linear-gradient(135deg, var(--card-bg) 0%, rgba(52,199,89,0.04) 100%);
  }
  .inst-card h2 { font-size: 16px; font-weight: 700; margin: 0 0 var(--space-3); letter-spacing: -0.01em; }
  .inst-card h3 { font-size: 13px; font-weight: 600; margin: var(--space-4) 0 var(--space-2); color: var(--fg); }
  .inst-card p, .inst-card li { font-size: var(--text-sm); color: var(--fg-secondary); line-height: var(--leading-relaxed); }
  .inst-card ul { list-style: none; padding: 0; margin: var(--space-2) 0; }
  .inst-card li { padding: var(--space-1) 0 var(--space-1) var(--space-4); position: relative; }
  .inst-card li::before { content: "\2014"; position: absolute; left: 0; color: var(--muted); }
  .inst-card table { width: 100%; border-collapse: collapse; font-size: var(--text-xs); margin: var(--space-2) 0; }
  .inst-card th, .inst-card td { padding: 6px 10px; text-align: left; border-bottom: 1px solid var(--border); }
  .inst-card th { font-weight: 600; color: var(--fg); font-size: 11px; text-transform: uppercase; letter-spacing: 0.04em; }
  .inst-card code { font-family: var(--font-mono); font-size: 0.88em; color: var(--apple-blue); }
  .inst-card td.done { color: var(--apple-green); font-weight: 600; }
  .inst-grid { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-4); }
  @media (max-width: 900px) { .inst-grid { grid-template-columns: 1fr; } }
  .inst-pill {
    display: inline-block; font-size: 10px; font-weight: 600; text-transform: uppercase;
    letter-spacing: 0.05em; padding: 2px 8px; border-radius: var(--radius-full);
    margin-bottom: var(--space-2);
  }
  .inst-pill-indigo { color: var(--apple-indigo); background: color-mix(in srgb, var(--apple-indigo) 12%, transparent); }
  .inst-pill-pink { color: var(--apple-pink); background: color-mix(in srgb, var(--apple-pink) 12%, transparent); }
  .inst-pill-green { color: var(--apple-green); background: color-mix(in srgb, var(--apple-green) 12%, transparent); }
  .inst-pill-blue { color: var(--apple-blue); background: color-mix(in srgb, var(--apple-blue) 12%, transparent); }
  .inst-pill-orange { color: var(--apple-orange); background: color-mix(in srgb, var(--apple-orange) 12%, transparent); }
  .inst-pill-teal { color: var(--apple-teal); background: color-mix(in srgb, var(--apple-teal) 12%, transparent); }
  .app-trio { display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-3); margin: var(--space-3) 0; }
  .app-box { background: var(--hover-overlay); border-radius: var(--radius-md); padding: var(--space-3) var(--space-4); }
  .app-box strong { display: block; font-size: 14px; margin-bottom: 4px; }
  .app-box p { font-size: 12px; margin: 0; color: var(--muted); line-height: 1.5; }
  @media (max-width: 700px) { .app-trio { grid-template-columns: 1fr; } }
</style>

<div class="inst-hero">
  <h1>System Instructions</h1>
  <p>Everything needed to work on MADphotos effectively. Updated 2026-02-09.</p>
</div>

<!-- ═══ PROJECT BRIEFING ═══ -->
<div class="inst-card inst-accent">
  <span class="inst-pill inst-pill-indigo">Briefing</span>
  <h2>MADphotos</h2>
  <p>A solo art project by <strong>LAEH</strong>. 9,011 unedited photographs shot over a decade with five cameras, turned into the most richly-understood image collection ever built. Every image gets every possible signal. Then camera-aware enhancement.</p>

  <div class="app-trio">
    <div class="app-box">
      <strong>Show</strong>
      <p>Blow people&rsquo;s minds. Continuously release new experiences guided by signals and new ideas. Delightful, playful, elegant, smart, teasing, revealing, exciting &mdash; on every screen.</p>
    </div>
    <div class="app-box">
      <strong>State</strong>
      <p>The dashboard. The control room. Every signal, every model, every image &mdash; tracked, measured, monitored.</p>
    </div>
    <div class="app-box">
      <strong>See</strong>
      <p>The native power image viewer and editor. MADCurator &mdash; 55 fields, 21 filters with union/intersection modes, inline label editing (9 Gemini fields + vibes), full-resolution display. The human eye decides what&rsquo;s worth showing.</p>
    </div>
  </div>
</div>

<!-- ═══ CREATIVE DIRECTION ═══ -->
<div class="inst-card inst-creative">
  <span class="inst-pill inst-pill-pink">Creative Direction</span>
  <h2>Show Is an Art Experience</h2>
  <p>Not just a gallery. Not a tech demo. Every experience must be designed by someone who is simultaneously the best developer, architect, ML engineer, exigent Apple-level minimalist designer, and deeply creative, emotionally intelligent curator.</p>
  <ul>
    <li><strong>Signal-aware storytelling.</strong> Two laughing faces side by side IS funny. A rose-themed image next to rose-accent colors IS pretty. Two grumpy people together IS a statement. Signals create emotional moments &mdash; surprise, beauty, humor, mystery, melancholy.</li>
    <li><strong>Minimalist UI, maximally expressive content.</strong> Dark, sparse, no chrome. Let the images talk. Fewer images shown beautifully beats more images shown generically.</li>
    <li><strong>Every experience should feel designed by someone who LOVES photography.</strong> An experience that makes you want to look at every single image.</li>
  </ul>
</div>

<!-- ═══ STATUS ═══ -->
<div class="inst-card inst-status">
  <span class="inst-pill inst-pill-green">Status</span>
  <h2>What&rsquo;s Done vs. What&rsquo;s Next</h2>
  <p><strong>V1 Signals (all 9,011/9,011):</strong> Rendering (97,898 tiers). EXIF. Pixel Analysis. Dominant Colors. Image Hashes. Vectors v1 (DINOv2-base+SigLIP-base+CLIP). Aesthetic Scoring. Depth Estimation. Scene Classification. Style Classification. BLIP Captions. Facial Emotions. Enhancement Plans (v1+v2). <strong>Gemini 2.5 Pro analysis (9,011/9,011).</strong> OCR (17,914 detections).</p>
  <p><strong>V2 Signals (all complete):</strong> Aesthetic v2 (TOPIQ+MUSIQ+LAION). Quality Scores. Florence-2 Captions (9,011). CLIP Tags (9,011). Grounding DINO (108,861 detections). ArcFace Identities (2,264). rembg Foreground (9,011). SAM Segmentation (9,011). Pose Detection (3,595). Saliency Maps (9,011). GPS Locations (1,820). Border Detection (1,126). <strong>Vectors v2: DINOv2-Large (1024d) + SigLIP2-SO400M (1152d) + CLIP (512d).</strong></p>
  <p><strong>Conditional signals (complete but partial by nature):</strong> Face Detections (1,676 images). Object Detections (5,363 images). Open Detections (8,981 images). Pose Detections (1,670 images). Face Identities (1,197 images). GPS Locations (1,820 images). Border Crops (1,126 analog images).</p>
  <p><strong>Deployed:</strong> Show on Firebase (madphotos.web.app), State on GitHub Pages, images on GCS. 14 web experiences. MADCurator native macOS app.</p>
  <p><strong>Next:</strong> New Show experiences using V2 signals. StatsPage V2 visualizations. Interactive SimilarityPage. More Imagen variants.</p>
</div>

<!-- ═══ CAMERAS + ARCHITECTURE ═══ -->
<div class="inst-grid">

<div class="inst-card">
  <span class="inst-pill inst-pill-orange">Hardware</span>
  <h2>Five Cameras</h2>
  <table>
    <thead><tr><th>Camera</th><th>Count</th><th>Rule</th></tr></thead>
    <tbody>
      <tr><td>Leica M8</td><td>3,533</td><td>CCD warmth is character. Correct WB only 50%.</td></tr>
      <tr><td>DJI Osmo Pro</td><td>3,032</td><td>1,459 have GPS. Best auto WB.</td></tr>
      <tr><td>Leica MP</td><td>1,126</td><td>Portra 400 VC. Film grain is sacred &mdash; never denoise.</td></tr>
      <tr><td>Leica Monochrom</td><td>1,099</td><td><strong>NEVER color-correct.</strong> Pure luminance sensor.</td></tr>
      <tr><td>G12 / Memo</td><td>221</td><td>Worst WB. Most aggressive correction (70%).</td></tr>
    </tbody>
  </table>
</div>

<div class="inst-card">
  <span class="inst-pill inst-pill-blue">Architecture</span>
  <h2>28 Python Scripts (backend/)</h2>
  <table>
    <thead><tr><th>Script</th><th>Purpose</th></tr></thead>
    <tbody>
      <tr><td><code>pipeline.py</code></td><td>Phase orchestrator</td></tr>
      <tr><td><code>completions.py</code></td><td>Master orchestrator &mdash; checks all stages, fixes gaps, updates State</td></tr>
      <tr><td><code>render.py</code></td><td>6-tier resolution pyramid</td></tr>
      <tr><td><code>gemini.py</code></td><td>Gemini 2.5 Pro structured analysis</td></tr>
      <tr><td><code>imagen.py</code></td><td>AI variants via Imagen 3</td></tr>
      <tr><td><code>upload.py</code></td><td>Upload to GCS</td></tr>
      <tr><td><code>database.py</code></td><td>SQLite schema (33 tables)</td></tr>
      <tr><td><code>enhance.py</code></td><td>Camera-aware 6-step enhancement</td></tr>
      <tr><td><code>enhance_v2.py</code></td><td>Signal-aware enhancement v2</td></tr>
      <tr><td><code>signals.py</code></td><td>EXIF, colors, faces, objects, hashes</td></tr>
      <tr><td><code>signals_advanced.py</code></td><td>Aesthetics, depth, scenes, styles, OCR, captions, emotions</td></tr>
      <tr><td><code>signals_v2.py</code></td><td>12-phase V2: Florence-2, DINO, SAM, rembg, TOPIQ, MUSIQ, saliency, poses, tags, identities</td></tr>
      <tr><td><code>vectors.py</code></td><td>V1 embeddings: DINOv2-base/SigLIP-base/CLIP</td></tr>
      <tr><td><code>vectors_v2.py</code></td><td>V2 embeddings: DINOv2-Large/SigLIP2-SO400M/CLIP</td></tr>
      <tr><td><code>dashboard.py</code></td><td>Dashboard + Journal + Instructions</td></tr>
      <tr><td><code>export_gallery.py</code></td><td>Gallery data export to 6 JSON files</td></tr>
      <tr><td><code>serve_show.py</code></td><td>Local dev server</td></tr>
      <tr><td><code>pixel_analysis.py</code></td><td>Pixel-level analysis for enhancement</td></tr>
      <tr><td><code>quality_scores.py</code></td><td>Technical + CLIP quality scoring</td></tr>
      <tr><td><code>border_crop.py</code></td><td>Analog border detection</td></tr>
      <tr><td><code>mosaics.py</code></td><td>4096px mosaic generator</td></tr>
      <tr><td><code>render_enhanced.py</code></td><td>Enhanced image tier rendering</td></tr>
      <tr><td><code>prep_blind_test.py</code></td><td>A/B blind test preparation</td></tr>
      <tr><td><code>pipeline_lock.py</code></td><td>Pipeline lock management</td></tr>
      <tr><td><code>_florence_worker.py</code></td><td>Parallel Florence-2 captioning worker</td></tr>
      <tr><td><code>_rembg_standalone.py</code></td><td>Standalone rembg foreground extraction</td></tr>
    </tbody>
  </table>
</div>

</div>

<!-- ═══ TECHNICAL RULES ═══ -->
<div class="inst-card">
  <span class="inst-pill inst-pill-teal">Rules</span>
  <h2>Critical Technical Rules</h2>
  <div class="inst-grid" style="gap:var(--space-2);">
    <ul>
      <li><strong>Python 3.9.6</strong> &mdash; <code>from __future__ import annotations</code>, <code>Optional[X]</code> not <code>X | None</code></li>
      <li><strong>Vertex AI + ADC only</strong> &mdash; NEVER API keys</li>
      <li><strong>Flat layout</strong> &mdash; <code>images/rendered/{tier}/{format}/{uuid}.ext</code>. Never <code>rendered/originals/</code> (plural)</li>
      <li><strong>DNG color</strong> &mdash; <code>sips -m sRGB Profile.icc</code> to avoid P3 purple cast</li>
      <li><strong>UUID5</strong> &mdash; DNS namespace, deterministic from relative path</li>
    </ul>
    <ul>
      <li><strong>Tiers</strong>: full (3840), display (2048), mobile (1280), thumb (480), micro (64), gemini (2048)</li>
      <li><strong>GCS</strong> &mdash; <code>v/{version}/{tier}/{format}/{uuid}.ext</code></li>
      <li><strong>google-genai 1.47</strong> &mdash; <code>edit_image()</code> needs <code>vertexai=True</code></li>
      <li><strong>JPEGmini Pro</strong> &mdash; GUI app, serving tiers only (display/mobile/thumb/micro)</li>
      <li><strong>Monochrome</strong> &mdash; zero saturation, zero color correction, ever</li>
    </ul>
  </div>
</div>

<!-- ═══ HOSTING ═══ -->
<div class="inst-grid">

<div class="inst-card">
  <span class="inst-pill inst-pill-blue">Infrastructure</span>
  <h2>GCS Image Hosting Strategy</h2>
  <ul>
    <li><strong>GCP Project:</strong> laeh380to760 &mdash; account: laeh@madbits.ai</li>
    <li><strong>Bucket:</strong> <code>gs://myproject-public-assets/art/MADphotos/</code></li>
    <li><strong>URL pattern:</strong> <code>https://storage.googleapis.com/myproject-public-assets/art/MADphotos/v/{version}/{tier}/{format}/{uuid}.ext</code></li>
  </ul>
  <h3>Versioned Directory Structure</h3>
  <table>
    <thead><tr><th>Version</th><th>Content</th><th>Tiers Uploaded</th></tr></thead>
    <tbody>
      <tr><td><code>original</code></td><td>Unmodified rendered tiers</td><td>display, mobile, thumb, micro &times; jpeg + webp</td></tr>
      <tr><td><code>enhanced</code></td><td>Camera-aware enhanced</td><td>display, mobile, thumb, micro &times; jpeg + webp</td></tr>
      <tr><td><code>blind</code></td><td>Blind test comparison images</td><td>display/jpeg only</td></tr>
    </tbody>
  </table>
  <h3>Deployment Map</h3>
  <table>
    <thead><tr><th>App</th><th>Platform</th><th>URL</th></tr></thead>
    <tbody>
      <tr><td><strong>State</strong></td><td>GitHub Pages</td><td>laeh.github.io/MADphotos/</td></tr>
      <tr><td><strong>Show</strong></td><td>Firebase Hosting</td><td>madphotos-efbfb.web.app</td></tr>
      <tr><td><strong>Images</strong></td><td>GCS public bucket</td><td>storage.googleapis.com/myproject-public-assets/...</td></tr>
    </tbody>
  </table>
  <ul>
    <li><strong>Show does NOT host images.</strong> All image URLs point to GCS. Firebase only serves HTML/CSS/JS + data JSONs.</li>
    <li><strong>upload.py</strong> uploads serving tiers only. Full/gemini tiers stay local (AI pipeline input).</li>
    <li><strong>Upload command:</strong> <code>python3 backend/upload.py --version original</code> (or enhanced, blind)</li>
  </ul>
</div>

<div class="inst-card">
  <h2>Web Gallery (Show) &mdash; 14 Experiences</h2>
  <ul>
    <li><code>backend/export_gallery.py</code> &rarr; 6 JSON files (photos, faces, game_rounds, stream_sequence, drift_neighbors)</li>
    <li><code>backend/serve_show.py</code> &rarr; localhost:3000</li>
    <li>18 files: index.html, style.css, app.js + 14 experience modules + data/</li>
    <li>La Grille, Le Bento, La Similarit&eacute;, La D&eacute;rive, Les Couleurs, Le Jeu, Chambre Noire, Le Flot, Les Visages, La Boussole, L&rsquo;Observatoire, La Carte, Machine &Agrave; &Eacute;crire, Le Pendule</li>
    <li>Dark minimalist design system: 40+ CSS tokens (motion grammar, emotion colors, depth layers, category colors), Apple HIG curves, prefers-reduced-motion support</li>
    <li>Vanilla JS, no framework. 60fps animations via rAF, IntersectionObserver lazy loading, timer leak prevention</li>
  </ul>
</div>

</div>

<!-- ═══ SIGNAL INVENTORY ═══ -->
<div class="inst-card">
  <span class="inst-pill inst-pill-teal">Signals</span>
  <h2>Signal Inventory &mdash; 33 Tables, 24 Models</h2>

  <h3>V1 Signals (all 9,011/9,011)</h3>
  <table>
    <thead><tr><th>Signal</th><th>Source</th><th>Status</th><th>Key Fields</th></tr></thead>
    <tbody>
      <tr><td>EXIF</td><td>Pillow</td><td class="done">9,011 &check;</td><td>Camera, lens, focal, aperture, shutter, ISO, GPS</td></tr>
      <tr><td>Pixel Analysis</td><td>NumPy/OpenCV</td><td class="done">9,011 &check;</td><td>Brightness, saturation, contrast, noise, WB shifts</td></tr>
      <tr><td>Dominant Colors</td><td>K-means (LAB)</td><td class="done">45,051 rows &check;</td><td>5 clusters: hex, RGB, LAB, percentage</td></tr>
      <tr><td>Faces</td><td>YuNet</td><td class="done">1,676 images &check;</td><td>3,187 faces: boxes, landmarks, confidence, area %</td></tr>
      <tr><td>Objects</td><td>YOLOv8n</td><td class="done">5,363 images &check;</td><td>14,534 detections, 80 COCO classes</td></tr>
      <tr><td>Hashes</td><td>imagehash</td><td class="done">9,011 &check;</td><td>pHash, aHash, dHash, wHash, blur, sharpness</td></tr>
      <tr><td>Gemini</td><td>Gemini 2.5 Pro</td><td class="done">9,011 &check;</td><td>Alt, vibes, exposure, composition, grading, edit prompt</td></tr>
      <tr><td>Aesthetic v1</td><td>LAION (CLIP MLP)</td><td class="done">9,011 &check;</td><td>Score 1&ndash;10 (low discrimination &mdash; use v2)</td></tr>
      <tr><td>Depth</td><td>Depth Anything v2</td><td class="done">9,011 &check;</td><td>Near/mid/far %, complexity bucket</td></tr>
      <tr><td>Scenes</td><td>Places365</td><td class="done">9,011 &check;</td><td>Top 3 labels, indoor/outdoor</td></tr>
      <tr><td>Style</td><td>Rule-based</td><td class="done">9,011 &check;</td><td>street, portrait, landscape, macro, etc.</td></tr>
      <tr><td>OCR</td><td>EasyOCR</td><td class="done">17,914 detections &check;</td><td>Text regions, language, confidence</td></tr>
      <tr><td>Captions</td><td>BLIP</td><td class="done">9,011 &check;</td><td>Natural language description</td></tr>
      <tr><td>Emotions</td><td>DeepFace</td><td class="done">1,676 images &check;</td><td>7-class scores per face (3,187 emotion entries)</td></tr>
      <tr><td>Enhancement</td><td>Camera engine v1+v2</td><td class="done">9,011 &times; 2 &check;</td><td>WB, gamma, shadows, contrast, saturation, sharpening</td></tr>
    </tbody>
  </table>

  <h3>V2 Signals (added Feb 2026)</h3>
  <table>
    <thead><tr><th>Signal</th><th>Source</th><th>Status</th><th>Key Fields</th></tr></thead>
    <tbody>
      <tr><td>Aesthetic v2</td><td>TOPIQ + MUSIQ + LAION</td><td class="done">9,011 &check;</td><td>3-model composite score (0&ndash;100), real spread</td></tr>
      <tr><td>Quality</td><td>Technical + CLIP</td><td class="done">9,011 &check;</td><td>Technical, CLIP, combined scores, sharpness, noise, exposure</td></tr>
      <tr><td>Florence Captions</td><td>Florence-2-base</td><td class="done">9,011 &check;</td><td>Short, detailed, more_detailed captions</td></tr>
      <tr><td>Tags</td><td>CLIP zero-shot</td><td class="done">9,011 &check;</td><td>Multi-label tags (pipe-delimited)</td></tr>
      <tr><td>Open Detections</td><td>Grounding DINO tiny</td><td class="done">8,981 images &check;</td><td>108,861 detections, open-vocabulary</td></tr>
      <tr><td>Face Identities</td><td>InsightFace ArcFace</td><td class="done">1,197 images &check;</td><td>2,264 face embeddings + identity clustering</td></tr>
      <tr><td>Foreground</td><td>rembg / U2Net</td><td class="done">9,011 &check;</td><td>Foreground %, centroid, bounding box</td></tr>
      <tr><td>Segmentation</td><td>SAM 2.1 hiera-tiny</td><td class="done">9,011 &check;</td><td>Segment count, figure/ground ratio, edge complexity</td></tr>
      <tr><td>Poses</td><td>YOLOv8n-pose</td><td class="done">1,670 images &check;</td><td>3,595 pose keypoints (17 COCO joints)</td></tr>
      <tr><td>Saliency</td><td>OpenCV spectral</td><td class="done">9,011 &check;</td><td>Peak location, spread, center bias, thirds grid</td></tr>
      <tr><td>Locations</td><td>EXIF GPS</td><td class="done">1,820 images &check;</td><td>Latitude, longitude, location name</td></tr>
      <tr><td>Border Crops</td><td>OpenCV edge</td><td class="done">1,126 analog &check;</td><td>Border detection, crop margins</td></tr>
    </tbody>
  </table>

  <h3>Vectors + Variants</h3>
  <table>
    <thead><tr><th>Signal</th><th>Source</th><th>Status</th><th>Key Fields</th></tr></thead>
    <tbody>
      <tr><td>Vectors v1</td><td>DINOv2-base + SigLIP-base + CLIP</td><td class="done">9,011 &check;</td><td>768d + 768d + 512d (LanceDB)</td></tr>
      <tr><td>Vectors v2</td><td>DINOv2-Large + SigLIP2-SO400M + CLIP</td><td class="done">9,011 &check;</td><td>1024d + 1152d + 512d (LanceDB)</td></tr>
      <tr><td>AI Variants</td><td>Imagen 3</td><td>290 / 173 images</td><td>Cartoon cel-shaded illustrations</td></tr>
    </tbody>
  </table>
</div>

<!-- ═══ INCREMENTAL INGESTION ═══ -->
<div class="inst-card">
  <span class="inst-pill inst-pill-orange">Pipeline</span>
  <h2>New Image Ingestion</h2>
  <p>User will add more images over time. <strong>Every script MUST handle incremental ingestion.</strong> Full process for new images:</p>
  <p style="font-family:var(--font-mono);font-size:12px;color:var(--muted);line-height:1.8;">
    register &rarr; render tiers &rarr; pixel analysis &rarr; Gemini analysis &rarr; signal extraction &rarr; vector embeddings &rarr; enhancement &rarr; export gallery data &rarr; curation
  </p>
  <ul>
    <li>All scripts check for existing results and skip processed images</li>
    <li>Processing can be interrupted and resumed at any point</li>
    <li>After ingestion, re-run <code>backend/export_gallery.py</code> to update web data</li>
    <li>Consistency: same parameters, same models, same quality for all images</li>
  </ul>
</div>

<!-- ═══ JOURNAL ═══ -->
<div class="inst-card">
  <h2>Journal de Bord</h2>
  <p>File: <code>docs/journal.md</code>. Write after EVERY significant action. Format: <code>### HH:MM &mdash; Title</code> under <code>## YYYY-MM-DD</code> headers. Include intent, what happened, what was learned. Rendered as timeline with auto-classified event type labels.</p>
</div>

<footer>MADphotos &mdash; <a href="https://github.com/LAEH/MADphotos">github.com/LAEH/MADphotos</a></footer>
</div>
<script>
(function() {
  function getTheme() {
    var s = localStorage.getItem('mad-theme');
    if (s) return s;
    return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  }
  function applyTheme(t) {
    document.documentElement.setAttribute('data-theme', t);
    var icon = document.getElementById('themeIcon');
    var label = document.getElementById('themeLabel');
    if (icon) icon.textContent = t === 'dark' ? '\u2600' : '\u263E';
    if (label) label.textContent = t === 'dark' ? 'Light Mode' : 'Dark Mode';
  }
  window.toggleTheme = function() {
    var t = getTheme() === 'dark' ? 'light' : 'dark';
    localStorage.setItem('mad-theme', t);
    applyTheme(t);
  };
  window.toggleSidebar = function() {
    document.body.classList.toggle('sb-collapsed');
    localStorage.setItem('mad-sidebar', document.body.classList.contains('sb-collapsed') ? 'collapsed' : 'expanded');
  };
  applyTheme(getTheme());
  if (localStorage.getItem('mad-sidebar') === 'collapsed') {
    document.body.classList.add('sb-collapsed');
  }
})();
</script>

</body>
</html>