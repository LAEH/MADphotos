/* ===== Reset & Base ===== */
*, *::before, *::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* ============================================================
   DESIGN TOKENS — Minimal Black & White
   Typography does the work. Space is the luxury.
   Color only where it carries meaning.
   ============================================================ */
:root {
    /* ── Apple System Colors (Light) — kept for semantic use only ── */
    --system-red: rgb(255, 59, 48);
    --system-orange: rgb(255, 149, 0);
    --system-yellow: rgb(255, 204, 0);
    --system-green: rgb(52, 199, 89);
    --system-mint: rgb(0, 199, 190);
    --system-teal: rgb(48, 176, 199);
    --system-cyan: rgb(50, 173, 230);
    --system-blue: rgb(0, 122, 255);
    --system-indigo: rgb(88, 86, 214);
    --system-purple: rgb(175, 82, 222);
    --system-pink: rgb(255, 45, 85);
    --system-brown: rgb(162, 132, 94);

    /* ── Grays (Light) ── */
    --system-gray: rgb(142, 142, 147);
    --system-gray-2: rgb(174, 174, 178);
    --system-gray-3: rgb(199, 199, 204);
    --system-gray-4: rgb(209, 209, 214);
    --system-gray-5: rgb(229, 229, 234);
    --system-gray-6: rgb(242, 242, 247);

    /* ── Surfaces — Light ── */
    --bg: #ffffff;
    --bg-elevated: #f5f5f5;
    --bg-tertiary: #ebebeb;
    --text: #000000;
    --text-dim: #6e6e73;
    --text-muted: #aeaeb2;
    --header-bg: rgba(255, 255, 255, 0.88);
    --separator: rgba(0, 0, 0, 0.08);

    /* ── Glass — neutral ── */
    --glass-bg: rgba(120, 120, 128, 0.04);
    --glass-bg-hover: rgba(120, 120, 128, 0.08);
    --glass-border: rgba(0, 0, 0, 0.08);
    --glass-border-hover: rgba(0, 0, 0, 0.18);

    /* ── Fill Colors ── */
    --fill-primary: rgba(120, 120, 128, 0.2);
    --fill-secondary: rgba(120, 120, 128, 0.16);
    --fill-tertiary: rgba(118, 118, 128, 0.12);
    --fill-quaternary: rgba(116, 116, 128, 0.08);

    /* ── Elevation ── */
    --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.06);
    --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.08);
    --shadow-lg: 0 12px 28px rgba(0, 0, 0, 0.1), 0 4px 10px rgba(0, 0, 0, 0.04);
    --shadow-elevated: 0 4px 16px rgba(0, 0, 0, 0.08), 0 12px 40px rgba(0, 0, 0, 0.06);
    --shadow-bento: 0 4px 16px rgba(0, 0, 0, 0.12), 0 12px 40px rgba(0, 0, 0, 0.08), 0 24px 80px rgba(0, 0, 0, 0.06);
    --shadow-float: 0 8px 32px rgba(0, 0, 0, 0.15);
    --shadow-deck: 0 8px 32px rgba(0, 0, 0, 0.3);

    /* ── Layout ── */
    --radius-xs: 4px;
    --radius-sm: 6px;
    --radius: 8px;
    --radius-lg: 12px;
    --radius-xl: 16px;
    --radius-full: 9999px;

    /* ── Spacing Scale ── */
    --space-0_5: 2px;
    --space-1: 4px;
    --space-1_5: 6px;
    --space-2: 8px;
    --space-2_5: 10px;
    --space-3: 12px;
    --space-3_5: 14px;
    --space-4: 16px;
    --space-4_5: 18px;
    --space-5: 20px;
    --space-6: 24px;
    --space-7: 28px;
    --space-8: 32px;
    --space-10: 40px;
    --space-12: 48px;
    --space-16: 64px;
    --space-20: 80px;

    /* ── Type Scale ── */
    --text-2xs: 10px;
    --text-xs: 11px;
    --text-caption: 12px;
    --text-sm: 13px;
    --text-base: 15px;
    --text-lg: 17px;
    --text-xl: 20px;
    --text-2xl: 22px;
    --text-3xl: 28px;
    --text-4xl: 34px;
    --text-5xl: 48px;
    --text-6xl: 64px;

    /* ── Motion — Apple HIG curves ── */
    --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
    --ease-out-quart: cubic-bezier(0.25, 1, 0.5, 1);
    --ease-in-out: cubic-bezier(0.45, 0, 0.15, 1);
    --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
    --duration-fast: 150ms;
    --duration-normal: 250ms;
    --duration-slow: 400ms;
    --transition: var(--duration-normal) var(--ease-out-quart);

    /* ── Typography ── */
    --font: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Helvetica Neue', system-ui, sans-serif;
    --font-mono: 'SF Mono', ui-monospace, 'Fira Code', 'JetBrains Mono', monospace;
    --font-display: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', system-ui, sans-serif;

    /* ── Category colors — monochrome ── */
    --c-vibe: var(--text-dim);
    --c-grading: var(--text-dim);
    --c-time: var(--text-dim);
    --c-setting: var(--text-dim);
    --c-scene: var(--text-dim);
    --c-emotion: var(--text-dim);
    --c-camera: var(--text-dim);
    --c-style: var(--text-dim);

    /* ── Emotion colors — kept for Faces (semantic) ── */
    --emo-happy: var(--system-green);
    --emo-sad: var(--system-cyan);
    --emo-angry: var(--system-red);
    --emo-surprise: var(--system-orange);
    --emo-fear: var(--system-purple);
    --emo-disgust: var(--system-gray);
    --emo-neutral: var(--system-gray-2);
    --emo-contempt: var(--system-pink);

    /* ── Semantic colors ── */
    --color-error: var(--system-red);
    --color-success: var(--system-green);

    /* ── Depth layer visualization ── */
    --depth-near: rgba(50, 173, 230, 0.5);
    --depth-mid: rgba(52, 199, 89, 0.3);
    --depth-far: rgba(255, 59, 48, 0.3);
}

/* ============================================================
   DARK MODE — toggled via .dark class on <html>
   ============================================================ */
:root.dark {
    --system-red: rgb(255, 69, 58);
    --system-orange: rgb(255, 159, 10);
    --system-yellow: rgb(255, 214, 10);
    --system-green: rgb(48, 209, 88);
    --system-mint: rgb(99, 230, 226);
    --system-teal: rgb(64, 200, 224);
    --system-cyan: rgb(100, 210, 255);
    --system-blue: rgb(10, 132, 255);
    --system-indigo: rgb(94, 92, 230);
    --system-purple: rgb(191, 90, 242);
    --system-pink: rgb(255, 55, 95);
    --system-brown: rgb(172, 142, 104);

    --system-gray: rgb(142, 142, 147);
    --system-gray-2: rgb(99, 99, 102);
    --system-gray-3: rgb(72, 72, 74);
    --system-gray-4: rgb(58, 58, 60);
    --system-gray-5: rgb(44, 44, 46);
    --system-gray-6: rgb(28, 28, 30);

    --bg: #000000;
    --bg-elevated: #1c1c1e;
    --bg-tertiary: #2c2c2e;
    --text: #f5f5f7;
    --text-dim: #8e8e93;
    --text-muted: #636366;
    --header-bg: rgba(0, 0, 0, 0.88);
    --separator: rgba(255, 255, 255, 0.06);

    --glass-bg: rgba(255, 255, 255, 0.06);
    --glass-bg-hover: rgba(255, 255, 255, 0.12);
    --glass-border: rgba(255, 255, 255, 0.08);
    --glass-border-hover: rgba(255, 255, 255, 0.18);

    --fill-primary: rgba(120, 120, 128, 0.36);
    --fill-secondary: rgba(120, 120, 128, 0.32);
    --fill-tertiary: rgba(118, 118, 128, 0.24);
    --fill-quaternary: rgba(118, 118, 128, 0.18);

    --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.2);
    --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.3);
    --shadow-lg: 0 12px 28px rgba(0, 0, 0, 0.5);
    --shadow-elevated: 0 4px 16px rgba(0, 0, 0, 0.2), 0 12px 40px rgba(0, 0, 0, 0.15);
    --shadow-bento: 0 4px 16px rgba(0, 0, 0, 0.3), 0 12px 40px rgba(0, 0, 0, 0.2), 0 24px 80px rgba(0, 0, 0, 0.15);
    --shadow-float: 0 8px 32px rgba(0, 0, 0, 0.4);
    --shadow-deck: 0 8px 32px rgba(0, 0, 0, 0.5);

    --depth-near: rgba(100, 210, 255, 0.5);
    --depth-mid: rgba(48, 209, 88, 0.3);
    --depth-far: rgba(255, 69, 58, 0.3);
}

/* ============================================================
   IMMERSIVE VIEWS — Force dark for optimal image viewing
   Photos always look best on black.
   ============================================================ */
#view-bento,
#view-stream,
#view-couleurs,
#view-domino {
    --bg: #000000;
    --bg-elevated: #1c1c1e;
    --bg-tertiary: #2c2c2e;
    --text: #f5f5f7;
    --text-dim: #8e8e93;
    --text-muted: #636366;
    --glass-bg: rgba(255, 255, 255, 0.06);
    --glass-bg-hover: rgba(255, 255, 255, 0.12);
    --glass-border: rgba(255, 255, 255, 0.08);
    --glass-border-hover: rgba(255, 255, 255, 0.18);
    --separator: rgba(255, 255, 255, 0.06);
    --fill-primary: rgba(120, 120, 128, 0.36);
    --fill-secondary: rgba(120, 120, 128, 0.32);
    --fill-tertiary: rgba(118, 118, 128, 0.24);
    --fill-quaternary: rgba(118, 118, 128, 0.18);
    --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.2);
    --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.3);
    --shadow-lg: 0 12px 28px rgba(0, 0, 0, 0.5);
    --shadow-elevated: 0 4px 16px rgba(0, 0, 0, 0.2), 0 12px 40px rgba(0, 0, 0, 0.15);
    --shadow-bento: 0 4px 16px rgba(0, 0, 0, 0.3), 0 12px 40px rgba(0, 0, 0, 0.2), 0 24px 80px rgba(0, 0, 0, 0.15);
    --shadow-float: 0 8px 32px rgba(0, 0, 0, 0.4);
    --shadow-deck: 0 8px 32px rgba(0, 0, 0, 0.5);
    background: var(--bg);
    color: var(--text);
}

/* ============================================================
   ANIMATIONS — Only functional ones
   ============================================================ */
@keyframes fade-up {
    from {
        opacity: 0;
        transform: translateY(16px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

@keyframes blink {
    50% { opacity: 0; }
}

/* ── Image loading transitions ──
   Two-phase loading: start invisible, fade in once fully loaded.
   .img-loading  = not yet loaded (opacity 0, !important to beat
                    any specificity on the element's resting state)
   .img-loaded   = fully decoded, fade to 1. Class is auto-removed
                    after the transition ends (in JS) so it does not
                    permanently override other transitions on the
                    same element (e.g. grid-item img hover scale). */
.img-loading {
    opacity: 0 !important;
}
.img-loaded {
    opacity: 1;
    transition: opacity var(--duration-slow) var(--ease-out-quart) !important;
}

/* Face crop canvases: same two-phase pattern */
.face-crop-loading {
    opacity: 0;
}
.face-crop-loaded {
    opacity: 1;
    transition: opacity var(--duration-slow) var(--ease-out-quart);
}

/* ===== Base ===== */
html {
    scroll-behavior: smooth;
}

body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font);
    font-size: 14px;
    line-height: 1.5;
    min-height: 100vh;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* ===== Header ===== */
#header {
    position: sticky;
    top: 0;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-3) var(--space-6);
    background: var(--header-bg);
    backdrop-filter: saturate(180%) blur(20px);
    -webkit-backdrop-filter: saturate(180%) blur(20px);
    border-bottom: 1px solid var(--separator);
}

.header-left {
    display: flex;
    align-items: baseline;
    gap: var(--space-3);
}

.logo {
    font-family: var(--font-display);
    font-size: var(--text-lg);
    font-weight: 600;
    letter-spacing: -0.01em;
    color: var(--text);
    text-decoration: none;
    cursor: pointer;
    transition: opacity var(--duration-fast) var(--ease-out-quart);
}

.logo:hover {
    opacity: 0.6;
}

.photo-count {
    font-size: var(--text-caption);
    color: var(--text-muted);
    font-variant-numeric: tabular-nums;
}

/* Header right group */
.header-right {
    display: flex;
    align-items: center;
    gap: var(--space-2);
}

/* Theme toggle */
.theme-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    background: none;
    border: 1px solid var(--glass-border);
    border-radius: var(--radius);
    color: var(--text-dim);
    cursor: pointer;
    transition: color var(--transition), border-color var(--transition);
    flex-shrink: 0;
}

.theme-toggle:hover {
    color: var(--text);
    border-color: var(--glass-border-hover);
}

/* Show sun in dark mode, moon in light mode */
.theme-icon-sun { display: none; }
.theme-icon-moon { display: block; }
:root.dark .theme-icon-sun { display: block; }
:root.dark .theme-icon-moon { display: none; }

/* Tabs */
.tabs {
    display: flex;
    gap: var(--space-0_5);
}

.tab {
    background: transparent;
    border: 1px solid transparent;
    color: var(--text-dim);
    font-family: var(--font);
    font-size: var(--text-sm);
    padding: var(--space-1_5) var(--space-4);
    cursor: pointer;
    border-radius: var(--radius);
    transition: background var(--transition), color var(--transition), border-color var(--transition);
}

.tab:hover {
    color: var(--text);
    background: var(--glass-bg);
}

.tab.active {
    color: var(--text);
    background: var(--glass-bg-hover);
    border-color: var(--glass-border);
}

/* ===== Views ===== */
#main {
    padding: 0;
}

.view {
    display: none;
    min-height: calc(100vh - 52px);
}

.view.active {
    display: block;
    animation: fade-up 0.4s var(--ease-out-expo) both;
}

/* ===== Launcher ===== */
.launcher {
    max-width: 1100px;
    margin: 0 auto;
    padding: var(--space-12) var(--space-6) var(--space-20);
}

.launcher-header {
    margin-bottom: var(--space-12);
    animation: fade-up 0.6s var(--ease-out-expo) both;
}

.launcher-title {
    font-family: var(--font-display);
    font-size: var(--text-5xl);
    font-weight: 700;
    letter-spacing: -0.03em;
    line-height: 1;
    margin-bottom: var(--space-2);
}

.launcher-subtitle {
    font-size: var(--text-base);
    color: var(--text-dim);
    font-weight: 400;
}

.launcher-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: var(--space-2_5);
}

/* Stagger cards in grid by row */
.launcher-grid .exp-card:nth-child(n+5) { animation-delay: 60ms; }
.launcher-grid .exp-card:nth-child(n+9) { animation-delay: 120ms; }
.launcher-grid .exp-card:nth-child(n+13) { animation-delay: 180ms; }

.exp-card {
    background: var(--bg);
    border: 1px solid var(--separator);
    border-radius: var(--radius-lg);
    padding: var(--space-4_5);
    cursor: pointer;
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    min-height: 170px;
    color: var(--text);
    transition: transform var(--transition), box-shadow var(--transition), border-color var(--transition);
    animation: fade-up 0.5s var(--ease-out-expo) both;
}

:root.dark .exp-card {
    background: var(--bg-elevated);
    border-color: var(--separator);
}

.exp-card:hover {
    transform: translateY(-2px);
    border-color: var(--glass-border-hover);
    box-shadow: var(--shadow-md);
}

:root.dark .exp-card:hover {
    border-color: var(--glass-border-hover);
    box-shadow: var(--shadow-md);
}

.exp-card-title {
    font-family: var(--font-display);
    font-size: 19px;
    font-weight: 700;
    letter-spacing: -0.02em;
    margin-bottom: var(--space-1_5);
    color: var(--text);
}

.exp-card-desc {
    font-size: var(--text-caption);
    color: var(--text-dim);
    line-height: 1.45;
    margin-bottom: var(--space-3_5);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* ===== Card Footer & Sticker Tags ===== */
.exp-card-footer {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-1_5);
    margin-top: auto;
}

.exp-tag {
    font-size: var(--text-2xs);
    font-weight: 500;
    padding: var(--space-1) var(--space-2_5);
    border-radius: var(--radius-sm);
    white-space: nowrap;
    border: 1px solid var(--glass-border);
    background: var(--glass-bg);
    color: var(--text-dim);
}

/* Layout tags (Scroll / Viewport) — consistent cyan */
.exp-tag-layout {
    border-color: color-mix(in srgb, var(--system-cyan) 40%, transparent);
    background: color-mix(in srgb, var(--system-cyan) 10%, transparent);
    color: var(--system-cyan);
}

/* Signal tags (method / data source) — consistent orange */
.exp-tag-signal {
    border-color: color-mix(in srgb, var(--system-orange) 40%, transparent);
    background: color-mix(in srgb, var(--system-orange) 10%, transparent);
    color: var(--system-orange);
}

/* Device tags — neutral muted */
.exp-tag-device {
    border-color: var(--glass-border) !important;
    background: var(--glass-bg) !important;
    color: var(--text-muted) !important;
}

/* ===== Device Gating ===== */
.exp-card-disabled {
    opacity: 0.4;
    cursor: default;
    filter: saturate(0.5);
}

.exp-card-disabled:hover {
    transform: none;
    box-shadow: none;
}

/* Device-only info shown via .exp-tag-device in footer */

/* ===== Glass Tags — Monochrome Default ===== */
.glass-tag {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
    padding: var(--space-1) var(--space-3);
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    font-size: var(--text-xs);
    color: var(--text-dim);
    cursor: pointer;
    transition: background var(--duration-fast) var(--ease-out-quart),
                border-color var(--duration-fast) var(--ease-out-quart);
    white-space: nowrap;
    user-select: none;
    text-transform: capitalize;
}

.glass-tag:hover {
    background: var(--glass-bg-hover);
    border-color: var(--glass-border-hover);
}

.glass-tag.active {
    background: var(--fill-secondary);
    border-color: var(--glass-border-hover);
    color: var(--text);
}

/* Category tags — all monochrome */
.glass-tag.tag-vibe,
.glass-tag.tag-grading,
.glass-tag.tag-time,
.glass-tag.tag-setting,
.glass-tag.tag-scene,
.glass-tag.tag-emotion,
.glass-tag.tag-camera,
.glass-tag.tag-style {
    border-color: var(--glass-border);
    color: var(--text-dim);
}

.glass-tag.tag-vibe:hover,
.glass-tag.tag-grading:hover,
.glass-tag.tag-time:hover,
.glass-tag.tag-setting:hover,
.glass-tag.tag-scene:hover,
.glass-tag.tag-emotion:hover,
.glass-tag.tag-camera:hover,
.glass-tag.tag-style:hover {
    border-color: var(--glass-border-hover);
}

.glass-tag.tag-vibe.active,
.glass-tag.tag-grading.active,
.glass-tag.tag-time.active,
.glass-tag.tag-setting.active,
.glass-tag.tag-scene.active,
.glass-tag.tag-emotion.active,
.glass-tag.tag-camera.active,
.glass-tag.tag-style.active {
    background: var(--fill-secondary);
    border-color: var(--glass-border-hover);
    color: var(--text);
}

/* Exception: tags inside Faces keep emotion colors */
.faces-container .glass-tag.tag-emotion {
    border-color: color-mix(in srgb, var(--system-pink) 35%, transparent);
    color: var(--system-pink);
}
.faces-container .glass-tag.tag-emotion:hover {
    border-color: color-mix(in srgb, var(--system-pink) 60%, transparent);
}

.glass-tag .dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    flex-shrink: 0;
}

/* ===== Filter Bar ===== */
.filter-bar {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-1_5);
    padding: var(--space-3) var(--space-6);
    min-height: 44px;
    border-bottom: 1px solid var(--separator);
}

.filter-bar .filter-label {
    font-size: var(--text-xs);
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-right: var(--space-1);
}

.filter-bar .clear-btn {
    font-family: var(--font);
    font-size: var(--text-xs);
    color: var(--text-dim);
    background: none;
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-sm);
    padding: 3px var(--space-2_5);
    cursor: pointer;
    transition: background var(--transition), border-color var(--transition), color var(--transition);
}

.filter-bar .clear-btn:hover {
    color: var(--text);
    border-color: var(--glass-border-hover);
    background: var(--glass-bg);
}

.filter-count {
    font-size: var(--text-caption);
    color: var(--text-dim);
    margin-left: auto;
    font-variant-numeric: tabular-nums;
}

/* ===== Sort (was La Grille) ===== */
.sort-bar {
    display: flex;
    justify-content: center;
    gap: var(--space-2);
    padding: var(--space-4) var(--space-6);
    position: sticky;
    top: 52px;
    z-index: 10;
    background: var(--bg);
}

.sort-btn {
    font-family: var(--font);
    font-size: var(--text-sm);
    color: var(--text-dim);
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-full);
    padding: var(--space-1_5) var(--space-5);
    cursor: pointer;
    transition: background var(--transition), border-color var(--transition), color var(--transition);
}

.sort-btn:hover {
    color: var(--text);
    background: var(--glass-bg-hover);
    border-color: var(--glass-border-hover);
}

.sort-btn.active {
    color: var(--text);
    background: var(--fill-secondary);
    border-color: var(--glass-border-hover);
}

.sort-grid-wrap {
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 var(--space-6) var(--space-20);
}

.grid-container {
    padding: var(--space-2);
}

.grid {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-1);
}

.grid-item {
    position: relative;
    overflow: hidden;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: opacity var(--transition), transform var(--transition);
    flex-grow: 1;
}

.grid-item img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform var(--duration-slow) var(--ease-out-expo);
}

.grid-item:hover img {
    transform: scale(1.03);
}

/* Overlay gradient — always dark (on images) */
.grid-item .grid-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, transparent 50%);
    opacity: 0;
    transition: opacity var(--transition);
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    padding: var(--space-2);
    gap: var(--space-1);
    pointer-events: none;
}

.grid-item:hover .grid-overlay {
    opacity: 1;
}

.grid-item .grid-overlay .glass-tag {
    pointer-events: auto;
    /* Force light text in overlay context */
    color: rgba(255, 255, 255, 0.9);
    border-color: rgba(255, 255, 255, 0.2);
    background: rgba(0, 0, 0, 0.3);
}

.grid-overlay-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 3px;
}

.filter-active-section {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-1);
    align-items: center;
}

.grid-item.filtered-out {
    opacity: 0;
    width: 0 !important;
    height: 0 !important;
    margin: 0;
    padding: 0;
    overflow: hidden;
    flex-grow: 0;
    flex-shrink: 1;
    flex-basis: 0;
}

/* Row-based layout */
.grid-row {
    display: flex;
    gap: var(--space-1);
    width: 100%;
}

.grid-row .grid-item {
    flex-grow: 0;
    flex-shrink: 0;
}

/* ===== Similarity / Drift shared ===== */
.drift-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--space-8) var(--space-6);
    min-height: calc(100vh - 52px);
}

.drift-center {
    position: relative;
    max-width: 1000px;
    width: 100%;
    margin-bottom: var(--space-10);
}

.drift-center img {
    width: 100%;
    border-radius: var(--radius);
    display: block;
    border: 1px solid var(--separator);
}

.drift-center-meta {
    padding: var(--space-4) 0;
}

.drift-center-alt {
    font-size: var(--text-base);
    color: var(--text);
    line-height: 1.6;
    margin-bottom: var(--space-3);
    font-style: italic;
}

.drift-center-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-1_5);
}

.drift-center-palette {
    display: flex;
    gap: var(--space-1);
    margin-top: var(--space-2);
}

.palette-dot {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    border: 1px solid var(--glass-border);
}

.drift-neighbors {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-3);
    max-width: 1000px;
    width: 100%;
}

.drift-neighbor {
    position: relative;
    cursor: pointer;
    border-radius: var(--radius);
    overflow: hidden;
    border: 1px solid var(--glass-border);
    transition: border-color var(--transition), transform var(--transition), box-shadow var(--transition);
    background: var(--bg-elevated);
}

.drift-neighbor:hover {
    border-color: var(--glass-border-hover);
    transform: translateY(-3px);
    box-shadow: var(--shadow-sm);
}

.drift-neighbor img {
    width: 100%;
    aspect-ratio: 4/3;
    object-fit: cover;
    display: block;
}

.drift-neighbor-label {
    padding: var(--space-2) var(--space-3);
    font-size: var(--text-xs);
    color: var(--text-dim);
    text-transform: capitalize;
}

.drift-score {
    position: absolute;
    bottom: 0;
    left: 0;
    height: 2px;
    background: var(--fill-primary);
    transition: width 0.3s ease;
}
.drift-neighbor:hover .drift-score {
    background: var(--text);
}

.drift-controls {
    display: flex;
    gap: var(--space-3);
    margin-bottom: var(--space-6);
    align-items: center;
}

.drift-btn {
    font-family: var(--font);
    font-size: var(--text-caption);
    color: var(--text-dim);
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius);
    padding: var(--space-1_5) var(--space-3_5);
    cursor: pointer;
    transition: background var(--transition), border-color var(--transition), color var(--transition);
}

.drift-btn:hover {
    color: var(--text);
    background: var(--glass-bg-hover);
    border-color: var(--glass-border-hover);
}

.drift-breadcrumb {
    display: flex;
    align-items: center;
    gap: var(--space-1);
    flex-wrap: wrap;
}

.drift-breadcrumb-item {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    overflow: hidden;
    cursor: pointer;
    border: 1px solid var(--glass-border);
    transition: border-color var(--transition), transform var(--duration-fast) var(--ease-spring);
    flex-shrink: 0;
}

.drift-breadcrumb-item:hover {
    border-color: var(--glass-border-hover);
    transform: scale(1.15);
}

.drift-breadcrumb-item.current {
    border-color: var(--text);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--text) 20%, transparent);
}

.drift-breadcrumb-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.drift-breadcrumb-arrow {
    color: var(--text-muted);
    font-size: var(--text-2xs);
    flex-shrink: 0;
}

/* ===== Couleurs (Les Couleurs) — Chromatic Bento ===== */
#view-couleurs { overflow: hidden; }

.couleurs-wrap {
    display: flex;
    flex-direction: column;
    height: calc(100vh - 52px);
    padding: var(--space-6);
    gap: var(--space-4);
}

.couleurs-spectrum {
    display: flex;
    height: 28px;
    border-radius: var(--radius-full);
    overflow: hidden;
    flex-shrink: 0;
}

.couleurs-band {
    flex: 1;
    cursor: pointer;
    transition: flex var(--transition), opacity var(--transition);
    min-width: 2px;
    opacity: 0.4;
}

.couleurs-band:hover {
    opacity: 0.75;
    flex: 2;
}

.couleurs-band.active {
    opacity: 1;
    flex: 3;
}

.couleurs-card {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 3px;
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-bento);
    min-height: 0;
}

.couleurs-row {
    display: flex;
    gap: 3px;
    flex: 1;
    min-height: 0;
}

.couleurs-tile {
    flex: 1;
    overflow: hidden;
    cursor: pointer;
    min-width: 0;
    min-height: 0;
}

.couleurs-tile img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* ===== Bento (Le Bento) — Elevated card composition ===== */
.bento-view {
    overflow: hidden;
}

.bento-wrap {
    display: flex;
    align-items: center;
    justify-content: center;
    height: calc(100vh - 52px);
    padding: var(--space-10);
    position: relative;
}

.bento-card {
    display: flex;
    flex-direction: column;
    gap: 3px;
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-bento);
    max-width: calc(100vw - var(--space-20));
    max-height: calc(100vh - 132px);
}

.bento-row {
    display: flex;
    gap: 3px;
    flex: 1;
    min-height: 0;
}

.bento-tile {
    flex: 1;
    overflow: hidden;
    cursor: pointer;
    transition: opacity 800ms ease;
    min-width: 0;
    min-height: 0;
}

.bento-tile img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.bento-regen {
    position: fixed;
    bottom: var(--space-6);
    right: var(--space-6);
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: 1px solid var(--glass-border-hover);
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    cursor: pointer;
    font-size: 22px;
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    transition: background var(--transition), border-color var(--transition), transform var(--duration-fast) var(--ease-spring);
}

.bento-regen:hover {
    background: rgba(0, 0, 0, 0.7);
    border-color: rgba(255, 255, 255, 0.25);
    transform: scale(1.1);
}

/* ===== Shared: game-title, game-desc, game-start-btn ===== */
.game-title {
    font-family: var(--font-display);
    font-size: var(--text-4xl);
    font-weight: 600;
    letter-spacing: -0.02em;
    margin-bottom: var(--space-3);
}

.game-desc {
    font-size: 14px;
    color: var(--text-dim);
    margin-bottom: var(--space-8);
}

.game-start-btn {
    font-family: var(--font);
    font-size: var(--text-base);
    color: var(--text);
    background: var(--glass-bg-hover);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius);
    padding: var(--space-3) var(--space-8);
    cursor: pointer;
    transition: background var(--transition), border-color var(--transition);
}

.game-start-btn:hover {
    background: var(--fill-primary);
    border-color: var(--glass-border-hover);
}

.game-end {
    padding: var(--space-12) 0;
    text-align: center;
}

.game-final-score {
    font-family: var(--font-display);
    font-size: var(--text-6xl);
    font-weight: 700;
    margin-bottom: var(--space-1);
    letter-spacing: -0.04em;
}

.game-final-label {
    font-size: var(--text-base);
    color: var(--text-dim);
    margin-bottom: var(--space-6);
}

/* ===== Le Jeu — Viewport-fixed image pairs ===== */
#view-game { overflow: hidden; }

.jeu-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: calc(100vh - 52px);
    padding: var(--space-6);
    gap: 0;
    position: relative;
}

.jeu-pair {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-2);
    max-width: 100%;
    max-height: calc(100vh - 140px);
    min-height: 0;
    flex: 1;
    align-content: center;
    transition: opacity 300ms var(--ease-out-quart), transform 300ms var(--ease-out-quart);
}

.jeu-pair-exit {
    opacity: 0;
    transform: scale(0.97);
}

.jeu-pair-enter {
    opacity: 0;
    transform: scale(0.97);
}

.jeu-card {
    border-radius: var(--radius-lg);
    overflow: hidden;
    min-height: 0;
}

.jeu-img {
    width: 100%;
    height: 100%;
    aspect-ratio: 3/2;
    object-fit: cover;
    display: block;
}

/* Fixed glass bar at bottom */
.jeu-bar {
    position: fixed;
    bottom: var(--space-6);
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: var(--space-5);
    padding: var(--space-2_5) var(--space-5);
    background: rgba(120, 120, 128, 0.08);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-full);
    backdrop-filter: saturate(180%) blur(20px);
    -webkit-backdrop-filter: saturate(180%) blur(20px);
    z-index: 10;
}

.jeu-btn {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: none;
    background: transparent;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    line-height: 1;
    transition: transform var(--duration-fast) var(--ease-spring);
}

.jeu-btn:hover {
    transform: scale(1.25);
}

.jeu-btn:active {
    transform: scale(0.9);
}

/* ===== Stream (Le Flot) ===== */
.stream-container {
    max-width: 100%;
}

.stream-item {
    width: 100%;
    cursor: pointer;
    position: relative;
}

.stream-img {
    width: 100%;
    display: block;
}

.stream-breather {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.stream-breather .stream-img {
    width: 100%;
    height: 100vh;
    object-fit: cover;
}

/* Breather text — always white on image */
.stream-breather-text {
    position: absolute;
    bottom: 15%;
    left: 10%;
    right: 10%;
    font-family: var(--font-display);
    font-size: var(--text-2xl);
    color: rgba(255,255,255,0.85);
    font-style: italic;
    line-height: 1.6;
    text-align: center;
    text-shadow: 0 2px 20px rgba(0,0,0,0.8);
}

/* ===== Domino (Le Domino) — Centered bento with 4 connected images ===== */
#view-domino { overflow: hidden; }

.domino-bento {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 3fr 5fr 3fr;
    gap: var(--space-1);
    height: calc(100vh - 52px);
    padding: var(--space-5);
}

/* Main image spans both columns in the middle row */
.domino-main {
    grid-column: 1 / -1;
    grid-row: 2;
    position: relative;
    overflow: hidden;
    border-radius: var(--radius);
    cursor: pointer;
}

.domino-main img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
    background: var(--bg-elevated);
    border-radius: var(--radius);
}

/* Connected images: dimmed, clickable */
.domino-conn {
    position: relative;
    overflow: hidden;
    border-radius: var(--radius);
    cursor: pointer;
    transition: opacity var(--duration-normal) var(--ease-out-quart);
}

.domino-conn img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    opacity: 0.35;
    transition: opacity var(--duration-normal) var(--ease-out-quart);
}

/* Override img-loaded for dimmed state */
.domino-conn img.img-loaded {
    opacity: 0.35;
}

.domino-conn:hover img,
.domino-conn:hover img.img-loaded {
    opacity: 0.7;
}

/* Shared label overlay on connected images */
.domino-conn-label {
    position: absolute;
    display: flex;
    align-items: center;
    gap: var(--space-1);
    pointer-events: none;
    z-index: 2;
}

/* Top-row connected: label at bottom edge */
.domino-conn[data-pos="top-left"] .domino-conn-label,
.domino-conn[data-pos="top-right"] .domino-conn-label {
    bottom: var(--space-2);
    left: var(--space-2_5);
}

/* Bottom-row connected: label at top edge */
.domino-conn[data-pos="bot-left"] .domino-conn-label,
.domino-conn[data-pos="bot-right"] .domino-conn-label {
    top: var(--space-2);
    left: var(--space-2_5);
}

.domino-conn-dim {
    font-size: 9px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: rgba(255, 255, 255, 0.5);
}

.domino-conn-value {
    font-size: var(--text-caption);
    color: rgba(255, 255, 255, 0.85);
    font-weight: 500;
    text-shadow: 0 1px 4px rgba(0, 0, 0, 0.6);
}

/* Random button */
.domino-random {
    position: fixed;
    bottom: var(--space-6);
    right: var(--space-6);
    font-family: var(--font);
    font-size: 22px;
    line-height: 1;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: 1px solid var(--glass-border);
    background: var(--glass-bg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    cursor: pointer;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background var(--transition), border-color var(--transition), transform var(--duration-fast) var(--ease-spring);
}

.domino-random:hover {
    background: var(--glass-bg-hover);
    border-color: var(--glass-border-hover);
    transform: scale(1.1);
}

/* ===== Faces (Les Visages) — Viewport-fixed with elevated container ===== */
#view-faces { overflow: hidden; }

.faces-container {
    display: flex;
    flex-direction: column;
    height: calc(100vh - 52px);
    padding: var(--space-5);
    gap: var(--space-4);
}

.faces-filter-bar {
    display: flex;
    justify-content: center;
    gap: var(--space-2);
    flex-shrink: 0;
    flex-wrap: wrap;
}

.faces-filter-btn {
    font-family: var(--font);
    font-size: var(--text-sm);
    color: var(--text-dim);
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-full);
    padding: var(--space-1_5) var(--space-4_5);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: var(--space-1_5);
    transition: background var(--transition), border-color var(--transition), color var(--transition);
}

.faces-filter-btn:hover {
    color: var(--text);
    background: var(--glass-bg-hover);
    border-color: var(--glass-border-hover);
}

.faces-filter-btn.active {
    color: var(--text);
    background: var(--fill-secondary);
    border-color: var(--glass-border-hover);
}

.faces-filter-count {
    font-size: var(--text-2xs);
    font-family: var(--font-mono);
    color: var(--text-muted);
}

.faces-card {
    flex: 1;
    min-height: 0;
    border-radius: var(--radius-lg);
    overflow-y: auto;
    overflow-x: hidden;
    display: flex;
    flex-wrap: wrap;
    align-content: start;
    gap: 3px;
    padding: var(--space-3);
    background: var(--bg-elevated);
    box-shadow: var(--shadow-elevated);
}

.face-card {
    width: 80px;
    height: 80px;
    border-radius: var(--radius-sm);
    overflow: hidden;
    border: 2px solid var(--glass-border);
    cursor: pointer;
    transition: transform var(--duration-fast) var(--ease-spring), border-color var(--transition);
}

.face-card:hover {
    transform: scale(1.12);
    z-index: 2;
    box-shadow: var(--shadow-sm);
}

.face-crop-canvas {
    width: 100%;
    height: 100%;
    display: block;
}

/* ===== Compass (La Boussole) — Viewport cross layout ===== */
#view-compass {
    overflow: hidden;
}

.compass-cross {
    display: flex;
    flex-direction: column;
    height: calc(100vh - 52px);
}

/* North & south arms */
.compass-arm {
    position: relative;
    overflow: hidden;
    cursor: pointer;
}

.compass-north,
.compass-south {
    flex: 1;
    min-height: 0;
}

.compass-arm-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    opacity: 0.35;
    transition: opacity var(--duration-normal) var(--ease-out-quart);
}
/* Override .img-loaded on compass arms: fade to dimmed state, not full */
.compass-arm-img.img-loaded {
    opacity: 0.35;
}

.compass-arm:hover .compass-arm-img,
.compass-arm:hover .compass-arm-img.img-loaded {
    opacity: 0.7;
}

.compass-arm-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--space-1);
    pointer-events: none;
}

.compass-arm-label {
    font-size: var(--text-2xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: rgba(255, 255, 255, 0.6);
}

.compass-arm-trait {
    font-size: 14px;
    color: rgba(255, 255, 255, 0.9);
    font-weight: 500;
}

.compass-arm-empty {
    background: var(--bg-elevated);
}

/* Middle row: west — center — east */
.compass-mid {
    display: flex;
    flex: 3;
    min-height: 0;
}

.compass-west,
.compass-east {
    flex: 1;
    min-width: 0;
}

/* Center image — prominent */
.compass-center {
    flex: 3;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 0;
    padding: var(--space-2);
    background: var(--bg);
}

.compass-center-img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    display: block;
    border-radius: var(--radius);
}

/* Random button — floating bottom-right */
.compass-random {
    position: fixed;
    bottom: var(--space-5);
    right: var(--space-5);
    font-family: var(--font);
    font-size: var(--text-caption);
    color: var(--text-dim);
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius);
    padding: var(--space-1_5) var(--space-3_5);
    cursor: pointer;
    z-index: 10;
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    transition: background var(--transition), border-color var(--transition), color var(--transition);
}

.compass-random:hover {
    color: var(--text);
    background: var(--glass-bg-hover);
    border-color: var(--glass-border-hover);
}

/* ===== Observatory (L'Observatoire) ===== */
.observatory-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
    gap: var(--space-4);
    padding: var(--space-6);
}

.obs-panel {
    background: var(--bg-elevated);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius);
    padding: var(--space-5);
}

.obs-panel-title {
    font-size: var(--text-caption);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-dim);
    margin-bottom: var(--space-4);
    font-weight: 600;
}

.obs-panel-content {
    display: flex;
    flex-direction: column;
    gap: var(--space-1_5);
}

.obs-bar-row {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-caption);
}

.obs-bar-label {
    color: var(--text);
    min-width: 100px;
    font-size: var(--text-caption);
}

.obs-bar {
    height: 8px;
    background: var(--fill-quaternary);
    border-radius: 4px;
    flex: 1;
    max-width: 200px;
}

/* Neutral fill instead of purple tint */
.obs-bar-style { background: var(--fill-tertiary); }

.obs-bar-count {
    font-size: var(--text-xs);
    color: var(--text-muted);
    min-width: 30px;
    text-align: right;
    font-variant-numeric: tabular-nums;
}

.obs-histogram {
    display: flex;
    align-items: flex-end;
    gap: var(--space-0_5);
    height: 100px;
}

.obs-hist-bar {
    flex: 1;
    background: var(--fill-tertiary);
    border-radius: 2px 2px 0 0;
    min-height: 1px;
    transition: background var(--transition);
}

.obs-hist-bar:hover { background: var(--fill-primary); }

.obs-inline-count {
    font-size: var(--text-2xs);
    color: var(--text-muted);
    margin-left: var(--space-0_5);
}

.obs-outlier-row {
    display: flex;
    align-items: center;
    gap: var(--space-2_5);
    padding: var(--space-1_5) 0;
}

.obs-outlier-thumb {
    width: 72px;
    height: 72px;
    border-radius: var(--radius-sm);
    object-fit: cover;
}

.obs-outlier-label {
    font-size: var(--text-caption);
    color: var(--text-dim);
}

/* ===== Map (La Carte) ===== */
.map-container {
    padding: var(--space-6);
}

.map-header {
    font-size: var(--text-sm);
    color: var(--text-dim);
    margin-bottom: var(--space-4);
}

.map-canvas {
    width: 100%;
    max-width: 1200px;
    border-radius: var(--radius);
    border: 1px solid var(--glass-border);
    cursor: crosshair;
}

.map-strip {
    display: flex;
    gap: var(--space-2);
    margin-top: var(--space-4);
    overflow-x: auto;
    padding-bottom: var(--space-2);
}

.map-strip-card {
    flex-shrink: 0;
    width: 180px;
    height: 120px;
    border-radius: var(--radius-sm);
    overflow: hidden;
    border: 1px solid var(--glass-border);
    cursor: pointer;
    transition: border-color var(--transition), transform var(--transition), box-shadow var(--transition);
}

.map-strip-card:hover {
    border-color: var(--glass-border-hover);
    transform: translateY(-2px);
    box-shadow: var(--shadow-sm);
}

.map-strip-card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}


/* ===== NYU — Multi-view experience ===== */
#view-nyu { overflow: hidden; }

.nyu-shell {
    position: relative;
    height: calc(100vh - 52px);
    overflow: hidden;
}

.nyu-viewport {
    height: 100%;
    overflow: hidden;
}

/* Nav bar — floating glass pill at bottom */
.nyu-nav {
    position: fixed;
    bottom: var(--space-6);
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: var(--space-1);
    padding: var(--space-2) var(--space-3);
    background: rgba(230, 230, 230, 0.35);
    backdrop-filter: saturate(150%) blur(40px);
    -webkit-backdrop-filter: saturate(150%) blur(40px);
    border: 1px solid var(--glass-border-hover);
    border-radius: var(--radius-full);
    box-shadow: var(--shadow-float);
    z-index: 50;
}

.nyu-nav-btn {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: none;
    background: transparent;
    cursor: pointer;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.55;
    transition: opacity var(--transition), background var(--transition), box-shadow var(--transition);
    position: relative;
}

.nyu-nav-btn:hover { opacity: 1; }

.nyu-nav-btn.active {
    opacity: 1;
    background: rgba(255, 255, 255, 0.9);
    box-shadow: var(--shadow-sm);
}

.nyu-nav-btn.active::after {
    content: '';
    position: absolute;
    bottom: -3px;
    left: 50%;
    transform: translateX(-50%);
    width: 4px;
    height: 4px;
    border-radius: 50%;
    background: #000;
}

/* Counter */
.nyu-counter {
    font-size: var(--text-sm);
    color: var(--text-muted);
    font-variant-numeric: tabular-nums;
    letter-spacing: 0.02em;
    text-align: center;
    padding: var(--space-4) 0;
}

/* ===== Reel ===== */
.nyu-reel {
    display: flex;
    align-items: center;
    height: 100%;
    overflow-x: auto;
    overflow-y: hidden;
    scroll-snap-type: x mandatory;
    gap: var(--space-8);
    padding: 0 max(var(--space-6), calc(50vw - 250px));
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
}

.nyu-reel::-webkit-scrollbar { display: none; }

.nyu-reel-item {
    scroll-snap-align: center;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-lg);
    overflow: hidden;
}

.nyu-reel-item img {
    max-height: 80vh;
    max-width: min(600px, 85vw);
    object-fit: contain;
    display: block;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-deck);
}

/* ===== Grid ===== */
.nyu-vp-grid { overflow-y: auto; }

.nyu-grid {
    padding: var(--space-1);
    padding-bottom: 100px;
}

.nyu-grid-row {
    display: flex;
    gap: var(--space-1);
    margin-bottom: var(--space-1);
}

.nyu-grid-row[data-type="hero"] .nyu-grid-cell { height: 55vh; }
.nyu-grid-row[data-type="pair"] .nyu-grid-cell { height: 38vh; }
.nyu-grid-row[data-type="triplet"] .nyu-grid-cell { height: 28vh; }

.nyu-grid-cell {
    flex: 1;
    overflow: hidden;
    border-radius: var(--radius-sm);
    cursor: pointer;
    min-width: 0;
}

.nyu-grid-cell img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform var(--duration-slow) var(--ease-out-expo);
}

.nyu-grid-cell:hover img { transform: scale(1.03); }

/* ===== Deck ===== */
.nyu-vp-deck {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.nyu-accent {
    position: absolute;
    inset: 0;
    pointer-events: none;
    transition: background 800ms var(--ease-out-quart);
}

.nyu-stack {
    position: relative;
    width: min(85vw, 700px);
    aspect-ratio: 3/2;
    cursor: pointer;
}

.nyu-card {
    position: absolute;
    inset: 0;
    border-radius: var(--radius-xl);
    overflow: hidden;
    transform-origin: center bottom;
    transform:
        translateY(calc(var(--card-index) * -14px))
        scale(calc(1 - var(--card-index) * 0.05));
    opacity: calc(1 - var(--card-index) * 0.15);
    transition: transform 400ms var(--ease-spring),
                opacity 400ms var(--ease-out-quart);
    box-shadow: var(--shadow-deck);
}

.nyu-card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.nyu-card-exit {
    transform: translateX(120%) rotate(8deg) !important;
    opacity: 0 !important;
    transition: transform 350ms var(--ease-out-expo),
                opacity 300ms var(--ease-out-quart) !important;
}

.nyu-card-exit-left {
    transform: translateX(-120%) rotate(-8deg) !important;
    opacity: 0 !important;
    transition: transform 350ms var(--ease-out-expo),
                opacity 300ms var(--ease-out-quart) !important;
}

/* ===== Canvas ===== */
.nyu-canvas {
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    transition: background 1s var(--ease-out-quart);
    padding: var(--space-10);
}

.nyu-canvas-img-wrap {
    display: flex;
    align-items: center;
    justify-content: center;
    flex: 1;
    min-height: 0;
    width: 100%;
}

.nyu-canvas-img {
    max-width: 90%;
    max-height: 75vh;
    object-fit: contain;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-deck);
    cursor: pointer;
    transition: transform var(--duration-fast) var(--ease-spring);
}

.nyu-canvas-img:hover { transform: scale(1.01); }

.nyu-canvas-counter { color: var(--text-dim); }

/* ===== Overview — Assembled mosaic ===== */
.nyu-vp-overview {
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.nyu-mosaic {
    display: grid;
    grid-template-columns: repeat(var(--m-cols), 1fr);
    grid-template-rows: repeat(var(--m-rows), 1fr);
    width: min(78vh, 78vw);
    height: min(78vh, 78vw);
    gap: 1px;
}

.nyu-mosaic.assembled {
    animation: mosaic-settle 2.4s var(--ease-out-quart) 1.6s both;
}

@keyframes mosaic-settle {
    0%   { transform: scale(1); }
    40%  { transform: scale(1.006); }
    100% { transform: scale(1); }
}

.nyu-mosaic-cell {
    overflow: hidden;
    cursor: pointer;
    transform: translate(var(--sx), var(--sy)) rotate(var(--sr)) scale(0);
    opacity: 0;
    transition: transform 1.2s var(--ease-spring),
                opacity 0.6s var(--ease-out-quart);
    transition-delay: var(--d);
    will-change: transform, opacity;
}

.nyu-mosaic.assembled .nyu-mosaic-cell {
    transform: translate(0, 0) rotate(0deg) scale(1);
    opacity: 1;
}

.nyu-mosaic-cell img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform var(--duration-normal) var(--ease-spring),
                opacity var(--duration-normal) var(--ease-out-quart);
}

.nyu-mosaic-cell:hover img {
    transform: scale(1.25);
    opacity: 1;
}

/* ===== Confetti — Set selector + assembled mosaics ===== */
#view-confetti {
    height: calc(100vh - 52px);
    overflow-y: auto;
}

/* Selector grid */
.confetti-selector {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: var(--space-4);
    padding: var(--space-8) var(--space-6);
    max-width: 1000px;
    margin: 0 auto;
}

.confetti-card {
    position: relative;
    aspect-ratio: 1;
    border-radius: var(--radius-lg);
    overflow: hidden;
    cursor: pointer;
    transition: transform var(--transition), box-shadow var(--transition);
}

.confetti-card:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: var(--shadow-lg);
}

.confetti-card:active {
    transform: scale(0.97);
    transition-duration: var(--duration-fast);
}

/* Mini-mosaic preview filling the card */
.confetti-preview {
    display: grid;
    grid-template-columns: repeat(var(--prev-cols), 1fr);
    width: 100%;
    height: 100%;
    gap: 1px;
}

.confetti-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

/* Label bar at bottom */
.confetti-card-label {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    padding: var(--space-12) var(--space-3) var(--space-3);
    background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, transparent 100%);
    color: #fff;
}

.confetti-card-name {
    font-size: var(--text-base);
    font-weight: 600;
    letter-spacing: -0.01em;
}

.confetti-card-count {
    font-size: var(--text-xs);
    opacity: 0.6;
    font-variant-numeric: tabular-nums;
}

/* ===== Confetti Stage — full viewport mosaic ===== */
.confetti-stage {
    display: flex;
    align-items: center;
    justify-content: center;
    height: calc(100vh - 52px);
    position: relative;
    overflow: hidden;
}

.confetti-back {
    position: absolute;
    top: var(--space-4);
    left: var(--space-4);
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: none;
    background: var(--glass-bg);
    color: var(--text);
    font-size: var(--text-xl);
    cursor: pointer;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background var(--transition), transform var(--transition);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
}

.confetti-back:hover {
    background: var(--glass-bg-hover);
    transform: scale(1.08);
}

.confetti-label {
    position: absolute;
    top: var(--space-4);
    left: 50%;
    transform: translateX(-50%);
    font-size: var(--text-lg);
    font-weight: 600;
    color: var(--text-dim);
    letter-spacing: -0.01em;
    z-index: 10;
    pointer-events: none;
}

.confetti-hint {
    position: absolute;
    bottom: var(--space-6);
    left: 50%;
    transform: translateX(-50%);
    font-size: var(--text-sm);
    color: var(--text-muted);
    z-index: 10;
    pointer-events: none;
    opacity: 0;
    transition: opacity 1s var(--ease-out-quart);
}

.confetti-hint.visible {
    opacity: 1;
}

/* ===== Confetti Mosaic ===== */
.confetti-mosaic {
    display: grid;
    grid-template-columns: repeat(var(--m-cols), 1fr);
    grid-template-rows: repeat(var(--m-rows), 1fr);
    width: min(75vh, 75vw);
    height: min(75vh, 75vw);
    gap: 2px;
    cursor: pointer;
}

/* Settle pulse after assembly */
.confetti-mosaic.assembled {
    animation: confetti-settle 2s var(--ease-out-quart) 1.4s both;
}

@keyframes confetti-settle {
    0%   { transform: scale(1); }
    35%  { transform: scale(1.008); }
    100% { transform: scale(1); }
}

/* Cell: scattered state (default) */
.confetti-cell {
    overflow: hidden;
    transform: translate(var(--sx), var(--sy)) rotate(var(--sr)) scale(0);
    opacity: 0;
    transition: transform 1.2s var(--ease-spring),
                opacity 0.6s var(--ease-out-quart);
    transition-delay: var(--d);
    will-change: transform, opacity;
}

/* Cell: assembled state */
.confetti-mosaic.assembled .confetti-cell {
    transform: translate(0, 0) rotate(0deg) scale(1);
    opacity: 1;
}

/* Cell: scattering out (fast burst) */
.confetti-mosaic.scattering .confetti-cell {
    transform: translate(var(--sx), var(--sy)) rotate(var(--sr)) scale(0);
    opacity: 0;
    transition: transform 0.45s var(--ease-out-expo),
                opacity 0.3s var(--ease-out-quart);
    transition-delay: var(--d-out);
}

.confetti-cell img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform var(--duration-normal) var(--ease-spring);
}

.confetti-cell:hover img {
    transform: scale(1.3);
}

/* ===== Lightbox — Always dark overlay ===== */
.lightbox {
    position: fixed;
    inset: 0;
    z-index: 200;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 1;
    transition: opacity var(--duration-normal) var(--ease-out-quart);
}

.lightbox.hidden {
    opacity: 0;
    pointer-events: none;
}

.lightbox-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.92);
    backdrop-filter: saturate(180%) blur(20px);
    -webkit-backdrop-filter: saturate(180%) blur(20px);
}

.lightbox-content {
    position: relative;
    max-width: 90vw;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    transform: scale(1) translateY(0);
    transition: transform var(--duration-slow) var(--ease-out-expo),
                opacity var(--duration-normal) var(--ease-out-quart);
}

.lightbox.hidden .lightbox-content {
    transform: scale(0.95) translateY(12px);
    opacity: 0;
}

.lightbox-close {
    position: absolute;
    top: -32px;
    right: 0;
    background: none;
    border: none;
    color: rgba(255, 255, 255, 0.7);
    font-size: 24px;
    cursor: pointer;
    font-family: var(--font);
    transition: color var(--transition);
}

.lightbox-close:hover { color: rgb(255, 255, 255); }

.lightbox-img {
    max-width: 90vw;
    max-height: 75vh;
    object-fit: contain;
    border-radius: var(--radius);
}

.lightbox-meta {
    padding: var(--space-4) 0;
    max-width: 600px;
    text-align: center;
}

.lightbox-alt {
    font-size: 14px;
    color: rgba(255, 255, 255, 0.7);
    font-style: italic;
    margin-bottom: var(--space-2_5);
    line-height: 1.6;
}

.lightbox-tags {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: var(--space-1_5);
    margin-bottom: var(--space-2);
}

/* Force light text in lightbox (always dark backdrop) */
.lightbox-tags .glass-tag {
    color: rgba(255, 255, 255, 0.85);
    border-color: rgba(255, 255, 255, 0.15);
    background: rgba(255, 255, 255, 0.06);
}

.lightbox-palette {
    display: flex;
    justify-content: center;
    gap: var(--space-1_5);
}

.lightbox-palette .palette-dot {
    border-color: rgba(255, 255, 255, 0.15);
}

/* ===== Loading — simple text indicator ===== */
.loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--space-4);
    height: calc(100vh - 52px);
    color: var(--text-muted);
    font-size: 14px;
    font-family: var(--font-display);
}

.loading.error {
    color: var(--color-error);
}

/* ===== Scrollbar ===== */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb {
    background: var(--fill-tertiary);
    border-radius: 3px;
}
::-webkit-scrollbar-thumb:hover {
    background: var(--fill-primary);
}

/* ===== Utility: Clickable Images ===== */
.clickable-img { cursor: pointer; }

/* ===== Utility: Color Swatch (small inline dot) ===== */
.color-swatch-sm {
    display: inline-block;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    margin-right: var(--space-2);
    vertical-align: middle;
}

/* ===== Utility: Empty State ===== */
.empty-state {
    padding: var(--space-10);
    color: var(--text-muted);
    text-align: center;
}

/* ===== Responsive ===== */
@media (max-width: 768px) {
    #header {
        flex-direction: column;
        gap: var(--space-2);
        padding: var(--space-2_5) var(--space-4);
    }

    .launcher-title { font-size: var(--text-4xl); }
    .launcher-grid { grid-template-columns: 1fr 1fr; gap: var(--space-2); }

    .drift-neighbors { grid-template-columns: repeat(2, 1fr); }
    .grid-container { padding: var(--space-2); }

    .bento-wrap { padding: var(--space-5); }
    .jeu-pair { grid-template-columns: 1fr 1fr; } /* keep side-by-side on mobile too */

    /* Couleurs: adjust padding on mobile */
    .couleurs-wrap { padding: var(--space-3); gap: var(--space-2_5); }

    /* Compass stays as cross on mobile — arms just get thinner */

    /* Domino: tighter padding on mobile */
    .domino-bento { padding: var(--space-2_5); gap: 3px; }

    /* Faces: smaller padding */
    .faces-container { padding: var(--space-3); gap: var(--space-2_5); }
    .faces-filter-bar { gap: var(--space-1); }
    .faces-filter-btn { padding: var(--space-1) var(--space-3); font-size: var(--text-caption); }

    /* NYU: adjust nav and grid */
    .nyu-nav { bottom: var(--space-4); padding: var(--space-1_5) var(--space-2_5); }
    .nyu-nav-btn { width: 38px; height: 38px; font-size: 17px; }
    .nyu-reel { gap: var(--space-4); padding: 0 var(--space-4); }
    .nyu-reel-item img { max-width: 90vw; }
    .nyu-grid-row[data-type="hero"] .nyu-grid-cell { height: 40vh; }
    .nyu-grid-row[data-type="pair"] .nyu-grid-cell { height: 28vh; }
    .nyu-grid-row[data-type="triplet"] .nyu-grid-cell { height: 20vh; }
    .nyu-mosaic { width: min(90vh, 90vw); height: min(90vh, 90vw); }
    .confetti-selector { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); padding: var(--space-4); gap: var(--space-3); }
    .confetti-mosaic { width: min(88vh, 88vw); height: min(88vh, 88vw); }
    .confetti-label { font-size: var(--text-base); }
}

/* ===== Content Visibility — off-screen sections don't render ===== */
.view:not(.active) {
    content-visibility: hidden;
}

/* ===== Reduced Motion — respect accessibility preference ===== */
@media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }
    .grid-item:hover img { transform: none; }
    .exp-card:hover { transform: none; box-shadow: none !important; }
    .drift-neighbor:hover { transform: none; box-shadow: none; }
    .glass-tag:hover { transform: none; }
    .compass-arm:hover .compass-arm-img { opacity: 0.35; }
    .domino-conn:hover img { opacity: 0.35; }
    .face-card:hover { transform: none; box-shadow: none; }
    .map-strip-card:hover { transform: none; box-shadow: none; }
    .nyu-card { transition-duration: 0.01ms !important; }
    .nyu-card-exit, .nyu-card-exit-left { transition-duration: 0.01ms !important; }
    .nyu-mosaic-cell { transition-duration: 0.01ms !important; }
    .nyu-mosaic.assembled { animation-duration: 0.01ms !important; }
    .confetti-cell { transition-duration: 0.01ms !important; }
    .confetti-mosaic.assembled { animation-duration: 0.01ms !important; }
    .confetti-mosaic.scattering .confetti-cell { transition-duration: 0.01ms !important; }
}
