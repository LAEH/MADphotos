/* ===== Reset & Base ===== */
*,
*::before,
*::after {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

/* ============================================================
   DESIGN TOKENS ‚Äî Minimal Black & White
   Typography does the work. Space is the luxury.
   Color only where it carries meaning.
   ============================================================ */
:root {
  /* ‚îÄ‚îÄ Apple System Colors (Light) ‚Äî kept for semantic use only ‚îÄ‚îÄ */
  --system-red: rgb(255, 59, 48);
  --system-orange: rgb(255, 149, 0);
  --system-yellow: rgb(255, 204, 0);
  --system-green: rgb(52, 199, 89);
  --system-mint: rgb(0, 199, 190);
  --system-teal: rgb(48, 176, 199);
  --system-cyan: rgb(50, 173, 230);
  --system-blue: rgb(0, 122, 255);
  --system-indigo: rgb(88, 86, 214);
  --system-purple: rgb(175, 82, 222);
  --system-pink: rgb(255, 45, 85);
  --system-brown: rgb(162, 132, 94);

  /* ‚îÄ‚îÄ Grays (Light) ‚îÄ‚îÄ */
  --system-gray: rgb(142, 142, 147);
  --system-gray-2: rgb(174, 174, 178);
  --system-gray-3: rgb(199, 199, 204);
  --system-gray-4: rgb(209, 209, 214);
  --system-gray-5: rgb(229, 229, 234);
  --system-gray-6: rgb(242, 242, 247);

  /* ‚îÄ‚îÄ Surfaces ‚Äî Light ‚îÄ‚îÄ */
  --bg: #ffffff;
  --bg-elevated: #f5f5f5;
  --bg-tertiary: #ebebeb;
  --text: #000000;
  --text-dim: #6e6e73;
  --text-muted: #aeaeb2;
  --header-bg: rgba(255, 255, 255, 0.88);
  --separator: rgba(0, 0, 0, 0.08);

  /* ‚îÄ‚îÄ Glass ‚Äî neutral ‚îÄ‚îÄ */
  --glass-bg: rgba(120, 120, 128, 0.04);
  --glass-bg-hover: rgba(120, 120, 128, 0.08);
  --glass-border: rgba(0, 0, 0, 0.08);
  --glass-border-hover: rgba(0, 0, 0, 0.18);

  /* ‚îÄ‚îÄ Fill Colors ‚îÄ‚îÄ */
  --fill-primary: rgba(120, 120, 128, 0.2);
  --fill-secondary: rgba(120, 120, 128, 0.16);
  --fill-tertiary: rgba(118, 118, 128, 0.12);
  --fill-quaternary: rgba(116, 116, 128, 0.08);

  /* ‚îÄ‚îÄ Elevation ‚îÄ‚îÄ */
  --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.06);
  --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.08);
  --shadow-lg: 0 12px 28px rgba(0, 0, 0, 0.1), 0 4px 10px rgba(0, 0, 0, 0.04);
  --shadow-elevated:
    0 4px 16px rgba(0, 0, 0, 0.08), 0 12px 40px rgba(0, 0, 0, 0.06);
  --shadow-bento:
    0 4px 16px rgba(0, 0, 0, 0.12), 0 12px 40px rgba(0, 0, 0, 0.08),
    0 24px 80px rgba(0, 0, 0, 0.06);
  --shadow-float: 0 8px 32px rgba(0, 0, 0, 0.15);
  --shadow-deck: 0 8px 32px rgba(0, 0, 0, 0.3);

  /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
  --radius-xs: 4px;
  --radius-sm: 6px;
  --radius: 8px;
  --radius-lg: 12px;
  --radius-xl: 16px;
  --radius-full: 9999px;

  /* ‚îÄ‚îÄ Spacing Scale ‚îÄ‚îÄ */
  --space-0_5: 2px;
  --space-1: 4px;
  --space-1_5: 6px;
  --space-2: 8px;
  --space-2_5: 10px;
  --space-3: 12px;
  --space-3_5: 14px;
  --space-4: 16px;
  --space-4_5: 18px;
  --space-5: 20px;
  --space-6: 24px;
  --space-7: 28px;
  --space-8: 32px;
  --space-10: 40px;
  --space-12: 48px;
  --space-16: 64px;
  --space-20: 80px;

  /* ‚îÄ‚îÄ Type Scale ‚îÄ‚îÄ */
  --text-2xs: 10px;
  --text-xs: 11px;
  --text-caption: 12px;
  --text-sm: 13px;
  --text-base: 15px;
  --text-lg: 17px;
  --text-xl: 20px;
  --text-2xl: 22px;
  --text-3xl: 28px;
  --text-4xl: 34px;
  --text-5xl: 48px;
  --text-6xl: 64px;

  /* ‚îÄ‚îÄ Motion ‚Äî Apple HIG curves ‚îÄ‚îÄ */
  --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
  --ease-out-quart: cubic-bezier(0.25, 1, 0.5, 1);
  --ease-in-out: cubic-bezier(0.45, 0, 0.15, 1);
  --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --duration-slow: 400ms;
  --transition: var(--duration-normal) var(--ease-out-quart);

  /* ‚îÄ‚îÄ Typography ‚îÄ‚îÄ */
  --font:
    -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue",
    system-ui, sans-serif;
  --font-mono:
    "SF Mono", ui-monospace, "Fira Code", "JetBrains Mono", monospace;
  --font-display:
    -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue",
    system-ui, sans-serif;

  /* ‚îÄ‚îÄ Category colors ‚Äî monochrome ‚îÄ‚îÄ */
  --c-vibe: var(--text-dim);
  --c-grading: var(--text-dim);
  --c-time: var(--text-dim);
  --c-setting: var(--text-dim);
  --c-scene: var(--text-dim);
  --c-emotion: var(--text-dim);
  --c-camera: var(--text-dim);
  --c-style: var(--text-dim);

  /* ‚îÄ‚îÄ Emotion colors ‚Äî kept for Faces (semantic) ‚îÄ‚îÄ */
  --emo-happy: var(--system-green);
  --emo-sad: var(--system-cyan);
  --emo-angry: var(--system-red);
  --emo-surprise: var(--system-orange);
  --emo-fear: var(--system-purple);
  --emo-disgust: var(--system-gray);
  --emo-neutral: var(--system-gray-2);
  --emo-contempt: var(--system-pink);

  /* ‚îÄ‚îÄ Semantic colors ‚îÄ‚îÄ */
  --color-error: var(--system-red);
  --color-success: var(--system-green);

  /* ‚îÄ‚îÄ Depth layer visualization ‚îÄ‚îÄ */
  --depth-near: rgba(50, 173, 230, 0.5);
  --depth-mid: rgba(52, 199, 89, 0.3);
  --depth-far: rgba(255, 59, 48, 0.3);
}

/* ============================================================
   DARK MODE ‚Äî toggled via .dark class on <html>
   ============================================================ */
:root.dark {
  --system-red: rgb(255, 69, 58);
  --system-orange: rgb(255, 159, 10);
  --system-yellow: rgb(255, 214, 10);
  --system-green: rgb(48, 209, 88);
  --system-mint: rgb(99, 230, 226);
  --system-teal: rgb(64, 200, 224);
  --system-cyan: rgb(100, 210, 255);
  --system-blue: rgb(10, 132, 255);
  --system-indigo: rgb(94, 92, 230);
  --system-purple: rgb(191, 90, 242);
  --system-pink: rgb(255, 55, 95);
  --system-brown: rgb(172, 142, 104);

  --system-gray: rgb(142, 142, 147);
  --system-gray-2: rgb(99, 99, 102);
  --system-gray-3: rgb(72, 72, 74);
  --system-gray-4: rgb(58, 58, 60);
  --system-gray-5: rgb(44, 44, 46);
  --system-gray-6: rgb(28, 28, 30);

  --bg: #000000;
  --bg-elevated: #1c1c1e;
  --bg-tertiary: #2c2c2e;
  --text: #f5f5f7;
  --text-dim: #8e8e93;
  --text-muted: #636366;
  --header-bg: rgba(0, 0, 0, 0.88);
  --separator: rgba(255, 255, 255, 0.06);

  --glass-bg: rgba(255, 255, 255, 0.06);
  --glass-bg-hover: rgba(255, 255, 255, 0.12);
  --glass-border: rgba(255, 255, 255, 0.08);
  --glass-border-hover: rgba(255, 255, 255, 0.18);

  --fill-primary: rgba(120, 120, 128, 0.36);
  --fill-secondary: rgba(120, 120, 128, 0.32);
  --fill-tertiary: rgba(118, 118, 128, 0.24);
  --fill-quaternary: rgba(118, 118, 128, 0.18);

  --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.2);
  --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.3);
  --shadow-lg: 0 12px 28px rgba(0, 0, 0, 0.5);
  --shadow-elevated:
    0 4px 16px rgba(0, 0, 0, 0.2), 0 12px 40px rgba(0, 0, 0, 0.15);
  --shadow-bento:
    0 4px 16px rgba(0, 0, 0, 0.3), 0 12px 40px rgba(0, 0, 0, 0.2),
    0 24px 80px rgba(0, 0, 0, 0.15);
  --shadow-float: 0 8px 32px rgba(0, 0, 0, 0.4);
  --shadow-deck: 0 8px 32px rgba(0, 0, 0, 0.5);

  --depth-near: rgba(100, 210, 255, 0.5);
  --depth-mid: rgba(48, 209, 88, 0.3);
  --depth-far: rgba(255, 69, 58, 0.3);
}

/* All experiences use the active theme (light/dark) ‚Äî no forced overrides. */

/* ============================================================
   ANIMATIONS ‚Äî Only functional ones
   ============================================================ */
@keyframes fade-up {
  from {
    opacity: 0;
    transform: translateY(16px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

@keyframes blink {
  50% {
    opacity: 0;
  }
}

/* ‚îÄ‚îÄ Image loading transitions ‚îÄ‚îÄ
   Two-phase loading: start invisible, fade in once fully loaded.
   .img-loading  = not yet loaded (opacity 0, !important to beat
                    any specificity on the element's resting state)
   .img-loaded   = fully decoded, fade to 1. Class is auto-removed
                    after the transition ends (in JS) so it does not
                    permanently override other transitions on the
                    same element (e.g. grid-item img hover scale). */
.img-loading {
  opacity: 0 !important;
  transform: scale(1.04);
}
.img-loaded {
  opacity: 1;
  transform: scale(1);
  transition:
    opacity 500ms var(--ease-out-quart),
    transform 500ms var(--ease-out-quart) !important;
}

/* Blur-up placeholder: micro image blurred, crossfades to target */
.img-blur-up {
  filter: blur(8px);
  transform: scale(1.05);
  transition:
    filter 0.3s ease-out,
    transform 0.3s ease-out;
}

/* Face crop canvases: same two-phase pattern */
.face-crop-loading {
  opacity: 0;
}
.face-crop-loaded {
  opacity: 1;
  transition: opacity var(--duration-slow) var(--ease-out-quart);
}

/* ===== Base ===== */
html {
  scroll-behavior: smooth;
}

body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--font);
  font-size: 14px;
  line-height: 1.5;
  min-height: 100vh;
  min-height: 100dvh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  padding: env(safe-area-inset-top) env(safe-area-inset-right)
    env(safe-area-inset-bottom) env(safe-area-inset-left);
  overflow-wrap: break-word;
  -webkit-text-size-adjust: 100%;
}

/* ===== Floating Nav Pill ===== */
.floating-nav {
  position: fixed;
  top: 12px;
  left: 12px;
  z-index: 100;
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 16px;
  background: rgba(255, 255, 255, 0.98);
  border: 1px solid rgba(0, 0, 0, 0.08);
  border-radius: 14px;
  box-shadow:
    0 2px 20px rgba(0, 0, 0, 0.08),
    0 0 0 1px rgba(0, 0, 0, 0.02) inset;
  transition: border-radius 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

:root.dark .floating-nav {
  background: rgba(20, 20, 20, 0.98);
  border-color: rgba(255, 255, 255, 0.08);
  box-shadow:
    0 2px 20px rgba(0, 0, 0, 0.3),
    0 0 0 1px rgba(255, 255, 255, 0.03) inset;
}

/* When menu is open, remove bottom border-radius to connect with menu */
.floating-nav.menu-expanded {
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
  border-bottom: none;
}

/* Menu button - contains logo + chevron */
.menu-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 0;
  background: none;
  border: none;
  color: #1c1c1e;
  cursor: pointer;
  border-radius: 8px;
  transition: opacity 0.15s;
  flex-shrink: 0;
}
:root.dark .menu-btn {
  color: #e5e5e7;
}
.menu-btn:hover {
  opacity: 0.7;
}
.menu-icon {
  display: none; /* Hide hamburger on desktop, show chevron instead */
}
.menu-chevron {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 20px;
  height: 20px;
  color: rgba(0, 0, 0, 0.4);
  flex-shrink: 0;
  transform: rotate(-90deg); /* Point left when collapsed (default) */
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
:root.dark .menu-chevron {
  color: rgba(255, 255, 255, 0.4);
}
/* Chevron points down when menu is open */
.menu-btn.menu-open .menu-chevron {
  transform: rotate(0deg); /* Point down when expanded */
}
.menu-btn-label {
  display: none; /* Still hidden on desktop */
}

.logo {
  font-family:
    -apple-system, BlinkMacSystemFont, "SF Pro Display", system-ui, sans-serif;
  font-size: 15px;
  letter-spacing: -0.3px;
  color: #1c1c1e;
  text-decoration: none;
  cursor: pointer;
  pointer-events: none; /* Let button handle clicks */
  transition: opacity 0.15s;
  font-weight: 700;
}

:root.dark .logo {
  color: #e5e5e7;
}

.logo-mad {
  font-weight: 900;
  letter-spacing: -0.06em;
}

.logo-photos {
  font-weight: 400;
}

.nav-exp-label {
  display: inline-block;
  font-family:
    -apple-system, BlinkMacSystemFont, "SF Pro Display", system-ui, sans-serif;
  font-size: 13px;
  font-weight: 500;
  letter-spacing: -0.2px;
  color: rgba(0, 0, 0, 0.4);
  margin-left: 4px;
  padding-left: 12px;
  border-left: 1px solid rgba(0, 0, 0, 0.08);
}

:root.dark .nav-exp-label {
  color: rgba(255, 255, 255, 0.4);
  border-left-color: rgba(255, 255, 255, 0.08);
}

/* Show sun in dark mode, moon in light mode */
.theme-icon-sun {
  display: none;
}
.theme-icon-moon {
  display: block;
}
:root.dark .theme-icon-sun {
  display: block;
}
:root.dark .theme-icon-moon {
  display: none;
}

/* Show expand icon normally, collapse in fullscreen */
.fs-icon-expand {
  display: block;
}
.fs-icon-collapse {
  display: none;
}
:root.is-fullscreen .fs-icon-expand {
  display: none;
}
:root.is-fullscreen .fs-icon-collapse {
  display: block;
}

/* Tabs */
.tabs {
  display: flex;
  gap: var(--space-0_5);
}

.tab {
  background: transparent;
  border: 1px solid transparent;
  color: var(--text-dim);
  font-family: var(--font);
  font-size: var(--text-sm);
  padding: var(--space-1_5) var(--space-4);
  cursor: pointer;
  border-radius: var(--radius);
  transition:
    background var(--transition),
    color var(--transition),
    border-color var(--transition);
}

/* hover: see @media (hover: hover) guard */

.tab.active {
  color: var(--text);
  background: var(--glass-bg-hover);
  border-color: var(--glass-border);
}

/* ===== Views ===== */
#main {
  padding: 0;
}

.view {
  display: none;
  min-height: 100vh;
  min-height: 100dvh;
}

.view.active {
  display: block;
  animation: fade-up 0.4s var(--ease-out-expo) both;
}

/* ===== Side Menu ‚Äî Floating popover ===== */
.side-menu-backdrop {
  position: fixed;
  inset: 0;
  z-index: 90;
  background: transparent; /* No backdrop tint for collapsible menu */
  opacity: 0;
  pointer-events: none;
  transition: opacity var(--duration-normal) var(--ease-out-quart);
}

.side-menu-backdrop.open {
  opacity: 1;
  pointer-events: auto;
}

.side-menu {
  position: fixed;
  top: 48px; /* Align right below floating-nav */
  left: 12px;
  z-index: 99;
  width: 200px;
  max-height: 0;
  overflow: hidden;
  background: rgba(255, 255, 255, 0.98);
  border: 1px solid rgba(0, 0, 0, 0.08);
  border-top: none; /* Remove top border to connect with floating-nav */
  border-radius: 0 0 14px 14px; /* Only bottom corners rounded */
  box-shadow:
    0 2px 20px rgba(0, 0, 0, 0.08),
    0 0 0 1px rgba(0, 0, 0, 0.02) inset;
  padding: 0 8px;
  opacity: 0;
  pointer-events: none;
  transition:
    max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1),
    opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1),
    padding 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

:root.dark .side-menu {
  background: rgba(20, 20, 20, 0.98);
  border-color: rgba(255, 255, 255, 0.08);
  box-shadow:
    0 2px 20px rgba(0, 0, 0, 0.3),
    0 0 0 1px rgba(255, 255, 255, 0.03) inset;
}

.side-menu.open {
  max-height: calc(100vh - 64px);
  padding: 8px;
  opacity: 1;
  pointer-events: auto;
  overflow-y: auto;
  transition:
    max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1),
    opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1),
    padding 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.side-menu-list {
  list-style: none;
  display: flex;
  flex-direction: column;
  gap: 0;
}

.side-menu-item {
  font-family:
    -apple-system, BlinkMacSystemFont, "SF Pro Display", system-ui, sans-serif;
  font-size: 13px;
  font-weight: 400;
  color: rgba(0, 0, 0, 0.55);
  padding: 8px 14px;
  margin: 1px 0;
  border-radius: 8px;
  cursor: pointer;
  transition:
    background 0.15s,
    color 0.15s;
  white-space: nowrap;
  line-height: 1.2;
}

:root.dark .side-menu-item {
  color: rgba(255, 255, 255, 0.55);
}

.side-menu-item:hover {
  background: rgba(0, 0, 0, 0.05);
  color: rgba(0, 0, 0, 0.85);
  text-decoration: none;
}

:root.dark .side-menu-item:hover {
  background: rgba(255, 255, 255, 0.08);
  color: rgba(255, 255, 255, 0.95);
}

.side-menu-item.active {
  color: #0a84ff;
  font-weight: 600;
  background: rgba(10, 132, 255, 0.12);
}

:root.dark .side-menu-item.active {
  color: #0a84ff;
  background: rgba(10, 132, 255, 0.12);
}

.side-menu-state {
  height: 1px;
  background: rgba(0, 0, 0, 0.08);
  margin: 6px 14px;
}

:root.dark .side-menu-state {
  background: rgba(255, 255, 255, 0.08);
}

.side-menu-group {
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--text-muted);
  padding-left: 12px;
  padding-bottom: 2px;
}

.side-menu-footer {
  display: flex;
  flex-direction: column;
  gap: 0;
  margin-top: var(--space-1);
  padding-top: var(--space-1);
  border-top: 1px solid var(--separator);
}

.side-menu-action {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  width: 100%;
  padding: 6px 12px;
  background: none;
  border: none;
  border-radius: var(--radius-sm);
  font-family: var(--font);
  font-size: var(--text-sm);
  color: var(--text-dim);
  cursor: pointer;
  transition:
    background var(--duration-fast) var(--ease-out-quart),
    color var(--duration-fast) var(--ease-out-quart);
}

/* ===== Glass Tags ‚Äî Monochrome Default ===== */
.glass-tag {
  display: inline-flex;
  align-items: center;
  gap: var(--space-1);
  padding: var(--space-1) var(--space-3);
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
  font-size: var(--text-xs);
  color: var(--text-dim);
  cursor: pointer;
  transition:
    background var(--duration-fast) var(--ease-out-quart),
    border-color var(--duration-fast) var(--ease-out-quart);
  white-space: nowrap;
  user-select: none;
  text-transform: capitalize;
}

/* hover: see @media (hover: hover) guard */

.glass-tag.active {
  background: var(--fill-secondary);
  border-color: var(--glass-border-hover);
  color: var(--text);
}

/* Category tags ‚Äî all monochrome */
.glass-tag.tag-vibe,
.glass-tag.tag-grading,
.glass-tag.tag-time,
.glass-tag.tag-setting,
.glass-tag.tag-scene,
.glass-tag.tag-emotion,
.glass-tag.tag-camera,
.glass-tag.tag-style {
  border-color: var(--glass-border);
  color: var(--text-dim);
}

/* category tag hover: see @media (hover: hover) guard */

.glass-tag.tag-vibe.active,
.glass-tag.tag-grading.active,
.glass-tag.tag-time.active,
.glass-tag.tag-setting.active,
.glass-tag.tag-scene.active,
.glass-tag.tag-emotion.active,
.glass-tag.tag-camera.active,
.glass-tag.tag-style.active {
  background: var(--fill-secondary);
  border-color: var(--glass-border-hover);
  color: var(--text);
}

/* Exception: tags inside Faces keep emotion colors */
.faces-container .glass-tag.tag-emotion {
  border-color: color-mix(in srgb, var(--system-pink) 35%, transparent);
  color: var(--system-pink);
}
/* hover: see @media (hover: hover) guard */

.glass-tag .dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  flex-shrink: 0;
}

/* ===== Filter Bar ===== */
.filter-bar {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: var(--space-1_5);
  padding: var(--space-3) var(--space-6);
  min-height: 44px;
  border-bottom: 1px solid var(--separator);
}

.filter-bar .filter-label {
  font-size: var(--text-xs);
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin-right: var(--space-1);
}

.filter-bar .clear-btn {
  font-family: var(--font);
  font-size: var(--text-xs);
  color: var(--text-dim);
  background: none;
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-sm);
  padding: 3px var(--space-2_5);
  cursor: pointer;
  transition:
    background var(--transition),
    border-color var(--transition),
    color var(--transition);
}

/* hover: see @media (hover: hover) guard */

.filter-count {
  font-size: var(--text-caption);
  color: var(--text-dim);
  margin-left: auto;
  font-variant-numeric: tabular-nums;
}

/* ===== Sort (was La Grille) ===== */
.sort-bar {
  display: flex;
  justify-content: center;
  padding: var(--space-4) var(--space-6);
  position: sticky;
  top: 0;
  z-index: 10;
}

.sort-bar-inner {
  display: flex;
  align-items: center;
  gap: var(--space-0_5);
  padding: var(--space-1_5) var(--space-2_5);
  background: rgba(230, 230, 230, 0.35);
  backdrop-filter: saturate(150%) blur(40px);
  -webkit-backdrop-filter: saturate(150%) blur(40px);
  border: 1px solid var(--glass-border-hover);
  border-radius: var(--radius-full);
  box-shadow: var(--shadow-sm);
}

:root.dark .sort-bar-inner {
  background: rgba(28, 28, 30, 0.6);
}

.sort-btn {
  font-family: var(--font);
  font-size: var(--text-xs);
  color: var(--text);
  opacity: 0.55;
  background: transparent;
  border: none;
  border-radius: var(--radius-full);
  padding: var(--space-1_5) var(--space-3_5);
  cursor: pointer;
  transition:
    background var(--transition),
    color var(--transition),
    opacity var(--transition);
  white-space: nowrap;
}

/* hover: see @media (hover: hover) guard */

.sort-btn.active {
  color: var(--text);
  opacity: 1;
  background: rgba(255, 255, 255, 0.9);
  box-shadow: var(--shadow-sm);
}

:root.dark .sort-btn.active {
  background: rgba(255, 255, 255, 0.12);
}

.sort-sep {
  width: 1px;
  height: 20px;
  background: var(--glass-border);
  margin: 0 var(--space-1);
  flex-shrink: 0;
}

.sort-size-btn {
  font-family: var(--font-mono);
  font-size: var(--text-sm);
  font-weight: 600;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: none;
  background: transparent;
  color: var(--text);
  opacity: 0.45;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition:
    background var(--transition),
    color var(--transition),
    opacity var(--transition);
}

/* hover: see @media (hover: hover) guard */

.sort-size-btn.active {
  color: var(--text);
  opacity: 1;
  background: rgba(255, 255, 255, 0.9);
  box-shadow: var(--shadow-sm);
}

:root.dark .sort-size-btn.active {
  background: rgba(255, 255, 255, 0.12);
}

.sort-grid-wrap {
  max-width: 1100px;
  margin: 0 auto;
  padding: 0 var(--space-6) var(--space-20);
}

.grid-container {
  padding: var(--space-2);
}

.grid {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-1);
}

.grid-item {
  position: relative;
  overflow: hidden;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition:
    opacity var(--transition),
    transform var(--transition);
  flex-grow: 1;
}

.grid-item img {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform var(--duration-slow) var(--ease-out-expo);
}

/* hover: see @media (hover: hover) guard */

/* Overlay gradient ‚Äî always dark (on images) */
.grid-item .grid-overlay {
  position: absolute;
  inset: 0;
  background: linear-gradient(to top, rgba(0, 0, 0, 0.7) 0%, transparent 50%);
  opacity: 0;
  transition: opacity var(--transition);
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  padding: var(--space-2);
  gap: var(--space-1);
  pointer-events: none;
}

/* grid-item hover overlay: in @media (hover: hover) guard. Tap fallback below. */
.grid-item.tapped .grid-overlay {
  opacity: 1;
}

.grid-item .grid-overlay .glass-tag {
  pointer-events: auto;
  /* Force light text in overlay context */
  color: rgba(255, 255, 255, 0.9);
  border-color: rgba(255, 255, 255, 0.2);
  background: rgba(0, 0, 0, 0.3);
}

.grid-overlay-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 3px;
}

.filter-active-section {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-1);
  align-items: center;
}

.grid-item.filtered-out {
  opacity: 0;
  width: 0 !important;
  height: 0 !important;
  margin: 0;
  padding: 0;
  overflow: hidden;
  flex-grow: 0;
  flex-shrink: 1;
  flex-basis: 0;
}

/* Row-based layout */
.grid-row {
  display: flex;
  gap: var(--space-1);
  width: 100%;
}

.grid-row .grid-item {
  flex-grow: 0;
  flex-shrink: 0;
}

/* ===== Similarity / Drift shared ===== */
.drift-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: var(--space-8) var(--space-6);
  min-height: 100vh;
}

.drift-center {
  position: relative;
  max-width: 1000px;
  width: 100%;
  margin-bottom: var(--space-10);
}

.drift-center img {
  width: 100%;
  border-radius: var(--radius);
  display: block;
  border: 1px solid var(--separator);
}

.drift-center-meta {
  padding: var(--space-4) 0;
}

.drift-center-alt {
  font-size: var(--text-base);
  color: var(--text);
  line-height: 1.6;
  margin-bottom: var(--space-3);
  font-style: italic;
}

.drift-center-tags {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-1_5);
}

.drift-center-palette {
  display: flex;
  gap: var(--space-1);
  margin-top: var(--space-2);
}

.palette-dot {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  border: 1px solid var(--glass-border);
}

.drift-neighbors {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--space-3);
  max-width: 1000px;
  width: 100%;
}

.drift-neighbor {
  position: relative;
  cursor: pointer;
  border-radius: var(--radius);
  overflow: hidden;
  border: 1px solid var(--glass-border);
  transition:
    border-color var(--transition),
    transform var(--transition);
  background: var(--bg-elevated);
}

/* hover: see @media (hover: hover) guard */

.drift-neighbor img {
  width: 100%;
  aspect-ratio: 4/3;
  object-fit: cover;
  display: block;
}

.drift-neighbor-label {
  padding: var(--space-2) var(--space-3);
  font-size: var(--text-xs);
  color: var(--text-dim);
  text-transform: capitalize;
}

.drift-score {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 2px;
  background: var(--fill-primary);
  transform-origin: left;
  transform: scaleX(var(--score, 0));
  transition: transform 0.3s var(--ease-out-quart);
}
/* hover: see @media (hover: hover) guard */

.drift-controls {
  display: flex;
  gap: var(--space-3);
  margin-bottom: var(--space-6);
  align-items: center;
}

.drift-btn {
  font-family: var(--font);
  font-size: var(--text-caption);
  color: var(--text-dim);
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius);
  padding: var(--space-1_5) var(--space-3_5);
  cursor: pointer;
  transition:
    background var(--transition),
    border-color var(--transition),
    color var(--transition);
}

/* hover: see @media (hover: hover) guard */

.drift-breadcrumb {
  display: flex;
  align-items: center;
  gap: var(--space-1);
  flex-wrap: wrap;
}

.drift-breadcrumb-item {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  overflow: hidden;
  cursor: pointer;
  border: 1px solid var(--glass-border);
  transition:
    border-color var(--transition),
    transform var(--duration-fast) var(--ease-spring);
  flex-shrink: 0;
}

/* hover: see @media (hover: hover) guard */

.drift-breadcrumb-item.current {
  border-color: var(--text);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--text) 20%, transparent);
}

.drift-breadcrumb-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.drift-breadcrumb-arrow {
  color: var(--text-muted);
  font-size: var(--text-2xs);
  flex-shrink: 0;
}

/* ===== Couleurs (Les Couleurs) ‚Äî Chromatic Bento ===== */
#view-couleurs {
  overflow: hidden;
}

.couleurs-wrap {
  display: flex;
  flex-direction: column;
  height: 100vh;
  padding: var(--space-6);
  gap: var(--space-4);
}

.couleurs-spectrum {
  display: flex;
  height: 28px;
  border-radius: var(--radius-full);
  overflow: hidden;
  flex-shrink: 0;
}

.couleurs-band {
  flex: 1;
  cursor: pointer;
  transition: opacity var(--transition);
  min-width: 2px;
  opacity: 0.4;
}

/* hover: see @media (hover: hover) guard */

.couleurs-band.active {
  opacity: 1;
  flex: 3;
}

.couleurs-card {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 3px;
  border-radius: var(--radius-lg);
  overflow: hidden;
  box-shadow: var(--shadow-bento);
  min-height: 0;
}

.couleurs-row {
  display: flex;
  gap: 3px;
  flex: 1;
  min-height: 0;
}

.couleurs-tile {
  flex: 1;
  overflow: hidden;
  cursor: pointer;
  min-width: 0;
  min-height: 0;
}

.couleurs-tile img {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.couleurs-tile-wide {
  flex: 2;
}

/* ===== Bento (Le Bento) ‚Äî Irregular mosaic grid ===== */
.bento-view {
  overflow: hidden;
}

.bento-wrap {
  display: flex;
  align-items: flex-start;
  justify-content: center;
  height: 100vh;
  padding: 88px var(--space-8) var(--space-8);
  position: relative;
}

.bento-grid {
  display: grid;
  grid-template-columns: repeat(var(--bento-cols, 4), 1fr);
  grid-template-rows: repeat(var(--bento-rows, 3), 1fr);
  gap: 4px;
  border-radius: var(--radius-xl);
  overflow: hidden;
  box-shadow: var(--shadow-bento);
  height: calc(100vh - 120px);
  max-width: calc(100vw - 120px);
}

.bento-tile {
  overflow: hidden;
  cursor: pointer;
  transition: opacity 800ms ease;
  min-width: 0;
  min-height: 0;
  position: relative;
}

.bento-tile img {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Fullscreen icon on hover */
.bento-tile-fs {
  position: absolute;
  bottom: 8px;
  right: 8px;
  width: 36px;
  height: 36px;
  border-radius: 10px;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.5);
  color: #fff;
  cursor: pointer;
  opacity: 0;
  transition:
    opacity 0.2s ease,
    transform 0.15s ease;
  transform: scale(0.9);
  z-index: 2;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}
.bento-tile:hover .bento-tile-fs {
  opacity: 1;
  transform: scale(1);
}

/* Dice button in nav */
.bento-dice-nav {
  display: none;
  font-size: 22px;
  line-height: 1;
  padding: 0;
  padding-left: var(--space-3);
  border: none;
  border-left: 1px solid var(--separator);
  border-radius: 0;
  background: none;
  cursor: pointer;
  transition: transform 0.15s ease;
}

/* Hide old nav arrows */
.bento-nav {
  display: none !important;
}
.bento-regen {
  display: none !important;
}

/* Navigation arrows ‚Äî left/right of grid */
.bento-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: 1px solid var(--glass-border);
  background: var(--glass-bg);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  cursor: pointer;
  font-size: 24px;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-dim);
  z-index: 10;
  transition:
    background var(--transition),
    border-color var(--transition),
    color var(--transition),
    transform var(--duration-fast) var(--ease-spring);
}

/* hover: see @media (hover: hover) guard */

.bento-nav-prev {
  left: var(--space-5);
}
.bento-nav-next {
  right: var(--space-5);
}

/* hover: see @media (hover: hover) guard */

.bento-regen {
  position: fixed;
  bottom: var(--space-6);
  right: var(--space-6);
  width: 48px;
  height: 48px;
  border-radius: 50%;
  border: 1px solid var(--glass-border);
  background: var(--glass-bg);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  cursor: pointer;
  font-size: 22px;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
  transition:
    background var(--transition),
    border-color var(--transition),
    transform var(--duration-fast) var(--ease-spring);
}

/* hover: see @media (hover: hover) guard */

/* ===== Shared: game-title, game-desc, game-start-btn ===== */
.game-title {
  font-family: var(--font-display);
  font-size: var(--text-4xl);
  font-weight: 600;
  letter-spacing: -0.02em;
  margin-bottom: var(--space-3);
}

.game-desc {
  font-size: var(--text-sm);
  color: var(--text-dim);
  margin-bottom: var(--space-8);
}

.game-start-btn {
  font-family: var(--font);
  font-size: var(--text-base);
  color: var(--text);
  background: var(--glass-bg-hover);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius);
  padding: var(--space-3) var(--space-8);
  cursor: pointer;
  transition:
    background var(--transition),
    border-color var(--transition);
}

/* hover: see @media (hover: hover) guard */

.game-end {
  padding: var(--space-12) 0;
  text-align: center;
}

.game-final-score {
  font-family: var(--font-display);
  font-size: var(--text-6xl);
  font-weight: 700;
  margin-bottom: var(--space-1);
  letter-spacing: -0.04em;
}

.game-final-label {
  font-size: var(--text-base);
  color: var(--text-dim);
  margin-bottom: var(--space-6);
}

/* ===== Le Jeu ‚Äî Viewport-fixed image pairs ===== */
#view-game {
  overflow: hidden;
}

.jeu-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  padding: var(--space-6);
  gap: 0;
  position: relative;
}
@media (min-width: 769px) {
  .jeu-container {
    justify-content: flex-start;
    padding: 88px var(--space-8) var(--space-8);
  }
  .jeu-pair {
    max-width: min(75vw, 960px);
    max-height: calc(100vh - 200px);
  }
}

.jeu-pair {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-2);
  max-width: 100%;
  max-height: calc(100vh - 88px);
  min-height: 0;
  flex: 1;
  align-content: center;
  transition:
    opacity 300ms var(--ease-out-quart),
    transform 300ms var(--ease-out-quart);
}

.jeu-pair-exit {
  opacity: 0;
  transform: scale(0.97);
}

.jeu-pair-enter {
  opacity: 0;
  transform: scale(0.97);
}

.jeu-card {
  border-radius: var(--radius-lg);
  overflow: hidden;
  min-height: 0;
  position: relative;
}

/* Hover approve/reject buttons ‚Äî desktop only */
.jeu-card-actions {
  position: absolute;
  bottom: 8px;
  right: 8px;
  display: none;
  gap: 6px;
  z-index: 10;
}

/* Hover actions removed ‚Äî keep clean */

.jeu-card-btn {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  font-size: 15px;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  transition:
    transform 0.15s ease,
    opacity 0.15s ease;
  opacity: 0.85;
}
.jeu-card-btn:hover {
  transform: scale(1.15);
  opacity: 1;
}
.jeu-card-btn:active {
  transform: scale(0.9);
}

.jeu-card-reject {
  background: rgba(220, 38, 38, 0.75);
  color: #fff;
}
.jeu-card-approve {
  background: rgba(22, 163, 74, 0.75);
  color: #fff;
}

.jeu-card-rejected {
  opacity: 0.3;
  transform: scale(0.95);
  transition:
    opacity 0.3s ease,
    transform 0.3s ease;
}
.jeu-card-approved {
  position: relative;
}
.jeu-card-approved::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  box-shadow: inset 0 0 0 3px rgba(22, 163, 74, 0.5);
  opacity: 1;
  animation: jeu-approve-flash 0.5s var(--ease-out-quart) forwards;
  pointer-events: none;
}
@keyframes jeu-approve-flash {
  0% {
    opacity: 0;
  }
  30% {
    opacity: 1;
  }
  100% {
    opacity: 0;
  }
}

.jeu-img {
  width: 100%;
  height: 100%;
  aspect-ratio: 3/2;
  object-fit: cover;
  display: block;
}

/* Bento layout ‚Äî portrait + landscape, matched height.
   Column ratio 4:9 makes both aspect ratios yield identical height:
   portrait 2/3 at 4fr ‚Üí h = 4√ó(3/2) = 6, landscape 3/2 at 9fr ‚Üí h = 9√ó(2/3) = 6 */
.jeu-pair-bento {
  grid-template-columns: 4fr 9fr;
}
.jeu-pair-bento .jeu-img-portrait {
  aspect-ratio: 2/3;
}
.jeu-pair-bento .jeu-img-landscape {
  aspect-ratio: 3/2;
}
/* Flip: landscape first, portrait second */
.jeu-pair-bento-flip {
  grid-template-columns: 9fr 4fr;
}
/* Both-portrait layout ‚Äî preserve native aspect ratio, don't crop to landscape */
.jeu-pair-portrait .jeu-img {
  aspect-ratio: 2/3;
}

/* Fixed glass bar at bottom */
.jeu-bar {
  position: fixed;
  bottom: var(--space-6);
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: var(--space-5);
  padding: var(--space-2_5) var(--space-5);
  background: rgba(120, 120, 128, 0.08);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-full);
  backdrop-filter: saturate(180%) blur(20px);
  -webkit-backdrop-filter: saturate(180%) blur(20px);
  z-index: 10;
}

.jeu-btn {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: none;
  background: transparent;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  line-height: 1;
  transition: transform var(--duration-fast) var(--ease-spring);
}

/* hover: see @media (hover: hover) guard */

.jeu-btn:active {
  transform: scale(0.9);
}

/* Favorite button ‚Äî relative for badge positioning */
.jeu-fav-btn {
  position: relative;
}

/* Badge on ‚ù§Ô∏è button */
.jeu-fav-badge {
  position: absolute;
  top: -4px;
  right: -4px;
  min-width: 18px;
  height: 18px;
  padding: 0 5px;
  border-radius: 9px;
  background: #ff3b30;
  color: #fff;
  font-family: var(--font);
  font-size: 11px;
  font-weight: 600;
  line-height: 18px;
  text-align: center;
  pointer-events: none;
}

/* Pulse animation on üëç when saving */
.jeu-btn-pulse {
  animation: jeu-pulse 0.35s ease;
}

@keyframes jeu-pulse {
  0% {
    transform: scale(1);
  }
  40% {
    transform: scale(1.4);
  }
  100% {
    transform: scale(1);
  }
}

/* Favorites overlay */
.jeu-favs-overlay {
  position: fixed;
  inset: 0;
  z-index: 100;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-4);
}

.jeu-favs-inner {
  background: var(--bg-elevated);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-lg);
  width: 100%;
  max-width: 500px;
  max-height: 80vh;
  max-height: 80dvh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.jeu-favs-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-3) var(--space-4);
  border-bottom: 1px solid var(--glass-border);
  font-family: var(--font);
  font-size: var(--text-sm);
  font-weight: 600;
  color: var(--text);
}

.jeu-favs-close {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: none;
  background: var(--fill-secondary);
  color: var(--text-dim);
  font-size: 14px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.jeu-favs-list {
  flex: 1;
  overflow-y: auto;
  padding: var(--space-2);
}

.jeu-fav-row {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2);
  border-radius: var(--radius-md);
  transition: background var(--transition);
}

.jeu-fav-thumb {
  width: 80px;
  height: 60px;
  object-fit: cover;
  border-radius: var(--radius-sm);
  cursor: pointer;
  flex-shrink: 0;
}

.jeu-fav-remove {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: none;
  background: transparent;
  color: var(--text-dim);
  font-size: 12px;
  cursor: pointer;
  flex-shrink: 0;
  margin-left: auto;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0.5;
  transition: opacity var(--transition);
}

.jeu-fav-remove:hover {
  opacity: 1;
}

.jeu-favs-empty {
  padding: var(--space-6) var(--space-4);
  text-align: center;
  font-family: var(--font);
  font-size: var(--text-sm);
  color: var(--text-dim);
}

.jeu-favs-clear {
  margin: var(--space-2) var(--space-4) var(--space-4);
  padding: var(--space-2) var(--space-4);
  border-radius: var(--radius-full);
  border: 1px solid rgba(255, 59, 48, 0.3);
  background: transparent;
  color: #ff3b30;
  font-family: var(--font);
  font-size: var(--text-xs);
  cursor: pointer;
  transition: background var(--transition);
}

.jeu-favs-clear:hover {
  background: rgba(255, 59, 48, 0.08);
}

/* ===== Faces (Les Visages) ‚Äî Viewport-fixed with elevated container ===== */
#view-faces {
  overflow: hidden;
}

.faces-container {
  display: flex;
  flex-direction: column;
  height: 100vh;
  padding: var(--space-5);
  gap: var(--space-4);
}

.faces-filter-bar {
  display: flex;
  justify-content: center;
  gap: var(--space-2);
  flex-shrink: 0;
  flex-wrap: wrap;
}

.faces-filter-btn {
  font-family: var(--font);
  font-size: var(--text-sm);
  color: var(--text-dim);
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-full);
  padding: var(--space-1_5) var(--space-4_5);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: var(--space-1_5);
  transition:
    background var(--transition),
    border-color var(--transition),
    color var(--transition);
}

/* hover: see @media (hover: hover) guard */

.faces-filter-btn.active {
  color: var(--text);
  background: var(--fill-secondary);
  border-color: var(--glass-border-hover);
}

.faces-filter-count {
  font-size: var(--text-2xs);
  font-family: var(--font-mono);
  color: var(--text-muted);
}

.faces-card {
  flex: 1;
  min-height: 0;
  border-radius: var(--radius-lg);
  overflow: hidden;
  display: flex;
  flex-wrap: wrap;
  align-content: center;
  justify-content: center;
  gap: 2px;
  padding: var(--space-3);
  background: var(--bg-elevated);
  box-shadow: var(--shadow-elevated);
}

.face-card {
  width: var(--face-size, 80px);
  height: var(--face-size, 80px);
  border-radius: var(--radius-xs);
  overflow: hidden;
  border: 1px solid var(--glass-border);
  cursor: pointer;
  transition:
    transform var(--duration-fast) var(--ease-spring),
    border-color var(--transition);
}

/* hover: see @media (hover: hover) guard */

.face-crop-canvas {
  width: 100%;
  height: 100%;
  display: block;
}

/* ===== Compass (La Boussole) ‚Äî CSS Grid cross layout ===== */
#view-compass {
  overflow: hidden;
}

.compass-grid {
  display: grid;
  grid-template-areas:
    ".     north  ."
    "west  center east"
    ".     south  .";
  grid-template-columns: 1fr 5fr 1fr;
  grid-template-rows: 1fr 5fr 1fr;
  gap: 2px;
  height: 100vh;
  padding: 0;
  background: var(--bg);
}

/* Arms ‚Äî shared */
.compass-arm {
  position: relative;
  overflow: hidden;
  cursor: pointer;
  border-radius: 0;
  opacity: 0;
}

/* Direction-specific enter transforms */
.compass-north {
  transform: translateY(-20px);
}
.compass-south {
  transform: translateY(20px);
}
.compass-east {
  transform: translateX(20px);
}
.compass-west {
  transform: translateX(-20px);
}

.compass-arm.compass-arm-enter {
  opacity: 1;
  transform: translate(0, 0);
  transition:
    opacity 400ms var(--ease-out-quart),
    transform 400ms var(--ease-out-expo);
}

.compass-arm-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  opacity: 0.35;
  transition: opacity var(--duration-normal) var(--ease-out-quart);
}

.compass-arm-img.img-loaded {
  opacity: 0.35;
}

/* hover: see @media (hover: hover) guard */

.compass-arm-overlay {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--space-1);
  pointer-events: none;
}

.compass-arm-label {
  font-size: var(--text-2xs);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: rgba(255, 255, 255, 0.6);
}

.compass-arm-trait {
  font-size: var(--text-sm);
  color: rgba(255, 255, 255, 0.9);
  font-weight: 500;
}

.compass-arm-empty {
  background: var(--bg-elevated);
}

/* Center hero image */
.compass-center {
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 0;
  min-height: 0;
  overflow: hidden;
  border-radius: 0;
}

.compass-center-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  border-radius: 0;
}

/* Random button */
.compass-random {
  position: fixed;
  bottom: var(--space-6);
  right: var(--space-6);
  font-family: var(--font);
  font-size: var(--text-caption);
  color: var(--text-dim);
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius);
  padding: var(--space-1_5) var(--space-3_5);
  cursor: pointer;
  z-index: 10;
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  transition:
    background var(--transition),
    border-color var(--transition),
    color var(--transition);
}

/* hover: see @media (hover: hover) guard */

/* ===== Observatory (L'Observatoire) ===== */
.observatory-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
  gap: var(--space-4);
  padding: var(--space-6);
}

.obs-panel {
  background: var(--bg-elevated);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius);
  padding: var(--space-5);
}

.obs-panel-title {
  font-size: var(--text-caption);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--text-dim);
  margin-bottom: var(--space-4);
  font-weight: 600;
}

.obs-panel-content {
  display: flex;
  flex-direction: column;
  gap: var(--space-1_5);
}

.obs-bar-row {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  font-size: var(--text-caption);
}

.obs-bar-label {
  color: var(--text);
  min-width: 100px;
  font-size: var(--text-caption);
}

.obs-bar {
  height: 8px;
  background: var(--fill-quaternary);
  border-radius: 4px;
  flex: 1;
  max-width: 200px;
}

/* Neutral fill instead of purple tint */
.obs-bar-style {
  background: var(--fill-tertiary);
}

.obs-bar-count {
  font-size: var(--text-xs);
  color: var(--text-muted);
  min-width: 30px;
  text-align: right;
  font-variant-numeric: tabular-nums;
}

.obs-histogram {
  display: flex;
  align-items: flex-end;
  gap: var(--space-0_5);
  height: 100px;
}

.obs-hist-bar {
  flex: 1;
  background: var(--fill-tertiary);
  border-radius: 2px 2px 0 0;
  min-height: 1px;
  transition: background var(--transition);
}

/* hover: see @media (hover: hover) guard */

.obs-inline-count {
  font-size: var(--text-2xs);
  color: var(--text-muted);
  margin-left: var(--space-0_5);
}

.obs-outlier-row {
  display: flex;
  align-items: center;
  gap: var(--space-2_5);
  padding: var(--space-1_5) 0;
}

.obs-outlier-thumb {
  width: 72px;
  height: 72px;
  border-radius: var(--radius-sm);
  object-fit: cover;
}

.obs-outlier-label {
  font-size: var(--text-caption);
  color: var(--text-dim);
}

/* ===== Map (La Carte) ===== */
.map-container {
  padding: var(--space-6);
}

.map-header {
  font-size: var(--text-sm);
  color: var(--text-dim);
  margin-bottom: var(--space-4);
}

.map-canvas {
  width: 100%;
  max-width: 1200px;
  border-radius: var(--radius);
  border: 1px solid var(--glass-border);
  cursor: crosshair;
}

.map-strip {
  display: flex;
  gap: var(--space-2);
  margin-top: var(--space-4);
  overflow-x: auto;
  padding-bottom: var(--space-2);
}

.map-strip-card {
  flex-shrink: 0;
  width: 180px;
  height: 120px;
  border-radius: var(--radius-sm);
  overflow: hidden;
  border: 1px solid var(--glass-border);
  cursor: pointer;
  transition:
    border-color var(--transition),
    transform var(--transition);
}

/* hover: see @media (hover: hover) guard */

.map-strip-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* ===== NYU ‚Äî Multi-view experience ===== */
#view-nyu {
  overflow: hidden;
}

.nyu-shell {
  position: relative;
  height: 100vh;
  overflow: hidden;
}

.nyu-viewport {
  height: 100%;
  overflow: hidden;
}

/* Nav bar ‚Äî floating glass pill at bottom */
.nyu-nav {
  position: fixed;
  bottom: var(--space-6);
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: var(--space-1);
  padding: var(--space-2) var(--space-3);
  background: rgba(230, 230, 230, 0.35);
  backdrop-filter: saturate(150%) blur(40px);
  -webkit-backdrop-filter: saturate(150%) blur(40px);
  border: 1px solid var(--glass-border-hover);
  border-radius: var(--radius-full);
  box-shadow: var(--shadow-float);
  z-index: 50;
}

:root.dark .nyu-nav {
  background: rgba(28, 28, 30, 0.6);
}

.nyu-nav-btn {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: none;
  background: transparent;
  cursor: pointer;
  font-size: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0.55;
  transition:
    opacity var(--transition),
    background var(--transition);
  position: relative;
}

/* hover: see @media (hover: hover) guard */

.nyu-nav-btn.active {
  opacity: 1;
  background: rgba(255, 255, 255, 0.9);
  box-shadow: var(--shadow-sm);
}

.nyu-nav-btn.active::after {
  content: "";
  position: absolute;
  bottom: -3px;
  left: 50%;
  transform: translateX(-50%);
  width: 4px;
  height: 4px;
  border-radius: 50%;
  background: var(--text);
}

:root.dark .nyu-nav-btn.active {
  background: rgba(255, 255, 255, 0.15);
}

/* Counter */
.nyu-counter {
  font-size: var(--text-sm);
  color: var(--text-muted);
  font-variant-numeric: tabular-nums;
  letter-spacing: 0.02em;
  text-align: center;
  padding: var(--space-4) 0;
}

/* ===== Reel ===== */
.nyu-reel {
  display: flex;
  align-items: center;
  height: 100%;
  overflow-x: auto;
  overflow-y: hidden;
  scroll-snap-type: x mandatory;
  gap: var(--space-8);
  padding: 0 max(var(--space-6), calc(50vw - 250px));
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
}

.nyu-reel::-webkit-scrollbar {
  display: none;
}
.nyu-reel-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  z-index: 10;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: 1px solid var(--glass-border);
  background: var(--glass-bg);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  cursor: pointer;
  font-size: 24px;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-dim);
  transition:
    background var(--transition),
    border-color var(--transition),
    color var(--transition),
    transform var(--duration-fast) var(--ease-spring);
}
.nyu-reel-prev {
  left: var(--space-5);
}
.nyu-reel-next {
  right: var(--space-5);
}
.nyu-reel-counter {
  position: absolute;
  bottom: var(--space-6);
  left: 50%;
  transform: translateX(-50%);
}

.nyu-reel-item {
  scroll-snap-align: center;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius-lg);
  overflow: hidden;
}

.nyu-reel-item img {
  max-height: 80vh;
  max-width: min(600px, 85vw);
  object-fit: contain;
  display: block;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-deck);
}

/* ===== Grid ===== */
.nyu-vp-grid {
  overflow-y: auto;
}

.nyu-grid {
  padding: var(--space-1);
  padding-bottom: 100px;
}

.nyu-grid-row {
  display: flex;
  gap: var(--space-1);
  margin-bottom: var(--space-1);
}

.nyu-grid-row[data-type="hero"] .nyu-grid-cell {
  height: 55vh;
}
.nyu-grid-row[data-type="pair"] .nyu-grid-cell {
  height: 38vh;
}
.nyu-grid-row[data-type="triplet"] .nyu-grid-cell {
  height: 28vh;
}

.nyu-grid-cell {
  flex: 1;
  overflow: hidden;
  border-radius: var(--radius-sm);
  cursor: pointer;
  min-width: 0;
}

.nyu-grid-cell img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  transition: transform var(--duration-slow) var(--ease-out-expo);
}

/* hover: see @media (hover: hover) guard */

/* ===== Deck ===== */
.nyu-vp-deck {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.nyu-accent {
  position: absolute;
  inset: 0;
  pointer-events: none;
  /* No background transition ‚Äî JS crossfades via opacity on child layer */
}
.nyu-accent-layer {
  position: absolute;
  inset: 0;
  transition: opacity 800ms var(--ease-out-quart);
  will-change: opacity;
}

.nyu-stack {
  position: relative;
  width: min(85vw, 700px);
  aspect-ratio: 3/2;
  cursor: pointer;
}

.nyu-card {
  position: absolute;
  inset: 0;
  border-radius: var(--radius-xl);
  overflow: hidden;
  transform-origin: center bottom;
  transform: translateY(calc(var(--card-index) * -14px))
    scale(calc(1 - var(--card-index) * 0.05));
  opacity: calc(1 - var(--card-index) * 0.15);
  transition:
    transform 400ms var(--ease-spring),
    opacity 400ms var(--ease-out-quart);
  box-shadow: var(--shadow-deck);
}

.nyu-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.nyu-card-exit {
  transform: translateX(120%) rotate(8deg) !important;
  opacity: 0 !important;
  transition:
    transform 350ms var(--ease-out-expo),
    opacity 300ms var(--ease-out-quart) !important;
}

.nyu-card-exit-left {
  transform: translateX(-120%) rotate(-8deg) !important;
  opacity: 0 !important;
  transition:
    transform 350ms var(--ease-out-expo),
    opacity 300ms var(--ease-out-quart) !important;
}

/* ===== Canvas ===== */
.nyu-canvas {
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: relative;
  padding: var(--space-10);
  /* No background transition ‚Äî JS crossfades via opacity on child layer */
}
.nyu-canvas-bg {
  position: absolute;
  inset: 0;
  transition: opacity 600ms var(--ease-out-quart);
  will-change: opacity;
  pointer-events: none;
  z-index: 0;
}
.nyu-canvas-img-wrap {
  z-index: 1;
  position: relative;
}

.nyu-canvas-img-wrap {
  display: flex;
  align-items: center;
  justify-content: center;
  flex: 1;
  min-height: 0;
  width: 100%;
}

.nyu-canvas-img {
  max-width: 90%;
  max-height: 75vh;
  object-fit: contain;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-deck);
  cursor: pointer;
  transition: transform var(--duration-fast) var(--ease-spring);
}

/* hover: see @media (hover: hover) guard */

.nyu-canvas-counter {
  color: var(--text-dim);
}

/* ===== Overview ‚Äî Assembled mosaic ===== */
.nyu-vp-overview {
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.nyu-mosaic {
  display: grid;
  grid-template-columns: repeat(var(--m-cols), 1fr);
  grid-template-rows: repeat(var(--m-rows), 1fr);
  width: min(78vh, 78vw);
  height: min(78vh, 78vw);
  gap: 1px;
}

.nyu-mosaic.assembled {
  animation: mosaic-settle 2.4s var(--ease-out-quart) 1.6s both;
}

@keyframes mosaic-settle {
  0% {
    transform: scale(1);
  }
  40% {
    transform: scale(1.006);
  }
  100% {
    transform: scale(1);
  }
}

.nyu-mosaic-cell {
  overflow: hidden;
  cursor: pointer;
  contain: layout style paint;
  transform: translate(var(--sx), var(--sy)) rotate(var(--sr)) scale(0);
  opacity: 0;
  transition:
    transform 1.2s var(--ease-spring),
    opacity 0.6s var(--ease-out-quart);
  transition-delay: var(--d);
  will-change: transform, opacity;
}

.nyu-mosaic.assembled .nyu-mosaic-cell {
  transform: translate(0, 0) rotate(0deg) scale(1);
  opacity: 1;
}

.nyu-mosaic-cell img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  transition:
    transform var(--duration-normal) var(--ease-spring),
    opacity var(--duration-normal) var(--ease-out-quart);
}

/* hover: see @media (hover: hover) guard */

/* ===== Confetti ‚Äî Vertical nav + viewport mosaic ===== */
#view-confetti {
  height: 100vh;
  overflow: hidden;
}

/* Shell: full viewport */
.confetti-shell {
  display: flex;
  height: 100%;
  overflow: hidden;
  position: relative;
}

/* Mosaic wrapper */
.confetti-mosaic-wrap {
  position: relative;
}

/* ===== Confetti Radial Dial ===== */
.confetti-dial {
  position: absolute;
  left: var(--space-5);
  top: 50%;
  translate: 0 -50%;
  width: 160px;
  height: 160px;
  z-index: 20;
  pointer-events: none;
}

/* Bomb ‚Äî center of the dial */
.confetti-bomb {
  position: absolute;
  left: 50%;
  top: 50%;
  translate: -50% -50%;
  width: 52px;
  height: 52px;
  border-radius: 50%;
  border: 1px solid var(--glass-border);
  background: var(--glass-bg);
  backdrop-filter: blur(20px) saturate(1.4);
  -webkit-backdrop-filter: blur(20px) saturate(1.4);
  cursor: pointer;
  font-size: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: var(--shadow-md);
  transition: transform var(--duration-normal) var(--ease-spring);
  z-index: 2;
  pointer-events: auto;
}

.confetti-bomb:active {
  transform: scale(0.92);
}

/* Orbiting emoji buttons */
.confetti-dial-btn {
  position: absolute;
  left: 50%;
  top: 50%;
  width: 34px;
  height: 34px;
  margin: -17px 0 0 -17px;
  border-radius: 50%;
  border: none;
  background: transparent;
  cursor: pointer;
  font-size: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0.45;
  transition:
    opacity var(--transition),
    background var(--transition);
  transform: rotate(var(--dial-angle)) translateX(66px)
    rotate(calc(-1 * var(--dial-angle)));
  pointer-events: auto;
}

.confetti-dial-btn.active {
  opacity: 1;
  background: var(--fill-secondary);
  box-shadow: var(--shadow-sm);
}

/* Viewport: flex center for mosaic */
.confetti-viewport {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: relative;
  min-width: 0;
}

/* Label at bottom center */
.confetti-label {
  position: absolute;
  bottom: var(--space-6);
  left: 50%;
  transform: translateX(-50%);
  font-size: var(--text-sm);
  font-weight: 500;
  color: var(--text-muted);
  letter-spacing: 0.02em;
  pointer-events: none;
}

/* ===== Confetti Mosaic ===== */
.confetti-mosaic {
  display: grid;
  grid-template-columns: repeat(var(--m-cols), 1fr);
  grid-template-rows: repeat(var(--m-rows), 1fr);
  width: min(75vh, 75vw);
  height: min(75vh, 75vw);
  gap: 2px;
  cursor: pointer;
}

/* Settle pulse after assembly */
.confetti-mosaic.assembled {
  animation: confetti-settle 2s var(--ease-out-quart) 1.4s both;
}

@keyframes confetti-settle {
  0% {
    transform: scale(1);
  }
  35% {
    transform: scale(1.008);
  }
  100% {
    transform: scale(1);
  }
}

/* Cell: scattered state (default) */
.confetti-cell {
  position: relative;
  overflow: hidden;
  contain: layout style paint;
  transform: translate(var(--sx), var(--sy)) rotate(var(--sr)) scale(0);
  opacity: 0;
  transition:
    transform 1.2s var(--ease-spring),
    opacity 0.6s var(--ease-out-quart);
  transition-delay: var(--d);
  will-change: transform, opacity;
}

/* Cell: assembled state */
.confetti-mosaic.assembled .confetti-cell {
  transform: translate(0, 0) rotate(0deg) scale(1);
  opacity: 1;
}

/* Cell: scattering out (fast burst) */
.confetti-mosaic.scattering .confetti-cell {
  transform: translate(var(--sx), var(--sy)) rotate(var(--sr)) scale(0);
  opacity: 0;
  transition:
    transform 0.45s var(--ease-out-expo),
    opacity 0.3s var(--ease-out-quart);
  transition-delay: var(--d-out);
}

.confetti-cell {
  border-radius: 3px;
}

.confetti-cell img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  transition: transform var(--duration-normal) var(--ease-spring);
}

/* Soft gradient overlay ‚Äî disappears on hover to reveal */
.confetti-cell::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(
    180deg,
    rgba(0, 0, 0, 0.12) 0%,
    rgba(0, 0, 0, 0.04) 40%,
    rgba(0, 0, 0, 0.18) 100%
  );
  pointer-events: none;
  transition: opacity var(--duration-normal) var(--ease-out-quart);
  border-radius: 3px;
}

/* hover: see @media (hover: hover) guard */

/* Cell: floating state (blow ‚Äî lift to nearby random spot) */
.confetti-mosaic.floating .confetti-cell {
  transform: translate(var(--fx), var(--fy)) rotate(var(--fr));
  opacity: 0.85;
  transition:
    transform 0.5s var(--ease-out-expo),
    opacity 0.3s var(--ease-out-quart);
  transition-delay: var(--fd);
}

/* ===== Confetti Glass Preview ===== */
.confetti-preview {
  position: fixed;
  inset: 0;
  z-index: 200;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: opacity 0.3s var(--ease-out-quart);
  pointer-events: none;
}

.confetti-preview.open {
  opacity: 1;
  pointer-events: auto;
}

.confetti-preview-backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.75);
  backdrop-filter: saturate(180%) blur(30px);
  -webkit-backdrop-filter: saturate(180%) blur(30px);
}

.confetti-preview-img {
  position: relative;
  max-width: 85vw;
  max-height: 85vh;
  object-fit: contain;
  border-radius: var(--radius-lg);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  transform: scale(0.92);
  transition: transform 0.4s var(--ease-out-expo);
}

.confetti-preview.open .confetti-preview-img {
  transform: scale(1);
}

/* ===== Square ‚Äî Scrabble-board tile grid ===== */
#view-square {
  overflow: hidden;
}

/* ‚îÄ‚îÄ Square: Living Contact Sheet ‚îÄ‚îÄ */
/* ===== Square / Shuffleboard ‚Äî Polaroid toss ===== */
.sq-stage {
  position: absolute;
  inset: 0;
  overflow: hidden;
}

.sq-card {
  position: absolute;
  top: 0;
  left: 0;
  width: 180px;
  background: #fff;
  padding: 8px 8px 28px;
  border-radius: 2px;
  box-shadow:
    0 2px 12px rgba(0, 0, 0, 0.18),
    0 1px 3px rgba(0, 0, 0, 0.12);
  cursor: grab;
  touch-action: none;
  user-select: none;
  /* will-change managed by JS on drag start/end */
}

.sq-card img {
  width: 100%;
  aspect-ratio: 1;
  object-fit: cover;
  display: block;
  border-radius: 1px;
  pointer-events: none;
}

.sq-card-caption {
  position: absolute;
  bottom: 6px;
  left: 10px;
  right: 10px;
  font-family: var(--font);
  font-size: 10px;
  color: #666;
  line-height: 1.3;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.sq-card.sq-dragging {
  cursor: grabbing;
  box-shadow:
    0 8px 32px rgba(0, 0, 0, 0.28),
    0 2px 8px rgba(0, 0, 0, 0.15);
}

/* Toss animation ‚Äî from deck (bottom center) to landing position */
.sq-card.sq-tossing {
  animation: sq-toss 0.5s cubic-bezier(0.22, 1, 0.36, 1) forwards;
}

@keyframes sq-toss {
  0% {
    transform: translate(calc(50vw - 90px), calc(100vh - 120px)) rotate(0deg)
      scale(0.5);
    opacity: 0.6;
  }
  30% {
    opacity: 1;
    transform: translate(calc(50vw - 90px), calc(50vh - 100px))
      rotate(calc(var(--sq-end-rot) * 0.3)) scale(0.8);
  }
  100% {
    transform: translate(var(--sq-end-x), var(--sq-end-y))
      rotate(var(--sq-end-rot)) scale(1);
    opacity: 1;
  }
}

/* Scatter-away animation for removal */
.sq-card.sq-scatter {
  animation: sq-scatter 0.4s ease-in forwards;
  pointer-events: none;
}

@keyframes sq-scatter {
  0% {
    opacity: 1;
  }
  100% {
    transform: translate(var(--sq-end-x), calc(var(--sq-end-y) - 60px))
      rotate(calc(var(--sq-end-rot) + 15deg)) scale(0.3);
    opacity: 0;
  }
}

/* Deck at bottom center */
.sq-deck {
  position: fixed;
  bottom: var(--space-6);
  bottom: calc(var(--space-6) + env(safe-area-inset-bottom));
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-2);
  z-index: 50;
}

.sq-deck-stack {
  width: 72px;
  height: 90px;
  background: #fff;
  border-radius: 3px;
  box-shadow:
    0 2px 8px rgba(0, 0, 0, 0.15),
    3px 3px 0 -1px #f5f5f5,
    3px 3px 0 0 rgba(0, 0, 0, 0.08),
    6px 6px 0 -1px #eee,
    6px 6px 0 0 rgba(0, 0, 0, 0.05);
  cursor: pointer;
  transition: transform var(--duration-fast) var(--ease-spring);
  position: relative;
}

.sq-deck-stack:active {
  transform: scale(0.92);
}

.sq-deck-count {
  font-family: var(--font-mono);
  font-size: var(--text-2xs);
  color: var(--text-dim);
  background: var(--glass-bg);
  backdrop-filter: saturate(180%) blur(12px);
  -webkit-backdrop-filter: saturate(180%) blur(12px);
  padding: var(--space-1) var(--space-2);
  border-radius: var(--radius-full);
  border: 1px solid var(--glass-border);
  white-space: nowrap;
}

/* ===== Caption ‚Äî Typographic tapestry ===== */
#view-caption {
  overflow-y: auto;
  overflow-x: hidden;
}

/* ‚îÄ‚îÄ Caption: Cinematic story layout ‚îÄ‚îÄ */
.caption-layout {
  display: flex;
  height: 100vh;
  height: 100dvh;
  overflow: hidden;
  padding: 88px var(--space-8) var(--space-8);
  gap: var(--space-8);
  align-items: stretch;
}

/* Image wrap ‚Äî left side, clean */
.caption-img-wrap {
  flex: 1;
  border-radius: var(--radius-xl);
  overflow: hidden;
  position: relative;
  cursor: pointer;
  opacity: 0;
  transition: opacity 0.8s ease;
}
.caption-img-wrap.caption-visible {
  opacity: 1;
}
.caption-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

/* Story wrap ‚Äî right side */
.caption-story-wrap {
  width: 340px;
  flex-shrink: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  padding: var(--space-4) 0;
  cursor: pointer;
  user-select: none;
}
.caption-story-text {
  font-family: var(--font-display);
  font-size: var(--text-lg);
  font-weight: 400;
  line-height: 1.7;
  letter-spacing: -0.01em;
  color: var(--text);
  opacity: 0;
  transition: opacity 0.4s ease;
}
.caption-story-text.caption-visible {
  opacity: 1;
}

/* Word-by-word reveal */
.caption-word {
  opacity: 0;
  transition: opacity 0.3s ease;
}
.caption-word-visible {
  opacity: 1;
}

/* Counter */
.caption-counter {
  margin-top: var(--space-6);
  font: 500 var(--text-caption)/1 var(--font);
  color: var(--text-muted);
  letter-spacing: 0.02em;
}

/* ===== Cinema ‚Äî Full-screen Ken Burns slideshow ===== */
#view-cinema {
  overflow: hidden;
  padding: 0;
}

.cinema-shell {
  position: relative;
  width: 100%;
  height: 100vh;
  height: 100dvh;
  background: #000;
  overflow: hidden;
  cursor: pointer;
  user-select: none;
  -webkit-user-select: none;
}

.cinema-layer {
  position: absolute;
  inset: 0;
  opacity: 0;
  transition: opacity 1.5s var(--ease-out-quart);
  z-index: 0;
}

.cinema-layer.active {
  opacity: 1;
  z-index: 1;
}

.cinema-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

/* Ken Burns drift animations ‚Äî 6 variations */
@keyframes kb-1 {
  from {
    transform: scale(1) translate(0, 0);
  }
  to {
    transform: scale(1.15) translate(-2%, -1%);
  }
}
@keyframes kb-2 {
  from {
    transform: scale(1.05) translate(-1%, 0);
  }
  to {
    transform: scale(1.18) translate(2%, -2%);
  }
}
@keyframes kb-3 {
  from {
    transform: scale(1.1) translate(1%, 1%);
  }
  to {
    transform: scale(1) translate(-1%, 0);
  }
}
@keyframes kb-4 {
  from {
    transform: scale(1) translate(0, 1%);
  }
  to {
    transform: scale(1.12) translate(1%, -1%);
  }
}
@keyframes kb-5 {
  from {
    transform: scale(1.15) translate(-2%, -1%);
  }
  to {
    transform: scale(1.02) translate(1%, 1%);
  }
}
@keyframes kb-6 {
  from {
    transform: scale(1.08) translate(2%, 0);
  }
  to {
    transform: scale(1) translate(-2%, -1%);
  }
}

.cinema-layer.kb-1 .cinema-img {
  animation: kb-1 8s var(--ease-out-quart) both;
}
.cinema-layer.kb-2 .cinema-img {
  animation: kb-2 8s var(--ease-out-quart) both;
}
.cinema-layer.kb-3 .cinema-img {
  animation: kb-3 8s var(--ease-out-quart) both;
}
.cinema-layer.kb-4 .cinema-img {
  animation: kb-4 8s var(--ease-out-quart) both;
}
.cinema-layer.kb-5 .cinema-img {
  animation: kb-5 8s var(--ease-out-quart) both;
}
.cinema-layer.kb-6 .cinema-img {
  animation: kb-6 8s var(--ease-out-quart) both;
}

/* Chapter title card */
.cinema-chapter {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 10;
  font-family: var(--font-display);
  font-size: clamp(24px, 5vw, 56px);
  font-weight: 300;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: rgba(255, 255, 255, 0.9);
  text-shadow: 0 2px 40px rgba(0, 0, 0, 0.6);
  opacity: 0;
  transition: opacity 0.8s var(--ease-out-quart);
  pointer-events: none;
  white-space: nowrap;
}

.cinema-chapter.visible {
  opacity: 1;
}

/* Progress bar ‚Äî thin line at bottom */
.cinema-progress {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: rgba(255, 255, 255, 0.1);
  z-index: 10;
}

.cinema-progress-fill {
  height: 100%;
  width: 0%;
  background: rgba(255, 255, 255, 0.4);
}

/* Counter ‚Äî bottom right */
.cinema-counter {
  position: absolute;
  bottom: var(--space-4);
  right: var(--space-5);
  z-index: 10;
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  color: rgba(255, 255, 255, 0.35);
  letter-spacing: 0.05em;
  pointer-events: none;
}

/* Pause flash indicator */
.cinema-pause {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.5);
  z-index: 10;
  font-size: 32px;
  color: rgba(255, 255, 255, 0.8);
  opacity: 0;
  pointer-events: none;
  transition: none;
}

@keyframes cinema-flash {
  0% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(1.5);
  }
}

.cinema-pause.flash {
  animation: cinema-flash 0.6s var(--ease-out-quart) forwards;
}

/* ===== Reveal ‚Äî Clip-path morphing transitions ===== */
#view-reveal {
  overflow: hidden;
  padding: 0;
}

.reveal-shell {
  position: relative;
  width: 100%;
  height: 100vh;
  height: 100dvh;
  background: #000;
  overflow: hidden;
  cursor: pointer;
  user-select: none;
  -webkit-user-select: none;
}

.reveal-layer {
  position: absolute;
  inset: 0;
}

.reveal-current {
  z-index: 1;
}

.reveal-incoming {
  z-index: 2;
  will-change: clip-path;
}

.reveal-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

/* Set label ‚Äî top center */
.reveal-label {
  position: absolute;
  top: var(--space-6);
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
  font-family: var(--font-display);
  font-size: var(--text-sm);
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: rgba(255, 255, 255, 0.6);
  text-shadow: 0 1px 12px rgba(0, 0, 0, 0.5);
  pointer-events: none;
  white-space: nowrap;
  opacity: 0;
  transition: opacity 0.5s var(--ease-out-quart);
}

@keyframes reveal-flash {
  0% {
    opacity: 0;
    transform: translateX(-50%) translateY(4px);
  }
  20% {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
  80% {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
  100% {
    opacity: 0;
    transform: translateX(-50%) translateY(-4px);
  }
}

.reveal-label.flash {
  animation: reveal-flash 2.5s var(--ease-out-quart) forwards;
}

.reveal-label-shape {
  font-weight: 500;
  color: rgba(255, 255, 255, 0.8);
}

.reveal-label-sep {
  opacity: 0.4;
}

.reveal-label-theme {
  font-weight: 300;
  font-style: italic;
}

/* Counter ‚Äî bottom right */
.reveal-counter {
  position: absolute;
  bottom: var(--space-4);
  right: var(--space-5);
  z-index: 10;
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  color: rgba(255, 255, 255, 0.35);
  letter-spacing: 0.05em;
  pointer-events: none;
}

/* Hint ‚Äî bottom center, fades out */
.reveal-hint {
  position: absolute;
  bottom: var(--space-6);
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
  font-family: var(--font-display);
  font-size: var(--text-xs);
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: rgba(255, 255, 255, 0.4);
  transition: opacity 1s var(--ease-out-quart);
  pointer-events: none;
}

.reveal-hint.faded {
  opacity: 0;
}

/* ===== Pulse ‚Äî Breathing mosaic grid ===== */
#view-pulse {
  overflow: hidden;
  padding: 0;
}

.pulse-shell {
  position: relative;
  width: 100%;
  height: 100vh;
  height: 100dvh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: var(--bg);
  overflow: hidden;
  cursor: crosshair;
}

.pulse-grid {
  display: grid;
  grid-template-columns: repeat(var(--pulse-cols, 10), 1fr);
  width: min(70vh, 70vw);
  height: min(70vh, 70vw);
  gap: 2px;
}

.pulse-cell {
  overflow: hidden;
  border-radius: 3px;
  opacity: 0;
  transform: scale(0.6);
  cursor: pointer;
  /* will-change promoted via .pulse-animating parent, cleaned up after settle */
}
.pulse-animating .pulse-cell {
  will-change: transform, opacity;
}

.pulse-cell img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  pointer-events: none;
}

/* Stagger reveal from center outward */
.pulse-grid.revealed .pulse-cell {
  opacity: 1;
  transform: scale(1);
  transition:
    transform 0.5s var(--ease-out-expo),
    opacity 0.5s var(--ease-out-quart);
  transition-delay: var(--pulse-delay, 0ms);
}

/* Category pills at bottom */
.pulse-rack {
  position: absolute;
  bottom: var(--space-5);
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: var(--space-1_5);
  padding: var(--space-1_5);
  overflow-x: auto;
  max-width: 90vw;
  scrollbar-width: none;
  -ms-overflow-style: none;
  z-index: 10;
}

.pulse-rack::-webkit-scrollbar {
  display: none;
}

.pulse-pill {
  flex-shrink: 0;
  padding: var(--space-1) var(--space-3);
  border-radius: var(--radius-pill);
  border: 1px solid var(--glass-border);
  background: var(--glass-bg);
  color: var(--text-secondary);
  font-family: var(--font);
  font-size: var(--text-xs);
  cursor: pointer;
  transition:
    background var(--duration-fast) var(--ease-out-quart),
    border-color var(--duration-fast) var(--ease-out-quart),
    color var(--duration-fast) var(--ease-out-quart);
  white-space: nowrap;
}

.pulse-pill.active {
  background: var(--text);
  color: var(--bg);
  border-color: var(--text);
}

/* ===== Drift ‚Äî Visual similarity explorer ===== */
#view-drift {
  overflow: hidden;
  padding: 0;
}

.drift-shell {
  position: relative;
  width: 100%;
  height: 100vh;
  height: 100dvh;
  display: flex;
  flex-direction: column;
  background: var(--bg);
  overflow: hidden;
}

/* Header ‚Äî label + random button in one row */
.drift-header {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-4) var(--space-5);
  position: relative;
  flex-shrink: 0;
}

/* Main ‚Äî hero + neighbor strip, centered vertically in remaining space */
.drift-main {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--space-4);
  min-height: 0;
}

/* Center hero image */
.drift-center-wrap {
  position: relative;
  width: min(50dvh, 55vw);
  height: min(50dvh, 55vw);
  border-radius: var(--radius-lg);
  overflow: hidden;
  box-shadow: var(--shadow-float);
  flex-shrink: 0;
  cursor: pointer;
}

.drift-hero {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  transition:
    opacity 0.5s var(--ease-out-quart),
    transform 0.5s var(--ease-out-quart);
}

.drift-hero-entering {
  opacity: 0;
  transform: scale(1.05);
}

.drift-hero-exiting {
  opacity: 0;
  transform: scale(0.95);
}

/* Neighbor strip ‚Äî horizontal row below hero */
.drift-strip {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-3);
  flex-shrink: 0;
  overflow-x: auto;
  scrollbar-width: none;
}
.drift-strip::-webkit-scrollbar {
  display: none;
}

.drift-card {
  width: clamp(80px, 9vw, 130px);
  aspect-ratio: 4 / 3;
  border-radius: var(--radius);
  overflow: hidden;
  cursor: pointer;
  position: relative;
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--glass-border);
  flex-shrink: 0;
  opacity: 0;
  transform: scale(0.8) translateY(12px);
  transition:
    opacity 0.4s var(--ease-out-quart),
    transform 0.4s var(--ease-out-expo),
    border-color var(--duration-fast) var(--ease-out-quart);
  transition-delay: var(--drift-delay, 0ms);
  animation: drift-card-in 0.5s var(--ease-out-expo) forwards;
  animation-delay: var(--drift-delay, 0ms);
}

@keyframes drift-card-in {
  from {
    opacity: 0;
    transform: scale(0.8) translateY(12px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

.drift-card-exit {
  opacity: 0 !important;
  transform: scale(0.7) !important;
  transition-delay: 0ms !important;
  pointer-events: none !important;
}

.drift-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  pointer-events: none;
}

/* Breadcrumb trail ‚Äî bottom center */
.drift-trail {
  display: flex;
  justify-content: center;
  gap: var(--space-1_5);
  padding: 0 var(--space-4) var(--space-4);
  padding-bottom: calc(var(--space-4) + env(safe-area-inset-bottom));
  flex-shrink: 0;
  max-width: 90vw;
  margin: 0 auto;
  overflow-x: auto;
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.drift-trail::-webkit-scrollbar {
  display: none;
}

.drift-trail-dot {
  width: 36px;
  height: 36px;
  flex-shrink: 0;
  border-radius: 50%;
  overflow: hidden;
  border: 2px solid var(--glass-border);
  cursor: pointer;
  opacity: 0.5;
  transition:
    opacity var(--duration-fast) var(--ease-out-quart),
    border-color var(--duration-fast) var(--ease-out-quart);
}

.drift-trail-dot img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.drift-trail-current {
  opacity: 1;
  border-color: var(--text);
  box-shadow:
    0 0 0 2px var(--bg),
    0 0 0 4px var(--text);
}

/* Random button ‚Äî inside header, pushed to end */
.drift-random {
  position: absolute;
  right: var(--space-5);
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: 1px solid var(--glass-border);
  background: var(--glass-bg);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition:
    transform var(--duration-fast) var(--ease-out-quart),
    background var(--duration-fast) var(--ease-out-quart);
}

/* Score label ‚Äî inside header */
.drift-score-label {
  font-family: var(--font-display);
  font-size: var(--text-xs);
  letter-spacing: 0.06em;
  color: var(--text-secondary);
  opacity: 0;
  transition: opacity 0.5s var(--ease-out-quart);
  pointer-events: none;
  white-space: nowrap;
}

@keyframes drift-label-flash {
  0% {
    opacity: 0;
  }
  20% {
    opacity: 1;
  }
  100% {
    opacity: 0.6;
  }
}

/* Onboarding hint */
.drift-hint {
  font-family: var(--font);
  font-size: var(--text-xs);
  color: var(--text-secondary);
  text-align: center;
  padding: var(--space-1_5) var(--space-3);
  flex-shrink: 0;
  opacity: 0;
  animation: drift-hint-in 0.8s 1.5s var(--ease-out-quart) forwards;
  pointer-events: none;
  transition: opacity 0.4s var(--ease-out-quart);
}

@keyframes drift-hint-in {
  from {
    opacity: 0;
    transform: translateY(6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.drift-hint-hide {
  opacity: 0 !important;
  animation: none;
}

.drift-score-label.flash {
  animation: drift-label-flash 2s var(--ease-out-quart) forwards;
}

/* ===== Lightbox ‚Äî Always dark overlay ===== */
.lightbox {
  position: fixed;
  inset: 0;
  z-index: 200;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 1;
  transition: opacity var(--duration-normal) var(--ease-out-quart);
}

.lightbox.hidden {
  opacity: 0;
  pointer-events: none;
}

.lightbox-backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.92);
  backdrop-filter: saturate(180%) blur(20px);
  -webkit-backdrop-filter: saturate(180%) blur(20px);
}

.lightbox-content {
  position: relative;
  max-width: 90vw;
  max-height: 90vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  transform: scale(1) translateY(0);
  transition:
    transform var(--duration-slow) var(--ease-out-expo),
    opacity var(--duration-normal) var(--ease-out-quart);
}

.lightbox.hidden .lightbox-content {
  transform: scale(0.95) translateY(12px);
  opacity: 0;
}

/* Lightbox navigation arrows */
.lightbox-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  z-index: 10;
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.4);
  font-size: 56px;
  font-weight: 200;
  cursor: pointer;
  padding: var(--space-5);
  transition: color var(--duration-fast) var(--ease-out-quart);
  font-family: var(--font);
  line-height: 1;
}

.lightbox-prev {
  left: 0;
}
.lightbox-next {
  right: 0;
}
.lightbox-nav[hidden] {
  display: none;
}

.lightbox-close {
  position: absolute;
  top: -44px;
  right: 0;
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.7);
  font-size: 24px;
  cursor: pointer;
  font-family: var(--font);
  transition: color var(--transition);
}

/* hover: see @media (hover: hover) guard */

.lightbox-img {
  max-width: 90vw;
  max-height: 90vh;
  object-fit: contain;
  border-radius: var(--radius);
}

.lightbox-meta {
  display: none;
}

.lightbox-alt {
  font-size: var(--text-sm);
  color: rgba(255, 255, 255, 0.7);
  font-style: italic;
  margin-bottom: var(--space-2_5);
  line-height: 1.6;
}

.lightbox-tags {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: var(--space-1_5);
  margin-bottom: var(--space-2);
}

/* Force light text in lightbox (always dark backdrop) */
.lightbox-tags .glass-tag {
  color: rgba(255, 255, 255, 0.85);
  border-color: rgba(255, 255, 255, 0.15);
  background: rgba(255, 255, 255, 0.06);
}

.lightbox-palette {
  display: flex;
  justify-content: center;
  gap: var(--space-1_5);
}

.lightbox-palette .palette-dot {
  border-color: rgba(255, 255, 255, 0.15);
}

/* ===== Loading ‚Äî simple text indicator ===== */
.loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--space-4);
  height: 100vh;
  color: var(--text-muted);
  font-size: var(--text-sm);
  font-family: var(--font-display);
}

.loading.error {
  color: var(--color-error);
}

/* ===== Scrollbar ===== */
::-webkit-scrollbar {
  width: 6px;
}
::-webkit-scrollbar-track {
  background: transparent;
}
::-webkit-scrollbar-thumb {
  background: var(--fill-tertiary);
  border-radius: 3px;
}
::-webkit-scrollbar-thumb:hover {
  background: var(--fill-primary);
}

/* ===== Utility: Clickable Images ===== */
.clickable-img {
  cursor: pointer;
}

/* ===== Utility: Color Swatch (small inline dot) ===== */
.color-swatch-sm {
  display: inline-block;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  margin-right: var(--space-2);
  vertical-align: middle;
}

/* ===== Utility: Empty State ===== */
.empty-state {
  padding: var(--space-10);
  color: var(--text-muted);
  text-align: center;
}

/* ===== Hover Guard ‚Äî only apply hover effects on devices with pointer ===== */
@media (hover: hover) and (pointer: fine) {
  .logo:hover {
    opacity: 0.6;
  }
  .side-menu-action:hover {
    color: var(--text);
    background: var(--glass-bg-hover);
  }
  .tab:hover {
    color: var(--text);
    background: var(--glass-bg);
  }
  .side-menu-item:hover {
    color: var(--text);
    background: var(--glass-bg-hover);
  }
  .glass-tag:hover {
    background: var(--glass-bg-hover);
    border-color: var(--glass-border-hover);
  }
  .glass-tag.tag-vibe:hover,
  .glass-tag.tag-grading:hover,
  .glass-tag.tag-time:hover,
  .glass-tag.tag-setting:hover,
  .glass-tag.tag-scene:hover,
  .glass-tag.tag-emotion:hover,
  .glass-tag.tag-camera:hover,
  .glass-tag.tag-style:hover {
    border-color: var(--glass-border-hover);
  }
  .faces-container .glass-tag.tag-emotion:hover {
    border-color: color-mix(in srgb, var(--system-pink) 60%, transparent);
  }
  .filter-bar .clear-btn:hover {
    color: var(--text);
    border-color: var(--glass-border-hover);
    background: var(--glass-bg);
  }
  .sort-btn:hover {
    opacity: 0.85;
    background: var(--glass-bg);
  }
  .sort-size-btn:hover {
    opacity: 0.85;
    background: var(--glass-bg);
  }
  .grid-item:hover img {
    transform: scale(1.03);
  }
  .grid-item:hover .grid-overlay {
    opacity: 1;
  }
  .drift-neighbor:hover {
    border-color: var(--glass-border-hover);
    transform: translateY(-3px);
    box-shadow: var(--shadow-sm);
  }
  .drift-neighbor:hover .drift-score {
    background: var(--text);
  }
  .drift-btn:hover {
    color: var(--text);
    background: var(--glass-bg-hover);
    border-color: var(--glass-border-hover);
  }
  .drift-breadcrumb-item:hover {
    border-color: var(--glass-border-hover);
    transform: scale(1.15);
  }
  .couleurs-band:hover {
    opacity: 0.75;
    flex: 2;
  }
  .bento-nav:hover {
    color: var(--text);
    background: var(--glass-bg-hover);
    border-color: var(--glass-border-hover);
  }
  .bento-nav-prev:hover {
    transform: translateY(-50%) scale(1.1);
  }
  .bento-nav-next:hover {
    transform: translateY(-50%) scale(1.1);
  }
  .bento-regen:hover {
    background: var(--glass-bg-hover);
    border-color: var(--glass-border-hover);
    transform: scale(1.1);
  }
  .bento-dice-nav:hover {
    transform: scale(1.15);
  }
  .bento-tile-fs:hover {
    background: rgba(0, 0, 0, 0.7);
    transform: scale(1.1);
  }
  .game-start-btn:hover {
    background: var(--fill-primary);
    border-color: var(--glass-border-hover);
  }
  .jeu-btn:hover {
    transform: scale(1.25);
  }
  .faces-filter-btn:hover {
    color: var(--text);
    background: var(--glass-bg-hover);
    border-color: var(--glass-border-hover);
  }
  .face-card:hover {
    transform: scale(1.12);
    z-index: 2;
    box-shadow: var(--shadow-sm);
  }
  .compass-arm:hover .compass-arm-img,
  .compass-arm:hover .compass-arm-img.img-loaded {
    opacity: 0.7;
  }
  .compass-random:hover {
    color: var(--text);
    background: var(--glass-bg-hover);
    border-color: var(--glass-border-hover);
  }
  .obs-hist-bar:hover {
    background: var(--fill-primary);
  }
  .map-strip-card:hover {
    border-color: var(--glass-border-hover);
    transform: translateY(-2px);
    box-shadow: var(--shadow-sm);
  }
  .nyu-nav-btn:hover {
    opacity: 1;
  }
  .nyu-reel-nav:hover {
    color: var(--text);
    background: var(--glass-bg-hover);
    border-color: var(--glass-border-hover);
  }
  .nyu-reel-prev:hover {
    transform: translateY(-50%) scale(1.1);
  }
  .nyu-reel-next:hover {
    transform: translateY(-50%) scale(1.1);
  }
  .nyu-grid-cell:hover img {
    transform: scale(1.03);
  }
  .nyu-canvas-img:hover {
    transform: scale(1.01);
  }
  .nyu-mosaic-cell:hover img {
    transform: scale(1.25);
    opacity: 1;
  }
  .sq-deck-stack:hover {
    transform: scale(1.06);
  }
  .sq-card:hover {
    box-shadow:
      0 4px 20px rgba(0, 0, 0, 0.22),
      0 2px 6px rgba(0, 0, 0, 0.14);
  }
  .caption-img-wrap:hover {
    opacity: 0.95;
  }
  .confetti-bomb:hover {
    transform: scale(1.08);
    box-shadow: var(--shadow-lg);
  }
  .confetti-dial-btn:hover {
    opacity: 0.85;
  }
  .confetti-cell:hover::after {
    opacity: 0;
  }
  .confetti-cell:hover img {
    transform: scale(1.3);
  }
  .pulse-pill:hover {
    color: var(--text);
    background: var(--glass-bg-hover);
    border-color: var(--glass-border-hover);
  }
  .pulse-cell:hover {
    border-radius: 5px;
  }
  .drift-card:hover {
    transform: scale(1.06) translateY(-3px);
    border-color: var(--glass-border-hover);
    box-shadow: var(--shadow-float);
  }
  .drift-trail-dot:hover {
    opacity: 0.9;
    border-color: var(--glass-border-hover);
  }
  .drift-random:hover {
    transform: scale(1.1);
    background: var(--glass-bg-hover);
  }
  .lightbox-close:hover {
    color: rgb(255, 255, 255);
  }
  .lightbox-nav:hover {
    color: rgba(255, 255, 255, 0.9);
  }
  .menu-btn:hover {
    color: var(--text);
  }
}

/* ===== dvh fallbacks for all viewport-height containers ===== */
.view {
  min-height: 100vh;
  min-height: 100dvh;
}
.drift-container {
  min-height: 100vh;
  min-height: 100dvh;
}
.couleurs-wrap {
  height: 100vh;
  height: 100dvh;
}
.bento-wrap {
  height: 100vh;
  height: 100dvh;
}
.bento-grid {
  height: calc(100vh - 128px);
  height: calc(100dvh - 128px);
}
.jeu-container {
  height: 100vh;
  height: 100dvh;
}
.jeu-pair {
  max-height: calc(100vh - 88px);
  max-height: calc(100dvh - 88px);
}
.faces-container {
  height: 100vh;
  height: 100dvh;
}
.compass-grid {
  height: 100vh;
  height: 100dvh;
}
.nyu-shell {
  height: 100vh;
  height: 100dvh;
}
#view-confetti {
  height: 100vh;
  height: 100dvh;
}
.sq-stage {
  height: 100vh;
  height: 100dvh;
}
/* caption-layout dvh handled inline */
.cinema-shell {
  height: 100vh;
  height: 100dvh;
}
.reveal-shell {
  height: 100vh;
  height: 100dvh;
}
.pulse-shell {
  height: 100vh;
  height: 100dvh;
}
.drift-shell {
  height: 100vh;
  height: 100dvh;
}
.loading {
  height: 100vh;
  height: 100dvh;
}

/* ===== Responsive ‚Äî Tablet (max-width: 768px) ===== */
@media (max-width: 768px) {
  /* Font floor ‚Äî nothing smaller than 13px on mobile */
  :root {
    --text-2xs: 13px;
    --text-xs: 13px;
    --text-caption: 13px;
    --text-sm: 14px;
  }

  .floating-nav {
    top: var(--space-5);
    left: var(--space-5);
    right: auto;
    background: rgba(255, 255, 255, 0.55);
    backdrop-filter: saturate(200%) blur(30px);
    -webkit-backdrop-filter: saturate(200%) blur(30px);
    border: 1px solid rgba(255, 255, 255, 0.35);
    box-shadow:
      0 1px 3px rgba(0, 0, 0, 0.04),
      0 4px 16px rgba(0, 0, 0, 0.06),
      0 12px 40px rgba(0, 0, 0, 0.04);
    border-radius: 18px;
    padding: 8px 16px 8px 12px;
    gap: var(--space-3);
  }
  :root.dark .floating-nav {
    background: rgba(28, 28, 30, 0.55);
    border: 1px solid rgba(255, 255, 255, 0.08);
    box-shadow:
      0 1px 3px rgba(0, 0, 0, 0.1),
      0 4px 16px rgba(0, 0, 0, 0.15),
      0 12px 40px rgba(0, 0, 0, 0.1);
  }

  .logo {
    font-size: var(--text-3xl);
    padding: 0;
    background: none;
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    border-radius: 0;
  }
  :root.dark .logo {
    background: none;
  }

  .nav-exp-label {
    display: none;
  }

  .menu-btn {
    position: fixed;
    bottom: calc(var(--space-5) + env(safe-area-inset-bottom));
    right: var(--space-4);
    left: auto;
    transform: none;
    z-index: 100;
    width: auto;
    height: auto;
    border-radius: var(--radius-full);
    padding: 10px 16px 10px 18px;
    gap: 6px;
    background: rgba(255, 255, 255, 0.75);
    backdrop-filter: saturate(200%) blur(30px);
    -webkit-backdrop-filter: saturate(200%) blur(30px);
    border: 1px solid rgba(255, 255, 255, 0.5);
    box-shadow:
      0 2px 4px rgba(0, 0, 0, 0.04),
      0 8px 24px rgba(0, 0, 0, 0.12),
      0 20px 48px rgba(0, 0, 0, 0.08);
    color: var(--text);
  }
  :root.dark .menu-btn {
    background: rgba(60, 60, 67, 0.65);
    border: 1px solid rgba(255, 255, 255, 0.12);
    box-shadow:
      0 2px 4px rgba(0, 0, 0, 0.1),
      0 8px 24px rgba(0, 0, 0, 0.3),
      0 20px 48px rgba(0, 0, 0, 0.2);
  }

  .menu-icon {
    display: none;
  }
  .menu-btn-label {
    display: inline;
    font-family: var(--font-display);
    font-size: var(--text-base);
    font-weight: 600;
    letter-spacing: -0.01em;
  }
  .menu-chevron {
    display: inline;
    opacity: 0.5;
  }

  .side-menu {
    top: auto;
    left: auto;
    bottom: calc(var(--space-5) + env(safe-area-inset-bottom) + 56px);
    right: var(--space-4);
    min-width: 200px;
    max-width: calc(100vw - 32px);
    transform-origin: bottom right;
    background: rgba(255, 255, 255, 0.82);
    backdrop-filter: saturate(200%) blur(40px);
    -webkit-backdrop-filter: saturate(200%) blur(40px);
    border-radius: var(--radius-xl);
    padding: var(--space-3);
  }
  :root.dark .side-menu {
    background: rgba(28, 28, 30, 0.82);
  }
  .side-menu-item {
    font-size: var(--text-lg);
    padding: var(--space-2_5) var(--space-4);
  }
  .side-menu-state {
    font-size: var(--text-sm);
    padding: var(--space-2) var(--space-4);
  }
  .side-menu-action {
    font-size: var(--text-base);
    padding: var(--space-2_5) var(--space-4);
  }

  /* Drift/Similarity */
  .drift-container {
    padding: var(--space-5) var(--space-4);
  }
  .drift-neighbors {
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-2);
  }
  .drift-center {
    margin-bottom: var(--space-6);
  }

  .grid-container {
    padding: var(--space-1);
  }

  /* Bento: reduce padding, full-width grid */
  .bento-wrap {
    padding: calc(env(safe-area-inset-top, 0px) + 48px) var(--space-3)
      calc(env(safe-area-inset-bottom, 0px) + 12px);
  }
  .bento-grid {
    height: calc(100dvh - 120px);
    max-width: calc(100vw - 24px);
  }
  .bento-nav {
    width: 44px;
    height: 44px;
    font-size: 20px;
  }
  .bento-nav-prev {
    left: var(--space-2);
  }
  .bento-nav-next {
    right: var(--space-2);
  }
  .bento-regen {
    bottom: var(--space-6);
    bottom: calc(var(--space-6) + env(safe-area-inset-bottom));
    right: auto;
    left: 50%;
    translate: -50% 0;
    width: 60px;
    height: 60px;
    font-size: 28px;
  }

  /* Game */
  .jeu-container {
    padding: calc(env(safe-area-inset-top, 0px) + 48px) var(--space-3)
      calc(env(safe-area-inset-bottom, 0px) + 72px);
  }
  .jeu-pair {
    gap: var(--space-1);
  }
  .jeu-bar {
    bottom: var(--space-6);
    bottom: calc(var(--space-6) + env(safe-area-inset-bottom));
  }

  /* Couleurs ‚Äî spectrum vertical on right */
  .couleurs-wrap {
    flex-direction: row;
    padding: calc(env(safe-area-inset-top, 0px) + 48px) 0
      calc(env(safe-area-inset-bottom, 0px) + 12px);
    gap: 0;
  }
  .couleurs-spectrum {
    flex-direction: column;
    width: 28px;
    height: auto;
    order: 1;
    border-radius: 0;
  }
  .couleurs-card {
    order: 0;
    border-radius: 0;
    box-shadow: none;
  }

  /* Faces */
  .faces-container {
    padding: calc(env(safe-area-inset-top, 0px) + 48px) var(--space-3)
      calc(env(safe-area-inset-bottom, 0px) + 16px);
    gap: var(--space-2_5);
  }
  .faces-filter-bar {
    order: 1;
    gap: var(--space-1);
    overflow-x: auto;
    flex-wrap: nowrap;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    padding: 0 var(--space-3);
  }
  .faces-filter-bar::-webkit-scrollbar {
    display: none;
  }
  .faces-card {
    order: 0;
  }
  .faces-filter-btn {
    padding: var(--space-1) var(--space-3);
    font-size: var(--text-sm);
    flex-shrink: 0;
  }

  /* Compass: stack vertically on tablet */
  .compass-grid {
    grid-template-areas:
      "north  north"
      "west   east"
      "center center"
      "south  south";
    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto 1fr 3fr auto;
    padding: 0;
  }
  .compass-random {
    bottom: calc(var(--space-4) + env(safe-area-inset-bottom));
    right: var(--space-4);
  }

  /* NYU */
  .nyu-nav {
    bottom: var(--space-4);
    bottom: calc(var(--space-4) + env(safe-area-inset-bottom));
    padding: var(--space-1_5) var(--space-2_5);
  }
  .nyu-nav-btn {
    width: 44px;
    height: 44px;
    font-size: 18px;
  }
  .nyu-reel {
    gap: var(--space-4);
    padding: 0 var(--space-4);
  }
  .nyu-reel-item img {
    max-width: 90vw;
  }
  .nyu-reel-nav {
    display: none;
  }
  .nyu-reel-counter {
    bottom: var(--space-4);
  }
  .nyu-grid-row[data-type="hero"] .nyu-grid-cell {
    height: 40vh;
    height: 40dvh;
  }
  .nyu-grid-row[data-type="pair"] .nyu-grid-cell {
    height: 28vh;
    height: 28dvh;
  }
  .nyu-grid-row[data-type="triplet"] .nyu-grid-cell {
    height: 20vh;
    height: 20dvh;
  }
  .nyu-mosaic {
    width: min(90dvh, 90vw);
    height: min(90dvh, 90vw);
  }
  .nyu-stack {
    width: min(90vw, 700px);
  }
  .nyu-canvas {
    padding: var(--space-5);
  }
  .nyu-canvas-img {
    max-width: 95%;
    max-height: 70dvh;
  }

  /* Square / Shuffleboard */
  .sq-card {
    width: 140px;
    padding: 6px 6px 22px;
  }
  .sq-card-caption {
    font-size: 9px;
  }
  .sq-deck-stack {
    width: 60px;
    height: 75px;
  }

  /* Cinema */
  .cinema-counter {
    right: var(--space-4);
    bottom: var(--space-3);
  }

  /* Reveal */
  .reveal-label {
    font-size: var(--text-xs);
    top: var(--space-4);
  }
  .reveal-counter {
    right: var(--space-4);
    bottom: var(--space-3);
  }

  /* Pulse */
  .pulse-grid {
    width: min(75dvh, 85vw);
    height: min(75dvh, 85vw);
  }
  .pulse-rack {
    bottom: calc(var(--space-4) + env(safe-area-inset-bottom));
  }

  /* Drift */
  .drift-header {
    padding: calc(var(--space-3) + 36px) var(--space-4) var(--space-2);
  }
  .drift-center-wrap {
    width: calc(100vw - 32px);
    height: 50dvh;
  }
  .drift-strip {
    justify-content: flex-start;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    padding: 0 var(--space-4);
    gap: var(--space-2);
  }
  .drift-card {
    width: 100px;
    height: 75px;
    scroll-snap-align: center;
    border-radius: 10px;
  }
  .drift-random {
    right: var(--space-4);
  }

  /* Caption */
  .caption-layout {
    flex-direction: column;
    padding: calc(env(safe-area-inset-top, 0px) + 56px) var(--space-3)
      calc(env(safe-area-inset-bottom, 0px) + 12px);
    gap: var(--space-4);
  }
  .caption-img-wrap {
    flex: none;
    height: 50%;
    width: 100%;
  }
  .caption-story-wrap {
    width: 100%;
    flex: 1;
    padding: 0 var(--space-2);
  }
  .caption-story-text {
    font-size: var(--text-base);
  }

  /* Confetti */
  .confetti-dial {
    left: 50%;
    top: auto;
    bottom: calc(var(--space-4) + env(safe-area-inset-bottom));
    translate: -50% 0;
    width: 140px;
    height: 140px;
  }
  .confetti-dial {
    width: 200px;
    height: 200px;
  }
  .confetti-bomb {
    width: 52px;
    height: 52px;
    font-size: 22px;
  }
  .confetti-dial-btn {
    width: 38px;
    height: 38px;
    margin: -19px 0 0 -19px;
    font-size: 18px;
    transform: rotate(var(--dial-angle)) translateX(86px)
      rotate(calc(-1 * var(--dial-angle)));
  }
  .confetti-mosaic {
    width: min(85dvh, 88vw);
    height: min(85dvh, 88vw);
  }
  .confetti-label {
    font-size: var(--text-sm);
    bottom: var(--space-3);
  }

  /* Lightbox */
  .lightbox-content {
    max-width: 95vw;
  }
  .lightbox-img {
    max-width: 95vw;
    max-height: 85dvh;
  }
  .lightbox-close {
    top: -44px;
    font-size: 28px;
  }
  .lightbox-nav {
    font-size: 36px;
    padding: var(--space-2);
  }

  /* Observatory */
  .observatory-container {
    grid-template-columns: 1fr;
    padding: var(--space-4);
  }

  /* Sort bar ‚Äî fixed bottom for thumb reach */
  .sort-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    top: auto;
    padding: var(--space-2) var(--space-3)
      calc(var(--space-2) + env(safe-area-inset-bottom));
    z-index: 20;
    overflow: hidden;
  }
  .sort-bar-inner {
    gap: 0;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    max-width: 100%;
    background: rgba(230, 230, 230, 0.7);
  }
  :root.dark .sort-bar-inner {
    background: rgba(28, 28, 30, 0.85);
  }
  .sort-bar-inner::-webkit-scrollbar {
    display: none;
  }
  .sort-btn {
    padding: var(--space-1_5) var(--space-2_5);
    font-size: var(--text-sm);
  }
  .sort-grid-wrap {
    padding: 0 var(--space-3) calc(var(--space-20) + 60px);
  }

  /* Filter bar */
  .filter-bar {
    padding: var(--space-2_5) var(--space-4);
  }
}

/* ===== Responsive ‚Äî Phone (max-width: 480px) ===== */
@media (max-width: 480px) {
  .floating-nav {
    top: var(--space-2);
    left: var(--space-2);
    right: auto;
  }
  .logo {
    font-size: var(--text-xl);
  }
  .menu-btn {
    bottom: calc(var(--space-5) + env(safe-area-inset-bottom));
  }

  /* Drift/Similarity: single column neighbors on phone */
  .drift-container {
    padding: var(--space-4) var(--space-3);
  }
  .drift-neighbors {
    grid-template-columns: 1fr;
    gap: var(--space-2);
  }
  .drift-neighbor img {
    aspect-ratio: 16/9;
  }
  .drift-controls {
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  /* Bento: minimal padding */
  .bento-wrap {
    padding: calc(env(safe-area-inset-top, 0px) + 44px) var(--space-2)
      calc(env(safe-area-inset-bottom, 0px) + 8px);
  }
  .bento-grid {
    height: calc(100dvh - 80px);
    max-width: calc(100vw - 16px);
  }

  /* Game: stack images vertically on phone */
  .jeu-pair {
    grid-template-columns: 1fr;
    gap: var(--space-1);
  }
  .jeu-img {
    aspect-ratio: 16/9;
  }
  .jeu-pair-bento {
    grid-template-columns: 1fr;
  }
  .jeu-pair-bento .jeu-img-portrait {
    aspect-ratio: 3/4;
  }
  .jeu-pair-bento .jeu-img-landscape {
    aspect-ratio: 16/9;
  }
  .jeu-pair-portrait {
    grid-template-columns: 1fr;
  }
  .jeu-pair-portrait .jeu-img {
    aspect-ratio: 3/4;
  }

  /* Compass: simplified single-column */
  .compass-grid {
    grid-template-areas:
      "center"
      "north"
      "south"
      "west"
      "east";
    grid-template-columns: 1fr;
    grid-template-rows: 3fr repeat(4, 1fr);
    gap: 2px;
    padding: 0;
  }

  /* Faces: even tighter */
  .faces-container {
    padding: calc(env(safe-area-inset-top, 0px) + 44px) var(--space-2)
      calc(env(safe-area-inset-bottom, 0px) + 12px);
    gap: var(--space-2);
  }
  .faces-filter-bar {
    gap: 2px;
  }
  .faces-filter-btn {
    flex-shrink: 0;
  }

  /* Square / Shuffleboard: compact cards on phone */
  .sq-card {
    width: 110px;
    padding: 5px 5px 18px;
  }
  .sq-card-caption {
    font-size: 8px;
    bottom: 4px;
  }
  .sq-deck-stack {
    width: 52px;
    height: 65px;
  }
  .sq-deck {
    bottom: calc(var(--space-4) + env(safe-area-inset-bottom));
  }

  /* Drift: compact */
  .drift-header {
    padding-top: calc(var(--space-2) + 32px);
  }
  .drift-center-wrap {
    height: 45dvh;
  }
  .drift-card {
    width: 88px;
    height: 66px;
  }
  .drift-trail-dot {
    width: 28px;
    height: 28px;
  }

  /* Cinema: phone-optimized */
  .cinema-chapter {
    font-size: clamp(20px, 6vw, 36px);
  }
  .cinema-counter {
    right: var(--space-3);
    bottom: var(--space-2);
    font-size: 11px;
  }
  .cinema-progress {
    height: 2px;
  }
  .cinema-pause {
    font-size: 24px;
  }

  /* Pulse: smaller grid */
  .pulse-grid {
    width: min(80dvh, 94vw);
    height: min(80dvh, 94vw);
    gap: 1px;
  }
  .pulse-pill {
    font-size: 12px;
    padding: var(--space-1) var(--space-2);
  }
  .pulse-rack {
    gap: var(--space-1);
  }

  /* Couleurs: phone-optimized */
  .couleurs-spectrum {
    width: 24px;
  }
  .couleurs-card {
    gap: 2px;
  }
  .couleurs-row {
    gap: 2px;
  }

  /* Caption: compact */
  .caption-layout {
    flex-direction: column;
    padding: calc(env(safe-area-inset-top, 0px) + 44px) var(--space-2)
      calc(env(safe-area-inset-bottom, 0px) + 8px);
    gap: var(--space-3);
  }
  .caption-img-wrap {
    flex: none;
    height: 45%;
    width: 100%;
  }
  .caption-story-wrap {
    width: 100%;
    flex: 1;
    padding: 0;
  }
  .caption-story-text {
    font-size: var(--text-sm);
    line-height: 1.5;
  }

  /* Confetti: tighter dial */
  .confetti-dial {
    width: 170px;
    height: 170px;
    bottom: calc(var(--space-3) + env(safe-area-inset-bottom));
  }
  .confetti-bomb {
    width: 46px;
    height: 46px;
    font-size: 20px;
  }
  .confetti-dial-btn {
    width: 34px;
    height: 34px;
    margin: -17px 0 0 -17px;
    font-size: 16px;
    transform: rotate(var(--dial-angle)) translateX(72px)
      rotate(calc(-1 * var(--dial-angle)));
  }
  .confetti-mosaic {
    width: min(80dvh, 92vw);
    height: min(80dvh, 92vw);
  }

  /* Sort */
  .sort-bar-inner {
    flex-wrap: nowrap;
    justify-content: center;
  }
  .sort-sep {
    display: none;
  }
  .sort-size-btn {
    width: 40px;
    height: 40px;
  }
  .sort-btn {
    font-size: var(--text-xs);
    padding: var(--space-1) var(--space-2);
  }

  /* Pendulum: stack vertically */
  .pendulum-pair {
    flex-direction: column !important;
  }
}

/* ===== Content Visibility ‚Äî off-screen sections don't render ===== */
.view:not(.active) {
  content-visibility: hidden;
}

/* ===== Reduced Motion ‚Äî respect accessibility preference ===== */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  .grid-item:hover img {
    transform: none;
  }
  .drift-neighbor:hover {
    transform: none;
    box-shadow: none;
  }
  .glass-tag:hover {
    transform: none;
  }
  .compass-arm:hover .compass-arm-img {
    opacity: 0.35;
  }
  .face-card:hover {
    transform: none;
    box-shadow: none;
  }
  .map-strip-card:hover {
    transform: none;
    box-shadow: none;
  }
  .nyu-card {
    transition-duration: 0.01ms !important;
  }
  .nyu-card-exit,
  .nyu-card-exit-left {
    transition-duration: 0.01ms !important;
  }
  .nyu-mosaic-cell {
    transition-duration: 0.01ms !important;
  }
  .nyu-mosaic.assembled {
    animation-duration: 0.01ms !important;
  }
  .sq-card {
    transition-duration: 0.01ms !important;
  }
  .sq-card.sq-tossing {
    animation-duration: 0.01ms !important;
  }
  .sq-card.sq-scatter {
    animation-duration: 0.01ms !important;
  }
  .caption-word {
    transition-duration: 0.01ms !important;
  }
  .caption-img-wrap {
    transition-duration: 0.01ms !important;
  }
  .confetti-cell {
    transition-duration: 0.01ms !important;
  }
  .confetti-mosaic.assembled {
    animation-duration: 0.01ms !important;
  }
  .confetti-mosaic.scattering .confetti-cell {
    transition-duration: 0.01ms !important;
  }
  .confetti-mosaic.floating .confetti-cell {
    transition-duration: 0.01ms !important;
  }
  .confetti-preview {
    transition-duration: 0.01ms !important;
  }
  .confetti-preview-img {
    transition-duration: 0.01ms !important;
  }
  .cinema-layer {
    transition-duration: 0.01ms !important;
  }
  .cinema-chapter {
    transition-duration: 0.01ms !important;
  }
  .cinema-layer .cinema-img {
    animation-duration: 0.01ms !important;
  }
  .reveal-label {
    animation-duration: 0.01ms !important;
  }
  .pulse-cell {
    transition-duration: 0.01ms !important;
  }
  .drift-hero {
    transition-duration: 0.01ms !important;
  }
  .drift-card {
    animation-duration: 0.01ms !important;
    transition-duration: 0.01ms !important;
  }
}

/* ===== Tier B ‚Äî disable backdrop-filter on weaker devices (Chrome Android, low-end) ===== */
:root.tier-b .floating-nav {
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
  background: rgba(245, 245, 247, 0.95);
}
:root.tier-b.dark .floating-nav {
  background: rgba(20, 20, 22, 0.95);
}
:root.tier-b .menu-btn {
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
}
@media (max-width: 768px) {
  :root.tier-b .floating-nav {
    background: none;
  }
  :root.tier-b.dark .floating-nav {
    background: none;
  }
  :root.tier-b .menu-btn {
    background: rgba(245, 245, 247, 0.95);
  }
  :root.tier-b.dark .menu-btn {
    background: rgba(50, 50, 55, 0.95);
  }
  :root.tier-b .logo {
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    background: rgba(245, 245, 247, 0.85);
  }
  :root.tier-b.dark .logo {
    background: rgba(28, 28, 30, 0.85);
  }
}
:root.tier-b .side-menu {
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
  background: rgba(245, 245, 247, 0.97);
}
:root.tier-b.dark .side-menu {
  background: rgba(28, 28, 30, 0.97);
}
:root.tier-b .sort-bar-inner {
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
  background: rgba(230, 230, 230, 0.92);
}
:root.tier-b.dark .sort-bar-inner {
  background: rgba(28, 28, 30, 0.92);
}
:root.tier-b .bento-nav,
:root.tier-b .bento-regen,
:root.tier-b .compass-random,
:root.tier-b .nyu-reel-nav {
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
  background: rgba(245, 245, 247, 0.9);
}
:root.tier-b.dark .bento-nav,
:root.tier-b.dark .bento-regen,
:root.tier-b.dark .compass-random,
:root.tier-b.dark .nyu-reel-nav {
  background: rgba(28, 28, 30, 0.9);
}
:root.tier-b .jeu-bar,
:root.tier-b .nyu-nav {
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
  background: rgba(245, 245, 247, 0.92);
}
:root.tier-b.dark .jeu-bar,
:root.tier-b.dark .nyu-nav {
  background: rgba(28, 28, 30, 0.92);
}
:root.tier-b .sq-deck-count {
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
  background: rgba(245, 245, 247, 0.95);
}
:root.tier-b.dark .sq-deck-count {
  background: rgba(28, 28, 30, 0.95);
}
:root.tier-b .drift-random {
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
  background: rgba(245, 245, 247, 0.9);
}
:root.tier-b.dark .drift-random {
  background: rgba(28, 28, 30, 0.9);
}
:root.tier-b .confetti-bomb {
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
  background: rgba(245, 245, 247, 0.85);
}
:root.tier-b.dark .confetti-bomb {
  background: rgba(28, 28, 30, 0.85);
}
:root.tier-b .jeu-card-btn {
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
}
:root.tier-b .jeu-favs-overlay {
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
  background: rgba(0, 0, 0, 0.75);
}
:root.tier-b .confetti-preview-backdrop,
:root.tier-b .lightbox-backdrop {
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
  background: rgba(0, 0, 0, 0.85);
}

/* ===== Tier C ‚Äî very low-end: no blur, no mosaic animation, instant transitions ===== */
:root.tier-c .floating-nav,
:root.tier-c .side-menu,
:root.tier-c .jeu-bar,
:root.tier-c .nyu-nav,
:root.tier-c .bento-nav,
:root.tier-c .bento-regen,
:root.tier-c .compass-random,
:root.tier-c .nyu-reel-nav,
:root.tier-c .sq-deck-count,
:root.tier-c .confetti-bomb,
:root.tier-c .jeu-card-btn,
:root.tier-c .jeu-favs-overlay,
:root.tier-c .confetti-preview-backdrop,
:root.tier-c .lightbox-backdrop,
:root.tier-c .sort-bar-inner {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}
:root.tier-c .nyu-mosaic-cell,
:root.tier-c .confetti-cell,
:root.tier-c .pulse-cell {
  transition-duration: 0.01ms !important;
  will-change: auto !important;
}
:root.tier-c .nyu-mosaic.assembled .nyu-mosaic-cell,
:root.tier-c .confetti-mosaic.assembled .confetti-cell {
  transition-duration: 0.01ms !important;
}
:root.tier-c .nyu-accent-layer,
:root.tier-c .nyu-canvas-bg {
  transition-duration: 0.01ms !important;
}
@media (max-width: 768px) {
  :root.tier-c .logo {
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    background: rgba(245, 245, 247, 0.85);
  }
  :root.tier-c.dark .logo {
    background: rgba(28, 28, 30, 0.85);
  }
  :root.tier-c .menu-btn {
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    background: rgba(245, 245, 247, 0.95);
  }
  :root.tier-c.dark .menu-btn {
    background: rgba(50, 50, 55, 0.95);
  }
}

/* ============================================================
   TINDER ‚Äî Mobile Validation
   Perf: compositor-only props (transform, opacity), no box-shadow
   on the swiping element, pre-promoted layers, rAF in JS.
   ============================================================ */
.tinder-container {
  position: fixed;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  /* Clear the floating nav (‚âà48px) + breathing room */
  padding: calc(env(safe-area-inset-top, 0px) + 64px) var(--space-5)
    calc(env(safe-area-inset-bottom, 0px) + 96px);
  background: var(--bg);
  overflow: hidden;
  overscroll-behavior: none;
  -webkit-overflow-scrolling: auto;
  z-index: 50; /* below floating-nav (not hiding it) */
}

.tinder-counter {
  font: 500 var(--text-caption)/1 var(--font);
  color: var(--text-muted);
  letter-spacing: 0.02em;
  margin-top: var(--space-4);
  margin-bottom: var(--space-1_5);
  user-select: none;
}

.tinder-stack {
  position: relative;
  width: 100%;
  max-width: min(calc(100vw - 48px), 380px);
  /* Height set by the aspect ratio of the image inside */
  aspect-ratio: 3 / 4;
  contain: layout style paint;
}
@media (min-width: 769px) {
  .tinder-container {
    justify-content: flex-start;
    padding: 88px var(--space-6) var(--space-8);
  }
  .tinder-stack {
    max-width: min(75vw, 1100px);
    aspect-ratio: 3 / 2;
  }
}

/* ‚îÄ‚îÄ Card ‚îÄ‚îÄ */
.tinder-card {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  overflow: visible; /* Allow pills to show below */
  will-change: transform, opacity;
  transform: translate3d(0, 0, 0);
  -webkit-transform: translate3d(0, 0, 0);
  user-select: none;
  -webkit-user-select: none;
  touch-action: none;
  /* No default transition ‚Äî JS sets it for exit/spring-back to avoid
       fighting with rAF-driven swipe. Keeps compositor path clean. */
  /* Fix for back-card bleeding (ensure it's not a square color block behind) */
  background: transparent !important;
  border-radius: 20px;
  box-shadow: none !important;
}

.tinder-card-content {
  display: flex;
  flex-direction: column;
  width: 100%;
  gap: 0;
}

/* Legacy .tinder-card-content img shadows removed (handled by .tinder-image-container) */
/* Front card: on top, interactive. Shadow applied to img directly. */
.tinder-card-front {
  z-index: 2;
}
/* Back card: underneath, very subtly scaled down for depth */
.tinder-card-back {
  z-index: 1;
  transform: translate3d(0, 0, 0) scale(0.99);
  opacity: 0.96;
}
/* Instant promotion: no visible scale-up animation */
.tinder-card-promoting {
  transition: opacity 0.12s ease-out;
}

/* ‚îÄ‚îÄ Image ‚îÄ‚îÄ */
.tinder-image-container {
  position: relative;
  width: 100%;
  aspect-ratio: 3 / 2;
  border-radius: 20px;
  overflow: hidden;
  /* Gorgeous Elevation */
  box-shadow:
    0 8px 32px rgba(0, 0, 0, 0.12),
    0 4px 16px rgba(0, 0, 0, 0.08),
    0 2px 8px rgba(0, 0, 0, 0.06);
  background: var(--bg-elevated);
  will-change: transform;
  transform: translate3d(0, 0, 0); /* Compositor promotion */
  /* Fix for "underlay bleeding": ensure background doesn't leak */
  background-clip: padding-box;
  -webkit-background-clip: padding-box;
}

/* Ensure no background color on the wrapper that could bleed */
.tinder-card-content {
  background: transparent;
  border-radius: 20px;
}

:root.dark .tinder-image-container {
  box-shadow:
    0 8px 32px rgba(0, 0, 0, 0.4),
    0 4px 16px rgba(0, 0, 0, 0.3),
    0 2px 8px rgba(0, 0, 0, 0.2);
}

/* ‚îÄ‚îÄ Image ‚îÄ‚îÄ */
.tinder-card img {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
  /* Radius handled by container clipping */
  /* Shadow handled by container */

  /* Prevent iOS tap highlight during swipe */
  -webkit-tap-highlight-color: transparent;
  will-change: auto;
  contain: layout style paint;
}
:root.dark .tinder-card img {
  box-shadow:
    0 8px 32px rgba(0, 0, 0, 0.5),
    0 4px 16px rgba(0, 0, 0, 0.3),
    0 2px 8px rgba(0, 0, 0, 0.2);
}
@media (max-width: 768px) {
  .tinder-image-container {
    aspect-ratio: 3 / 4;
  }
}
@media (min-width: 769px) {
  .tinder-image-container {
    aspect-ratio: 3 / 2;
  }
}

/* ‚îÄ‚îÄ Labels ‚Äî Below image ‚îÄ‚îÄ */
.tinder-gorgeous-pills {
  position: relative;
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  padding: 10px 12px;
  pointer-events: none;
  background: rgba(0, 255, 0, 0.2); /* DEBUG: visible green background */
  /* Prevent jitter during swipe ‚Äî no transitions, promoted layer */
  will-change: transform;
  transform: translate3d(0, 0, 0);
  -webkit-transform: translate3d(0, 0, 0);
}

/* Gorgeous pill base - smaller and narrower */
.tinder-gorgeous-pills .gorgeous-pill {
  padding: 3px 8px;
  font-size: 10px;
  font-weight: 600;
  border-radius: 12px;
  white-space: nowrap;
  letter-spacing: 0.01em;
  font-family: -apple-system, BlinkMacSystemFont, var(--font);
  /* No transitions ‚Äî prevents jitter during swipe */
  transition: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Category colors */
.tinder-gorgeous-pills .gorgeous-pill[data-category="camera"] {
  background: linear-gradient(
    135deg,
    rgba(255, 107, 0, 0.2),
    rgba(255, 148, 77, 0.2)
  );
  color: #ff8844;
  border: 1px solid rgba(255, 107, 0, 0.3);
}
.tinder-gorgeous-pills .gorgeous-pill[data-category="scene"],
.tinder-gorgeous-pills .gorgeous-pill[data-category="setting"] {
  background: linear-gradient(
    135deg,
    rgba(75, 192, 200, 0.18),
    rgba(91, 228, 238, 0.18)
  );
  color: #5bb8e0;
  border: 1px solid rgba(75, 192, 200, 0.25);
}
.tinder-gorgeous-pills .gorgeous-pill[data-category="vibe"],
.tinder-gorgeous-pills .gorgeous-pill[data-category="mood"] {
  background: linear-gradient(
    135deg,
    rgba(175, 82, 222, 0.18),
    rgba(198, 120, 221, 0.18)
  );
  color: #c68ddd;
  border: 1px solid rgba(175, 82, 222, 0.25);
}
.tinder-gorgeous-pills .gorgeous-pill[data-category="style"] {
  background: linear-gradient(
    135deg,
    rgba(255, 45, 85, 0.18),
    rgba(255, 100, 130, 0.18)
  );
  color: #ff6482;
  border: 1px solid rgba(255, 45, 85, 0.25);
}
.tinder-gorgeous-pills .gorgeous-pill[data-category="technique"],
.tinder-gorgeous-pills .gorgeous-pill[data-category="composition"] {
  background: linear-gradient(
    135deg,
    rgba(79, 140, 255, 0.18),
    rgba(115, 169, 255, 0.18)
  );
  color: #6ba4ff;
  border: 1px solid rgba(79, 140, 255, 0.25);
}
.tinder-gorgeous-pills .gorgeous-pill[data-category="time"] {
  background: linear-gradient(
    135deg,
    rgba(255, 149, 0, 0.18),
    rgba(255, 179, 64, 0.18)
  );
  color: #ffb340;
  border: 1px solid rgba(255, 149, 0, 0.25);
}
.tinder-gorgeous-pills .gorgeous-pill[data-category="color"],
.tinder-gorgeous-pills .gorgeous-pill[data-category="object"] {
  background: linear-gradient(
    135deg,
    rgba(52, 199, 89, 0.18),
    rgba(85, 219, 116, 0.18)
  );
  color: #5ddb74;
  border: 1px solid rgba(52, 199, 89, 0.25);
}

/* Primary pill (camera) - also smaller */
.tinder-gorgeous-pills .gorgeous-pill.primary {
  font-weight: 700;
  font-size: 10px;
  padding: 3px 10px;
  background: linear-gradient(
    135deg,
    rgba(255, 107, 0, 0.25),
    rgba(255, 148, 77, 0.25)
  );
  border: 1px solid rgba(255, 107, 0, 0.4);
  box-shadow: 0 1px 4px rgba(255, 107, 0, 0.12);
}

/* Dark mode */
:root.dark .tinder-gorgeous-pills .gorgeous-pill[data-category="camera"] {
  background: linear-gradient(
    135deg,
    rgba(255, 107, 0, 0.22),
    rgba(255, 148, 77, 0.22)
  );
  color: #ffaa66;
  border-color: rgba(255, 107, 0, 0.35);
}
:root.dark .tinder-gorgeous-pills .gorgeous-pill[data-category="scene"],
:root.dark .tinder-gorgeous-pills .gorgeous-pill[data-category="setting"] {
  background: linear-gradient(
    135deg,
    rgba(75, 192, 200, 0.22),
    rgba(91, 228, 238, 0.22)
  );
  color: #80d0ee;
  border-color: rgba(75, 192, 200, 0.3);
}
:root.dark .tinder-gorgeous-pills .gorgeous-pill[data-category="vibe"],
:root.dark .tinder-gorgeous-pills .gorgeous-pill[data-category="mood"] {
  background: linear-gradient(
    135deg,
    rgba(175, 82, 222, 0.22),
    rgba(198, 120, 221, 0.22)
  );
  color: #d4a8ed;
  border-color: rgba(175, 82, 222, 0.3);
}
:root.dark .tinder-gorgeous-pills .gorgeous-pill[data-category="style"] {
  background: linear-gradient(
    135deg,
    rgba(255, 45, 85, 0.22),
    rgba(255, 100, 130, 0.22)
  );
  color: #ff8aa4;
  border-color: rgba(255, 45, 85, 0.3);
}
:root.dark .tinder-gorgeous-pills .gorgeous-pill[data-category="technique"],
:root.dark .tinder-gorgeous-pills .gorgeous-pill[data-category="composition"] {
  background: linear-gradient(
    135deg,
    rgba(79, 140, 255, 0.22),
    rgba(115, 169, 255, 0.22)
  );
  color: #88bbff;
  border-color: rgba(79, 140, 255, 0.3);
}
:root.dark .tinder-gorgeous-pills .gorgeous-pill[data-category="time"] {
  background: linear-gradient(
    135deg,
    rgba(255, 149, 0, 0.22),
    rgba(255, 179, 64, 0.22)
  );
  color: #ffcc66;
  border-color: rgba(255, 149, 0, 0.3);
}
:root.dark .tinder-gorgeous-pills .gorgeous-pill[data-category="color"],
:root.dark .tinder-gorgeous-pills .gorgeous-pill[data-category="object"] {
  background: linear-gradient(
    135deg,
    rgba(52, 199, 89, 0.22),
    rgba(85, 219, 116, 0.22)
  );
  color: #77e98d;
  border-color: rgba(52, 199, 89, 0.3);
}
:root.dark .tinder-gorgeous-pills .gorgeous-pill.primary {
  background: linear-gradient(
    135deg,
    rgba(255, 107, 0, 0.28),
    rgba(255, 148, 77, 0.28)
  );
  color: #ffbb77;
  border-color: rgba(255, 107, 0, 0.45);
  box-shadow: 0 2px 12px rgba(255, 107, 0, 0.2);
}

@media (max-width: 768px) {
  .tinder-gorgeous-pills {
    padding: 8px 10px;
    gap: 4px;
  }
  .tinder-gorgeous-pills .gorgeous-pill {
    font-size: 9px;
    padding: 3px 8px;
  }
  .tinder-gorgeous-pills .gorgeous-pill.primary {
    font-size: 9px;
    padding: 3px 10px;
  }
}

/* ‚îÄ‚îÄ Overlays: two pre-colored layers, opacity-only = compositor ‚îÄ‚îÄ */
/* No CSS transition here ‚Äî JS drives opacity via rAF during swipe.
   CSS transition would fight the JS values and cause stutter. */
.tinder-overlay {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 1;
  opacity: 0;
  will-change: opacity;
  transform: translate3d(0, 0, 0);
}
.tinder-overlay-accept {
  background: rgba(52, 199, 89, 0.55);
}
.tinder-overlay-reject {
  background: rgba(255, 59, 48, 0.5);
}

/* ‚îÄ‚îÄ Desktop hover zones (left = reject, right = accept) ‚îÄ‚îÄ */
/* Each zone IS the overlay ‚Äî covers its half, colored bg shown on hover.
   No full-card overlay conflict. Pure CSS :hover. */
.tinder-hover-zone {
  position: absolute;
  top: 0;
  /* Match image container height so overlay doesn't cover pills */
  bottom: auto;
  aspect-ratio: 3 / 2;
  width: 50%;
  z-index: 3;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.15s ease;
  /* Ensure clipping matches image container */
  overflow: hidden;
}
.tinder-hover-left {
  left: 0;
  border-radius: 20px 0 0 20px;
}
.tinder-hover-right {
  right: 0;
  border-radius: 0 20px 20px 0;
}
@media (max-width: 768px) {
    .tinder-hover-zone { aspect-ratio: 3 / 4; }
}
.tinder-hover-left.hovered {
  background: none;
  cursor:
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32'%3E%3Ccircle cx='16' cy='16' r='14' fill='%23ff3b30' opacity='0.9'/%3E%3Cpath d='M11 11l10 10M21 11l-10 10' stroke='white' stroke-width='2.5' stroke-linecap='round'/%3E%3C/svg%3E")
      16 16,
    pointer;
}
.tinder-hover-right.hovered {
  background: none;
  cursor:
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32'%3E%3Ccircle cx='16' cy='16' r='14' fill='%2334c759' opacity='0.9'/%3E%3Cpath d='M10 16l4 4 8-8' stroke='white' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round' fill='none'/%3E%3C/svg%3E")
      16 16,
    pointer;
}

/* Disable scale animation on full-frame card images (tinder/picks) ‚Äî only fade */
.tinder-card-front .img-loading,
.tinder-card-front .img-loaded {
  transform: none !important;
}

/* Page background gradient on picks hover ‚Äî subtle green-to-red flow */
.tinder-container {
  transition: background 0.3s ease-out;
  background: var(--bg);
}
.picks-bg-reject .tinder-container {
  background: radial-gradient(
    ellipse at 30% 50%,
    rgba(255, 59, 48, 0.08) 0%,
    rgba(255, 59, 48, 0.04) 40%,
    transparent 70%
  ) !important;
}
.picks-bg-accept .tinder-container {
  background: radial-gradient(
    ellipse at 70% 50%,
    rgba(52, 199, 89, 0.08) 0%,
    rgba(52, 199, 89, 0.04) 40%,
    transparent 70%
  ) !important;
}
:root.dark .picks-bg-reject .tinder-container {
  background: radial-gradient(
    ellipse at 30% 50%,
    rgba(255, 69, 58, 0.12) 0%,
    rgba(255, 69, 58, 0.06) 40%,
    transparent 70%
  ) !important;
}
:root.dark .picks-bg-accept .tinder-container {
  background: radial-gradient(
    ellipse at 70% 50%,
    rgba(48, 209, 88, 0.12) 0%,
    rgba(48, 209, 88, 0.06) 40%,
    transparent 70%
  ) !important;
}

/* Card border tint on hover */
.tinder-card-front:has(.tinder-hover-left.hovered) {
  box-shadow: inset 4px 0 0 0 rgba(255, 59, 48, 0.6);
}
.tinder-card-front:has(.tinder-hover-right.hovered) {
  box-shadow: inset -4px 0 0 0 rgba(52, 199, 89, 0.6);
}

.tinder-hover-icon {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition:
    opacity 0.15s ease,
    transform 0.15s ease;
  transform: scale(0.85);
  pointer-events: none;
}
.tinder-hover-zone.hovered .tinder-hover-icon {
  opacity: 0;
  transform: scale(0.85);
}
.tinder-hover-icon-reject {
  background: rgba(255, 255, 255, 0.9);
  color: var(--system-red);
}
.tinder-hover-icon-accept {
  background: rgba(255, 255, 255, 0.9);
  color: var(--system-green);
}
:root.dark .tinder-hover-icon-reject,
:root.dark .tinder-hover-icon-accept {
  background: rgba(0, 0, 0, 0.6);
}

.tinder-empty {
  font: 400 var(--text-lg)/1.4 var(--font-display);
  color: var(--text-dim);
  text-align: center;
  padding: var(--space-16) var(--space-6);
}

/* ‚îÄ‚îÄ Minimap filmstrip ‚îÄ‚îÄ */
.tinder-minimap {
  display: flex;
  gap: 6px;
  align-items: center;
  justify-content: center;
  margin-bottom: var(--space-2);
  flex-shrink: 0;
}

.tinder-mini-slot {
  position: relative;
  width: 40px;
  height: 54px;
  border-radius: 6px;
  overflow: hidden;
  flex-shrink: 0;
  transition:
    transform 0.2s var(--ease-out-quart),
    opacity 0.2s ease;
}
.tinder-mini-slot img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.tinder-mini-empty {
  background: var(--fill-quaternary);
  opacity: 0.3;
}

.tinder-mini-current {
  width: 46px;
  height: 62px;
  border-radius: 8px;
  box-shadow: 0 0 0 2px var(--text);
}

.tinder-mini-future {
  opacity: 0.35;
}

.tinder-mini-tint {
  position: absolute;
  inset: 0;
  pointer-events: none;
}
.tinder-mini-accept {
  background: rgba(52, 199, 89, 0.45);
}
.tinder-mini-reject {
  background: rgba(255, 59, 48, 0.4);
}

/* Reduced motion: skip all animations, instant transitions */
@media (prefers-reduced-motion: reduce) {
  .tinder-card,
  .tinder-card-promoting,
  .tinder-overlay,
  .tinder-hover-icon,
  .tinder-mini-slot {
    transition: none !important;
  }
}

/* ============================================================
   PICKS ‚Äî Re-curation (reuses .tinder-* card stack classes)
   Only picks-specific style: empty state.
   ============================================================ */
.picks-empty {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100vh;
  height: 100dvh;
  font: 400 var(--text-lg)/1.4 var(--font-display);
  color: var(--text-dim);
  text-align: center;
  padding: var(--space-8);
}

/* ============================================================
   ISIT ‚Äî Clean card swipe for photo curation.

   Layer architecture (60fps compositor-only):
     .isit-container  = fixed fullscreen backdrop
     .isit-stack      = positioning context (NO paint containment, NO fixed aspect-ratio)
     .isit-card       = THE animated element ‚Äî transform + opacity only (promoted layer)
     .isit-image-wrap = clipping container: border-radius + overflow:hidden + box-shadow
     .isit-gorgeous-pills = label pills BELOW image wrap, inside card (never clipped)
     .isit-hover-zone = click zones INSIDE image wrap

   Only .isit-card gets will-change + translate3d. Nothing else needs layer promotion
   because children inherit the card's composited layer during swipe.
   ============================================================ */

.isit-container {
  /* 10% of the shortest viewport edge as uniform breathing room */
  --isit-edge: min(10vw, 10vh);
  position: fixed;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  padding: calc(env(safe-area-inset-top, 0px) + var(--isit-edge))
    var(--isit-edge)
    calc(env(safe-area-inset-bottom, 0px) + var(--isit-edge));
  background: var(--bg);
  overflow: hidden;
  overscroll-behavior: none;
  -webkit-overflow-scrolling: auto;
  z-index: 50;
  transition: background 0.3s ease-out;
}

/* ‚îÄ‚îÄ Subbar: counter + minimap on one row under the card ‚îÄ‚îÄ */
.isit-subbar {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  width: 100%;
  max-width: 100%;
  margin-top: 10px;
}
@media (min-width: 769px) {
  .isit-subbar {
    max-width: min(80vw, 1100px);
  }
}

.isit-counter {
  font: 500 var(--text-caption)/1 var(--font);
  color: var(--text-muted);
  letter-spacing: 0.02em;
  user-select: none;
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
}

/* ‚îÄ‚îÄ Stack: positioning context only ‚îÄ‚îÄ
   contain: layout style (NO paint ‚Äî paint clips box-shadows on children)
   NO aspect-ratio ‚Äî the card content (image wrap + pills) determines height.
   Width is constrained, height flows naturally so pills are never clipped. */
.isit-stack {
  position: relative;
  width: 100%;
  max-width: 100%;
  aspect-ratio: 3 / 4;
  contain: layout style;
}
@media (min-width: 769px) {
  .isit-stack {
    max-width: min(80vw, 1100px);
    aspect-ratio: 3 / 2;
  }
}

/* ‚îÄ‚îÄ Card: THE ONLY animated element ‚îÄ‚îÄ
   Promoted to its own compositor layer via will-change + translate3d.
   During swipe: JS sets transform: translate3d(x, y, 0) rotate(deg)
   During exit: JS animates opacity to 0.
   Both properties stay on compositor thread ‚Äî zero layout, zero paint. */
.isit-card {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  will-change: transform, opacity;
  transform: translate3d(0, 0, 0);
  -webkit-transform: translate3d(0, 0, 0);
  user-select: none;
  -webkit-user-select: none;
  touch-action: none;
}

.isit-card-front {
  z-index: 2;
}

/* Back card: peeking out behind front ‚Äî sells the "stack" depth */
.isit-card-back {
  z-index: 1;
  transform: translate3d(0, 4px, 0) scale(0.97);
  opacity: 0.88;
}

.isit-card-promoting {
  transition: opacity 0.12s ease-out;
}

/* ‚îÄ‚îÄ Image wrap: single clipping container ‚îÄ‚îÄ
   border-radius + overflow:hidden clips the image and hover zones.
   box-shadow renders OUTSIDE the clip (shadow is painted on the element's
   box, not inside overflow:hidden), so it's fully visible.
   NO will-change, NO translate3d ‚Äî the parent .isit-card already has
   compositor promotion, and this element doesn't animate independently. */
.isit-image-wrap {
  position: relative;
  width: 100%;
  aspect-ratio: 3 / 4;
  border-radius: 64px;
  overflow: hidden;
  background: var(--bg-elevated);
  background-clip: padding-box;
  -webkit-background-clip: padding-box;
  /* Splendid elevation ‚Äî every card in the stack feels lifted */
  box-shadow:
    0 2px 4px rgba(0, 0, 0, 0.04),
    0 4px 12px rgba(0, 0, 0, 0.06),
    0 8px 24px rgba(0, 0, 0, 0.08),
    0 16px 48px rgba(0, 0, 0, 0.10);
}
:root.dark .isit-image-wrap {
  box-shadow:
    0 2px 4px rgba(0, 0, 0, 0.12),
    0 4px 12px rgba(0, 0, 0, 0.18),
    0 8px 24px rgba(0, 0, 0, 0.24),
    0 16px 48px rgba(0, 0, 0, 0.32);
}
@media (min-width: 769px) {
  .isit-image-wrap {
    aspect-ratio: 3 / 2;
  }
}

/* ‚îÄ‚îÄ Image ‚îÄ‚îÄ
   No contain or will-change ‚Äî the card's layer promotion is sufficient.
   The image just fills the wrap and gets clipped by its overflow:hidden. */
.isit-card img {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
  -webkit-tap-highlight-color: transparent;
}

/* Disable scale animation on card images ‚Äî only fade */
.isit-card-front .img-loading,
.isit-card-front .img-loaded {
  transform: none !important;
}

/* ‚îÄ‚îÄ Labels ‚Äî Below image wrap, inside card ‚îÄ‚îÄ
   No will-change or translate3d needed. These sit in normal flow
   below the image wrap. Because .isit-stack has no paint containment
   and no fixed aspect-ratio, pills are never clipped. */
.isit-gorgeous-pills {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  padding: 10px 0;
  pointer-events: none;
}

.isit-gorgeous-pills .gorgeous-pill {
  padding: 3px 8px;
  font-size: 10px;
  font-weight: 600;
  border-radius: 12px;
  white-space: nowrap;
  letter-spacing: 0.01em;
  font-family: -apple-system, BlinkMacSystemFont, var(--font);
  transition: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Category colors ‚Äî same palette as tinder pills */
.isit-gorgeous-pills .gorgeous-pill[data-category="camera"] {
  background: linear-gradient(135deg, rgba(255, 107, 0, 0.2), rgba(255, 148, 77, 0.2));
  color: #ff8844;
  border: 1px solid rgba(255, 107, 0, 0.3);
}
.isit-gorgeous-pills .gorgeous-pill[data-category="scene"],
.isit-gorgeous-pills .gorgeous-pill[data-category="setting"] {
  background: linear-gradient(135deg, rgba(75, 192, 200, 0.18), rgba(91, 228, 238, 0.18));
  color: #5bb8e0;
  border: 1px solid rgba(75, 192, 200, 0.25);
}
.isit-gorgeous-pills .gorgeous-pill[data-category="vibe"],
.isit-gorgeous-pills .gorgeous-pill[data-category="mood"] {
  background: linear-gradient(135deg, rgba(175, 82, 222, 0.18), rgba(198, 120, 221, 0.18));
  color: #c68ddd;
  border: 1px solid rgba(175, 82, 222, 0.25);
}
.isit-gorgeous-pills .gorgeous-pill[data-category="style"] {
  background: linear-gradient(135deg, rgba(255, 45, 85, 0.18), rgba(255, 100, 130, 0.18));
  color: #ff6482;
  border: 1px solid rgba(255, 45, 85, 0.25);
}
.isit-gorgeous-pills .gorgeous-pill[data-category="technique"],
.isit-gorgeous-pills .gorgeous-pill[data-category="composition"] {
  background: linear-gradient(135deg, rgba(79, 140, 255, 0.18), rgba(115, 169, 255, 0.18));
  color: #6ba4ff;
  border: 1px solid rgba(79, 140, 255, 0.25);
}
.isit-gorgeous-pills .gorgeous-pill[data-category="time"] {
  background: linear-gradient(135deg, rgba(255, 149, 0, 0.18), rgba(255, 179, 64, 0.18));
  color: #ffb340;
  border: 1px solid rgba(255, 149, 0, 0.25);
}
.isit-gorgeous-pills .gorgeous-pill[data-category="color"],
.isit-gorgeous-pills .gorgeous-pill[data-category="object"] {
  background: linear-gradient(135deg, rgba(52, 199, 89, 0.18), rgba(85, 219, 116, 0.18));
  color: #5ddb74;
  border: 1px solid rgba(52, 199, 89, 0.25);
}
.isit-gorgeous-pills .gorgeous-pill.primary {
  font-weight: 700;
  font-size: 10px;
  padding: 3px 10px;
  background: linear-gradient(135deg, rgba(255, 107, 0, 0.25), rgba(255, 148, 77, 0.25));
  border: 1px solid rgba(255, 107, 0, 0.4);
  box-shadow: 0 1px 4px rgba(255, 107, 0, 0.12);
}

/* Dark mode pills */
:root.dark .isit-gorgeous-pills .gorgeous-pill[data-category="camera"] {
  background: linear-gradient(135deg, rgba(255, 107, 0, 0.22), rgba(255, 148, 77, 0.22));
  color: #ffaa66;
  border-color: rgba(255, 107, 0, 0.35);
}
:root.dark .isit-gorgeous-pills .gorgeous-pill[data-category="scene"],
:root.dark .isit-gorgeous-pills .gorgeous-pill[data-category="setting"] {
  background: linear-gradient(135deg, rgba(75, 192, 200, 0.22), rgba(91, 228, 238, 0.22));
  color: #80d0ee;
  border-color: rgba(75, 192, 200, 0.3);
}
:root.dark .isit-gorgeous-pills .gorgeous-pill[data-category="vibe"],
:root.dark .isit-gorgeous-pills .gorgeous-pill[data-category="mood"] {
  background: linear-gradient(135deg, rgba(175, 82, 222, 0.22), rgba(198, 120, 221, 0.22));
  color: #d4a8ed;
  border-color: rgba(175, 82, 222, 0.3);
}
:root.dark .isit-gorgeous-pills .gorgeous-pill[data-category="style"] {
  background: linear-gradient(135deg, rgba(255, 45, 85, 0.22), rgba(255, 100, 130, 0.22));
  color: #ff8aa4;
  border-color: rgba(255, 45, 85, 0.3);
}
:root.dark .isit-gorgeous-pills .gorgeous-pill[data-category="technique"],
:root.dark .isit-gorgeous-pills .gorgeous-pill[data-category="composition"] {
  background: linear-gradient(135deg, rgba(79, 140, 255, 0.22), rgba(115, 169, 255, 0.22));
  color: #88bbff;
  border-color: rgba(79, 140, 255, 0.3);
}
:root.dark .isit-gorgeous-pills .gorgeous-pill[data-category="time"] {
  background: linear-gradient(135deg, rgba(255, 149, 0, 0.22), rgba(255, 179, 64, 0.22));
  color: #ffcc66;
  border-color: rgba(255, 149, 0, 0.3);
}
:root.dark .isit-gorgeous-pills .gorgeous-pill[data-category="color"],
:root.dark .isit-gorgeous-pills .gorgeous-pill[data-category="object"] {
  background: linear-gradient(135deg, rgba(52, 199, 89, 0.22), rgba(85, 219, 116, 0.22));
  color: #77e98d;
  border-color: rgba(52, 199, 89, 0.3);
}
:root.dark .isit-gorgeous-pills .gorgeous-pill.primary {
  background: linear-gradient(135deg, rgba(255, 107, 0, 0.28), rgba(255, 148, 77, 0.28));
  color: #ffbb77;
  border-color: rgba(255, 107, 0, 0.45);
  box-shadow: 0 2px 12px rgba(255, 107, 0, 0.2);
}

@media (max-width: 768px) {
  .isit-gorgeous-pills {
    padding: 8px 10px;
    gap: 4px;
  }
  .isit-gorgeous-pills .gorgeous-pill {
    font-size: 9px;
    padding: 3px 8px;
  }
  .isit-gorgeous-pills .gorgeous-pill.primary {
    font-size: 9px;
    padding: 3px 10px;
  }
}

/* ‚îÄ‚îÄ Overlays removed ‚Äî swipe feedback is card motion only ‚îÄ‚îÄ */

/* ‚îÄ‚îÄ Desktop hover zones ‚Äî INSIDE the wrap, clipped by its radius ‚îÄ‚îÄ */
.isit-hover-zone {
  position: absolute;
  top: 0;
  bottom: 0;
  width: 50%;
  z-index: 3;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.15s ease;
}
.isit-hover-left {
  left: 0;
  /* No border-radius needed ‚Äî wrap clips it */
}
.isit-hover-right {
  right: 0;
}

.isit-hover-left.hovered {
  background: none;
  cursor:
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32'%3E%3Ccircle cx='16' cy='16' r='14' fill='%23ff3b30' opacity='0.9'/%3E%3Cpath d='M11 11l10 10M21 11l-10 10' stroke='white' stroke-width='2.5' stroke-linecap='round'/%3E%3C/svg%3E")
      16 16,
    pointer;
}
.isit-hover-right.hovered {
  background: none;
  cursor:
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32'%3E%3Ccircle cx='16' cy='16' r='14' fill='%2334c759' opacity='0.9'/%3E%3Cpath d='M10 16l4 4 8-8' stroke='white' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round' fill='none'/%3E%3C/svg%3E")
      16 16,
    pointer;
}

/* Page background gradient on hover */
.picks-bg-reject .isit-container {
  background: radial-gradient(
    ellipse at 30% 50%,
    rgba(255, 59, 48, 0.08) 0%,
    rgba(255, 59, 48, 0.04) 40%,
    transparent 70%
  ) !important;
}
.picks-bg-accept .isit-container {
  background: radial-gradient(
    ellipse at 70% 50%,
    rgba(52, 199, 89, 0.08) 0%,
    rgba(52, 199, 89, 0.04) 40%,
    transparent 70%
  ) !important;
}
:root.dark .picks-bg-reject .isit-container {
  background: radial-gradient(
    ellipse at 30% 50%,
    rgba(255, 69, 58, 0.12) 0%,
    rgba(255, 69, 58, 0.06) 40%,
    transparent 70%
  ) !important;
}
:root.dark .picks-bg-accept .isit-container {
  background: radial-gradient(
    ellipse at 70% 50%,
    rgba(48, 209, 88, 0.12) 0%,
    rgba(48, 209, 88, 0.06) 40%,
    transparent 70%
  ) !important;
}

.isit-hover-icon {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition:
    opacity 0.15s ease,
    transform 0.15s ease;
  transform: scale(0.85);
  pointer-events: none;
}
.isit-hover-zone.hovered .isit-hover-icon {
  opacity: 0;
  transform: scale(0.85);
}
.isit-hover-icon-reject {
  background: rgba(255, 255, 255, 0.9);
  color: var(--system-red);
}
.isit-hover-icon-accept {
  background: rgba(255, 255, 255, 0.9);
  color: var(--system-green);
}
:root.dark .isit-hover-icon-reject,
:root.dark .isit-hover-icon-accept {
  background: rgba(0, 0, 0, 0.6);
}

.isit-empty {
  font: 400 var(--text-lg)/1.4 var(--font-display);
  color: var(--text-dim);
  text-align: center;
  padding: var(--space-16) var(--space-6);
}

/* ‚îÄ‚îÄ Minimap filmstrip ‚îÄ‚îÄ */
.isit-minimap {
  display: flex;
  gap: 4px;
  align-items: center;
  flex-shrink: 0;
}

.isit-mini-slot {
  position: relative;
  width: 40px;
  height: 54px;
  border-radius: 6px;
  overflow: hidden;
  flex-shrink: 0;
  transition:
    transform 0.2s var(--ease-out-quart),
    opacity 0.2s ease;
}
.isit-mini-slot img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.isit-mini-empty {
  background: var(--fill-quaternary);
  opacity: 0.3;
}

.isit-mini-current {
  box-shadow: 0 0 0 2px var(--text);
}

.isit-mini-future {
  opacity: 0.35;
}

.isit-mini-tint {
  position: absolute;
  inset: 0;
  pointer-events: none;
}
.isit-mini-accept {
  background: rgba(52, 199, 89, 0.45);
}
.isit-mini-reject {
  background: rgba(255, 59, 48, 0.4);
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .isit-card,
  .isit-card-promoting,
  .isit-overlay,
  .isit-hover-icon,
  .isit-mini-slot {
    transition: none !important;
  }
}
