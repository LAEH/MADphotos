/* ===== Reset & Base ===== */
*, *::before, *::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* ============================================================
   DESIGN TOKENS — Minimal Black & White
   Typography does the work. Space is the luxury.
   Color only where it carries meaning.
   ============================================================ */
:root {
    /* ── Apple System Colors (Light) — kept for semantic use only ── */
    --system-red: rgb(255, 59, 48);
    --system-orange: rgb(255, 149, 0);
    --system-yellow: rgb(255, 204, 0);
    --system-green: rgb(52, 199, 89);
    --system-mint: rgb(0, 199, 190);
    --system-teal: rgb(48, 176, 199);
    --system-cyan: rgb(50, 173, 230);
    --system-blue: rgb(0, 122, 255);
    --system-indigo: rgb(88, 86, 214);
    --system-purple: rgb(175, 82, 222);
    --system-pink: rgb(255, 45, 85);
    --system-brown: rgb(162, 132, 94);

    /* ── Grays (Light) ── */
    --system-gray: rgb(142, 142, 147);
    --system-gray-2: rgb(174, 174, 178);
    --system-gray-3: rgb(199, 199, 204);
    --system-gray-4: rgb(209, 209, 214);
    --system-gray-5: rgb(229, 229, 234);
    --system-gray-6: rgb(242, 242, 247);

    /* ── Surfaces — Light ── */
    --bg: #ffffff;
    --bg-elevated: #f5f5f5;
    --bg-tertiary: #ebebeb;
    --text: #000000;
    --text-dim: #6e6e73;
    --text-muted: #aeaeb2;
    --header-bg: rgba(255, 255, 255, 0.88);
    --separator: rgba(0, 0, 0, 0.08);

    /* ── Glass — neutral ── */
    --glass-bg: rgba(120, 120, 128, 0.04);
    --glass-bg-hover: rgba(120, 120, 128, 0.08);
    --glass-border: rgba(0, 0, 0, 0.08);
    --glass-border-hover: rgba(0, 0, 0, 0.18);

    /* ── Fill Colors ── */
    --fill-primary: rgba(120, 120, 128, 0.2);
    --fill-secondary: rgba(120, 120, 128, 0.16);
    --fill-tertiary: rgba(118, 118, 128, 0.12);
    --fill-quaternary: rgba(116, 116, 128, 0.08);

    /* ── Elevation ── */
    --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.06);
    --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.08);
    --shadow-lg: 0 12px 28px rgba(0, 0, 0, 0.1), 0 4px 10px rgba(0, 0, 0, 0.04);
    --shadow-elevated: 0 4px 16px rgba(0, 0, 0, 0.08), 0 12px 40px rgba(0, 0, 0, 0.06);
    --shadow-bento: 0 4px 16px rgba(0, 0, 0, 0.12), 0 12px 40px rgba(0, 0, 0, 0.08), 0 24px 80px rgba(0, 0, 0, 0.06);
    --shadow-float: 0 8px 32px rgba(0, 0, 0, 0.15);
    --shadow-deck: 0 8px 32px rgba(0, 0, 0, 0.3);

    /* ── Layout ── */
    --radius-xs: 4px;
    --radius-sm: 6px;
    --radius: 8px;
    --radius-lg: 12px;
    --radius-xl: 16px;
    --radius-full: 9999px;

    /* ── Spacing Scale ── */
    --space-0_5: 2px;
    --space-1: 4px;
    --space-1_5: 6px;
    --space-2: 8px;
    --space-2_5: 10px;
    --space-3: 12px;
    --space-3_5: 14px;
    --space-4: 16px;
    --space-4_5: 18px;
    --space-5: 20px;
    --space-6: 24px;
    --space-7: 28px;
    --space-8: 32px;
    --space-10: 40px;
    --space-12: 48px;
    --space-16: 64px;
    --space-20: 80px;

    /* ── Type Scale ── */
    --text-2xs: 10px;
    --text-xs: 11px;
    --text-caption: 12px;
    --text-sm: 13px;
    --text-base: 15px;
    --text-lg: 17px;
    --text-xl: 20px;
    --text-2xl: 22px;
    --text-3xl: 28px;
    --text-4xl: 34px;
    --text-5xl: 48px;
    --text-6xl: 64px;

    /* ── Motion — Apple HIG curves ── */
    --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
    --ease-out-quart: cubic-bezier(0.25, 1, 0.5, 1);
    --ease-in-out: cubic-bezier(0.45, 0, 0.15, 1);
    --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
    --duration-fast: 150ms;
    --duration-normal: 250ms;
    --duration-slow: 400ms;
    --transition: var(--duration-normal) var(--ease-out-quart);

    /* ── Typography ── */
    --font: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Helvetica Neue', system-ui, sans-serif;
    --font-mono: 'SF Mono', ui-monospace, 'Fira Code', 'JetBrains Mono', monospace;
    --font-display: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', system-ui, sans-serif;

    /* ── Category colors — monochrome ── */
    --c-vibe: var(--text-dim);
    --c-grading: var(--text-dim);
    --c-time: var(--text-dim);
    --c-setting: var(--text-dim);
    --c-scene: var(--text-dim);
    --c-emotion: var(--text-dim);
    --c-camera: var(--text-dim);
    --c-style: var(--text-dim);

    /* ── Emotion colors — kept for Faces (semantic) ── */
    --emo-happy: var(--system-green);
    --emo-sad: var(--system-cyan);
    --emo-angry: var(--system-red);
    --emo-surprise: var(--system-orange);
    --emo-fear: var(--system-purple);
    --emo-disgust: var(--system-gray);
    --emo-neutral: var(--system-gray-2);
    --emo-contempt: var(--system-pink);

    /* ── Semantic colors ── */
    --color-error: var(--system-red);
    --color-success: var(--system-green);

    /* ── Depth layer visualization ── */
    --depth-near: rgba(50, 173, 230, 0.5);
    --depth-mid: rgba(52, 199, 89, 0.3);
    --depth-far: rgba(255, 59, 48, 0.3);
}

/* ============================================================
   DARK MODE — toggled via .dark class on <html>
   ============================================================ */
:root.dark {
    --system-red: rgb(255, 69, 58);
    --system-orange: rgb(255, 159, 10);
    --system-yellow: rgb(255, 214, 10);
    --system-green: rgb(48, 209, 88);
    --system-mint: rgb(99, 230, 226);
    --system-teal: rgb(64, 200, 224);
    --system-cyan: rgb(100, 210, 255);
    --system-blue: rgb(10, 132, 255);
    --system-indigo: rgb(94, 92, 230);
    --system-purple: rgb(191, 90, 242);
    --system-pink: rgb(255, 55, 95);
    --system-brown: rgb(172, 142, 104);

    --system-gray: rgb(142, 142, 147);
    --system-gray-2: rgb(99, 99, 102);
    --system-gray-3: rgb(72, 72, 74);
    --system-gray-4: rgb(58, 58, 60);
    --system-gray-5: rgb(44, 44, 46);
    --system-gray-6: rgb(28, 28, 30);

    --bg: #000000;
    --bg-elevated: #1c1c1e;
    --bg-tertiary: #2c2c2e;
    --text: #f5f5f7;
    --text-dim: #8e8e93;
    --text-muted: #636366;
    --header-bg: rgba(0, 0, 0, 0.88);
    --separator: rgba(255, 255, 255, 0.06);

    --glass-bg: rgba(255, 255, 255, 0.06);
    --glass-bg-hover: rgba(255, 255, 255, 0.12);
    --glass-border: rgba(255, 255, 255, 0.08);
    --glass-border-hover: rgba(255, 255, 255, 0.18);

    --fill-primary: rgba(120, 120, 128, 0.36);
    --fill-secondary: rgba(120, 120, 128, 0.32);
    --fill-tertiary: rgba(118, 118, 128, 0.24);
    --fill-quaternary: rgba(118, 118, 128, 0.18);

    --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.2);
    --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.3);
    --shadow-lg: 0 12px 28px rgba(0, 0, 0, 0.5);
    --shadow-elevated: 0 4px 16px rgba(0, 0, 0, 0.2), 0 12px 40px rgba(0, 0, 0, 0.15);
    --shadow-bento: 0 4px 16px rgba(0, 0, 0, 0.3), 0 12px 40px rgba(0, 0, 0, 0.2), 0 24px 80px rgba(0, 0, 0, 0.15);
    --shadow-float: 0 8px 32px rgba(0, 0, 0, 0.4);
    --shadow-deck: 0 8px 32px rgba(0, 0, 0, 0.5);

    --depth-near: rgba(100, 210, 255, 0.5);
    --depth-mid: rgba(48, 209, 88, 0.3);
    --depth-far: rgba(255, 69, 58, 0.3);
}

/* All experiences use the active theme (light/dark) — no forced overrides. */

/* ============================================================
   ANIMATIONS — Only functional ones
   ============================================================ */
@keyframes fade-up {
    from {
        opacity: 0;
        transform: translateY(16px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

@keyframes blink {
    50% { opacity: 0; }
}

/* ── Image loading transitions ──
   Two-phase loading: start invisible, fade in once fully loaded.
   .img-loading  = not yet loaded (opacity 0, !important to beat
                    any specificity on the element's resting state)
   .img-loaded   = fully decoded, fade to 1. Class is auto-removed
                    after the transition ends (in JS) so it does not
                    permanently override other transitions on the
                    same element (e.g. grid-item img hover scale). */
.img-loading {
    opacity: 0 !important;
}
.img-loaded {
    opacity: 1;
    transition: opacity var(--duration-slow) var(--ease-out-quart) !important;
}

/* Face crop canvases: same two-phase pattern */
.face-crop-loading {
    opacity: 0;
}
.face-crop-loaded {
    opacity: 1;
    transition: opacity var(--duration-slow) var(--ease-out-quart);
}

/* ===== Base ===== */
html {
    scroll-behavior: smooth;
}

body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font);
    font-size: 14px;
    line-height: 1.5;
    min-height: 100vh;
    min-height: 100dvh;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    overflow-wrap: break-word;
    -webkit-text-size-adjust: 100%;
}

/* ===== Header ===== */
#header {
    position: sticky;
    top: 0;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-3) var(--space-6);
    background: var(--header-bg);
    backdrop-filter: saturate(180%) blur(20px);
    -webkit-backdrop-filter: saturate(180%) blur(20px);
    border-bottom: 1px solid var(--separator);
}

.header-left {
    display: flex;
    align-items: baseline;
    gap: var(--space-3);
}

.logo {
    font-family: var(--font-display);
    font-size: var(--text-lg);
    letter-spacing: -0.01em;
    color: var(--text);
    text-decoration: none;
    cursor: pointer;
    transition: opacity var(--duration-fast) var(--ease-out-quart);
}

/* hover: see @media (hover: hover) guard */

.logo-mad {
    font-weight: 900;
}

.logo-photos {
    font-weight: 400;
}

.header-exp-name {
    font-size: var(--text-sm);
    color: var(--text-dim);
    font-weight: 400;
}

/* Header right group */
.header-right {
    display: flex;
    align-items: center;
    gap: var(--space-2);
}

/* Theme toggle */
.theme-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    background: none;
    border: 1px solid var(--glass-border);
    border-radius: var(--radius);
    color: var(--text-dim);
    cursor: pointer;
    transition: color var(--transition), border-color var(--transition);
    flex-shrink: 0;
}

/* hover: see @media (hover: hover) guard */

/* Show sun in dark mode, moon in light mode */
.theme-icon-sun { display: none; }
.theme-icon-moon { display: block; }
:root.dark .theme-icon-sun { display: block; }
:root.dark .theme-icon-moon { display: none; }

/* Tabs */
.tabs {
    display: flex;
    gap: var(--space-0_5);
}

.tab {
    background: transparent;
    border: 1px solid transparent;
    color: var(--text-dim);
    font-family: var(--font);
    font-size: var(--text-sm);
    padding: var(--space-1_5) var(--space-4);
    cursor: pointer;
    border-radius: var(--radius);
    transition: background var(--transition), color var(--transition), border-color var(--transition);
}

/* hover: see @media (hover: hover) guard */

.tab.active {
    color: var(--text);
    background: var(--glass-bg-hover);
    border-color: var(--glass-border);
}

/* ===== Views ===== */
#main {
    padding: 0;
}

.view {
    display: none;
    min-height: calc(100vh - 52px);
}

.view.active {
    display: block;
    animation: fade-up 0.4s var(--ease-out-expo) both;
}

/* ===== Side Menu — Floating popover ===== */
.side-menu-backdrop {
    position: fixed;
    inset: 0;
    z-index: 90;
    opacity: 0;
    pointer-events: none;
    transition: opacity var(--duration-normal) var(--ease-out-quart);
}

.side-menu-backdrop.open {
    opacity: 1;
    pointer-events: auto;
}

.side-menu {
    position: fixed;
    top: var(--space-16);
    left: var(--space-5);
    z-index: 95;
    min-width: 180px;
    background: var(--header-bg);
    backdrop-filter: saturate(200%) blur(40px);
    -webkit-backdrop-filter: saturate(200%) blur(40px);
    border: 1px solid var(--glass-border-hover);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-lg);
    padding: var(--space-2);
    opacity: 0;
    transform: translateY(-8px) scale(0.96);
    transform-origin: top left;
    pointer-events: none;
    transition: opacity var(--duration-normal) var(--ease-out-expo),
                transform var(--duration-normal) var(--ease-out-expo);
}

.side-menu.open {
    opacity: 1;
    transform: translateY(0) scale(1);
    pointer-events: auto;
}

.side-menu-list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 1px;
}

.side-menu-item {
    font-family: var(--font-display);
    font-size: var(--text-sm);
    font-weight: 400;
    color: var(--text-dim);
    padding: var(--space-2) var(--space-3_5);
    border-radius: var(--radius);
    cursor: pointer;
    transition: background var(--duration-fast) var(--ease-out-quart),
                color var(--duration-fast) var(--ease-out-quart);
}

/* hover: see @media (hover: hover) guard */

.side-menu-item.active {
    color: var(--text);
    font-weight: 600;
    background: var(--glass-bg);
}

.side-menu-about {
    font-size: var(--text-xs);
    text-transform: uppercase;
    letter-spacing: var(--tracking-caps);
    color: var(--text-muted);
    margin-bottom: var(--space-1);
    border-bottom: 1px solid var(--separator);
    padding-bottom: var(--space-2);
    border-radius: var(--radius) var(--radius) 0 0;
}

/* ===== Glass Tags — Monochrome Default ===== */
.glass-tag {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
    padding: var(--space-1) var(--space-3);
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    font-size: var(--text-xs);
    color: var(--text-dim);
    cursor: pointer;
    transition: background var(--duration-fast) var(--ease-out-quart),
                border-color var(--duration-fast) var(--ease-out-quart);
    white-space: nowrap;
    user-select: none;
    text-transform: capitalize;
}

/* hover: see @media (hover: hover) guard */

.glass-tag.active {
    background: var(--fill-secondary);
    border-color: var(--glass-border-hover);
    color: var(--text);
}

/* Category tags — all monochrome */
.glass-tag.tag-vibe,
.glass-tag.tag-grading,
.glass-tag.tag-time,
.glass-tag.tag-setting,
.glass-tag.tag-scene,
.glass-tag.tag-emotion,
.glass-tag.tag-camera,
.glass-tag.tag-style {
    border-color: var(--glass-border);
    color: var(--text-dim);
}

/* category tag hover: see @media (hover: hover) guard */

.glass-tag.tag-vibe.active,
.glass-tag.tag-grading.active,
.glass-tag.tag-time.active,
.glass-tag.tag-setting.active,
.glass-tag.tag-scene.active,
.glass-tag.tag-emotion.active,
.glass-tag.tag-camera.active,
.glass-tag.tag-style.active {
    background: var(--fill-secondary);
    border-color: var(--glass-border-hover);
    color: var(--text);
}

/* Exception: tags inside Faces keep emotion colors */
.faces-container .glass-tag.tag-emotion {
    border-color: color-mix(in srgb, var(--system-pink) 35%, transparent);
    color: var(--system-pink);
}
/* hover: see @media (hover: hover) guard */

.glass-tag .dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    flex-shrink: 0;
}

/* ===== Filter Bar ===== */
.filter-bar {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-1_5);
    padding: var(--space-3) var(--space-6);
    min-height: 44px;
    border-bottom: 1px solid var(--separator);
}

.filter-bar .filter-label {
    font-size: var(--text-xs);
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-right: var(--space-1);
}

.filter-bar .clear-btn {
    font-family: var(--font);
    font-size: var(--text-xs);
    color: var(--text-dim);
    background: none;
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-sm);
    padding: 3px var(--space-2_5);
    cursor: pointer;
    transition: background var(--transition), border-color var(--transition), color var(--transition);
}

/* hover: see @media (hover: hover) guard */

.filter-count {
    font-size: var(--text-caption);
    color: var(--text-dim);
    margin-left: auto;
    font-variant-numeric: tabular-nums;
}

/* ===== Sort (was La Grille) ===== */
.sort-bar {
    display: flex;
    justify-content: center;
    padding: var(--space-4) var(--space-6);
    position: sticky;
    top: 52px;
    z-index: 10;
}

.sort-bar-inner {
    display: flex;
    align-items: center;
    gap: var(--space-0_5);
    padding: var(--space-1_5) var(--space-2_5);
    background: rgba(230, 230, 230, 0.35);
    backdrop-filter: saturate(150%) blur(40px);
    -webkit-backdrop-filter: saturate(150%) blur(40px);
    border: 1px solid var(--glass-border-hover);
    border-radius: var(--radius-full);
    box-shadow: var(--shadow-sm);
}

:root.dark .sort-bar-inner {
    background: rgba(28, 28, 30, 0.6);
}

.sort-btn {
    font-family: var(--font);
    font-size: var(--text-xs);
    color: var(--text-dim);
    background: transparent;
    border: none;
    border-radius: var(--radius-full);
    padding: var(--space-1_5) var(--space-3_5);
    cursor: pointer;
    transition: background var(--transition), color var(--transition);
    white-space: nowrap;
}

/* hover: see @media (hover: hover) guard */

.sort-btn.active {
    color: var(--text);
    background: rgba(255, 255, 255, 0.9);
    box-shadow: var(--shadow-sm);
}

:root.dark .sort-btn.active {
    background: rgba(255, 255, 255, 0.12);
}

.sort-sep {
    width: 1px;
    height: 20px;
    background: var(--glass-border);
    margin: 0 var(--space-1);
    flex-shrink: 0;
}

.sort-size-btn {
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    font-weight: 600;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: none;
    background: transparent;
    color: var(--text-muted);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background var(--transition), color var(--transition);
}

/* hover: see @media (hover: hover) guard */

.sort-size-btn.active {
    color: var(--text);
    background: rgba(255, 255, 255, 0.9);
    box-shadow: var(--shadow-sm);
}

:root.dark .sort-size-btn.active {
    background: rgba(255, 255, 255, 0.12);
}

.sort-grid-wrap {
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 var(--space-6) var(--space-20);
}

.grid-container {
    padding: var(--space-2);
}

.grid {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-1);
}

.grid-item {
    position: relative;
    overflow: hidden;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: opacity var(--transition), transform var(--transition);
    flex-grow: 1;
}

.grid-item img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform var(--duration-slow) var(--ease-out-expo);
}

/* hover: see @media (hover: hover) guard */

/* Overlay gradient — always dark (on images) */
.grid-item .grid-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, transparent 50%);
    opacity: 0;
    transition: opacity var(--transition);
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    padding: var(--space-2);
    gap: var(--space-1);
    pointer-events: none;
}

/* grid-item hover overlay: in @media (hover: hover) guard. Tap fallback below. */
.grid-item.tapped .grid-overlay {
    opacity: 1;
}

.grid-item .grid-overlay .glass-tag {
    pointer-events: auto;
    /* Force light text in overlay context */
    color: rgba(255, 255, 255, 0.9);
    border-color: rgba(255, 255, 255, 0.2);
    background: rgba(0, 0, 0, 0.3);
}

.grid-overlay-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 3px;
}

.filter-active-section {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-1);
    align-items: center;
}

.grid-item.filtered-out {
    opacity: 0;
    width: 0 !important;
    height: 0 !important;
    margin: 0;
    padding: 0;
    overflow: hidden;
    flex-grow: 0;
    flex-shrink: 1;
    flex-basis: 0;
}

/* Row-based layout */
.grid-row {
    display: flex;
    gap: var(--space-1);
    width: 100%;
}

.grid-row .grid-item {
    flex-grow: 0;
    flex-shrink: 0;
}

/* ===== Similarity / Drift shared ===== */
.drift-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--space-8) var(--space-6);
    min-height: calc(100vh - 52px);
}

.drift-center {
    position: relative;
    max-width: 1000px;
    width: 100%;
    margin-bottom: var(--space-10);
}

.drift-center img {
    width: 100%;
    border-radius: var(--radius);
    display: block;
    border: 1px solid var(--separator);
}

.drift-center-meta {
    padding: var(--space-4) 0;
}

.drift-center-alt {
    font-size: var(--text-base);
    color: var(--text);
    line-height: 1.6;
    margin-bottom: var(--space-3);
    font-style: italic;
}

.drift-center-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-1_5);
}

.drift-center-palette {
    display: flex;
    gap: var(--space-1);
    margin-top: var(--space-2);
}

.palette-dot {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    border: 1px solid var(--glass-border);
}

.drift-neighbors {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-3);
    max-width: 1000px;
    width: 100%;
}

.drift-neighbor {
    position: relative;
    cursor: pointer;
    border-radius: var(--radius);
    overflow: hidden;
    border: 1px solid var(--glass-border);
    transition: border-color var(--transition), transform var(--transition), box-shadow var(--transition);
    background: var(--bg-elevated);
}

/* hover: see @media (hover: hover) guard */

.drift-neighbor img {
    width: 100%;
    aspect-ratio: 4/3;
    object-fit: cover;
    display: block;
}

.drift-neighbor-label {
    padding: var(--space-2) var(--space-3);
    font-size: var(--text-xs);
    color: var(--text-dim);
    text-transform: capitalize;
}

.drift-score {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background: var(--fill-primary);
    transform-origin: left;
    transform: scaleX(var(--score, 0));
    transition: transform 0.3s var(--ease-out-quart);
}
/* hover: see @media (hover: hover) guard */

.drift-controls {
    display: flex;
    gap: var(--space-3);
    margin-bottom: var(--space-6);
    align-items: center;
}

.drift-btn {
    font-family: var(--font);
    font-size: var(--text-caption);
    color: var(--text-dim);
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius);
    padding: var(--space-1_5) var(--space-3_5);
    cursor: pointer;
    transition: background var(--transition), border-color var(--transition), color var(--transition);
}

/* hover: see @media (hover: hover) guard */

.drift-breadcrumb {
    display: flex;
    align-items: center;
    gap: var(--space-1);
    flex-wrap: wrap;
}

.drift-breadcrumb-item {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    overflow: hidden;
    cursor: pointer;
    border: 1px solid var(--glass-border);
    transition: border-color var(--transition), transform var(--duration-fast) var(--ease-spring);
    flex-shrink: 0;
}

/* hover: see @media (hover: hover) guard */

.drift-breadcrumb-item.current {
    border-color: var(--text);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--text) 20%, transparent);
}

.drift-breadcrumb-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.drift-breadcrumb-arrow {
    color: var(--text-muted);
    font-size: var(--text-2xs);
    flex-shrink: 0;
}

/* ===== Couleurs (Les Couleurs) — Chromatic Bento ===== */
#view-couleurs { overflow: hidden; }

.couleurs-wrap {
    display: flex;
    flex-direction: column;
    height: calc(100vh - 52px);
    padding: var(--space-6);
    gap: var(--space-4);
}

.couleurs-spectrum {
    display: flex;
    height: 28px;
    border-radius: var(--radius-full);
    overflow: hidden;
    flex-shrink: 0;
}

.couleurs-band {
    flex: 1;
    cursor: pointer;
    transition: flex var(--transition), opacity var(--transition);
    min-width: 2px;
    opacity: 0.4;
}

/* hover: see @media (hover: hover) guard */

.couleurs-band.active {
    opacity: 1;
    flex: 3;
}

.couleurs-card {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 3px;
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-bento);
    min-height: 0;
}

.couleurs-row {
    display: flex;
    gap: 3px;
    flex: 1;
    min-height: 0;
}

.couleurs-tile {
    flex: 1;
    overflow: hidden;
    cursor: pointer;
    min-width: 0;
    min-height: 0;
}

.couleurs-tile img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* ===== Bento (Le Bento) — Irregular mosaic grid ===== */
.bento-view {
    overflow: hidden;
}

.bento-wrap {
    display: flex;
    align-items: center;
    justify-content: center;
    height: calc(100vh - 52px);
    padding: var(--space-16);
    position: relative;
}

.bento-grid {
    display: grid;
    grid-template-columns: repeat(var(--bento-cols, 4), 1fr);
    grid-template-rows: repeat(var(--bento-rows, 3), 1fr);
    gap: 4px;
    border-radius: var(--radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow-bento);
    height: calc(100vh - 180px);
    max-width: calc(100vw - 160px);
}

.bento-tile {
    overflow: hidden;
    cursor: pointer;
    transition: opacity 800ms ease;
    min-width: 0;
    min-height: 0;
}

.bento-tile img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Navigation arrows — left/right of grid */
.bento-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: 1px solid var(--glass-border);
    background: var(--glass-bg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    cursor: pointer;
    font-size: 24px;
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-dim);
    z-index: 10;
    transition: background var(--transition), border-color var(--transition), color var(--transition), transform var(--duration-fast) var(--ease-spring);
}

/* hover: see @media (hover: hover) guard */

.bento-nav-prev { left: var(--space-5); }
.bento-nav-next { right: var(--space-5); }

/* hover: see @media (hover: hover) guard */

.bento-regen {
    position: fixed;
    bottom: var(--space-6);
    right: var(--space-6);
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: 1px solid var(--glass-border);
    background: var(--glass-bg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    cursor: pointer;
    font-size: 22px;
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    transition: background var(--transition), border-color var(--transition), transform var(--duration-fast) var(--ease-spring);
}

/* hover: see @media (hover: hover) guard */

/* ===== Shared: game-title, game-desc, game-start-btn ===== */
.game-title {
    font-family: var(--font-display);
    font-size: var(--text-4xl);
    font-weight: 600;
    letter-spacing: -0.02em;
    margin-bottom: var(--space-3);
}

.game-desc {
    font-size: var(--text-sm);
    color: var(--text-dim);
    margin-bottom: var(--space-8);
}

.game-start-btn {
    font-family: var(--font);
    font-size: var(--text-base);
    color: var(--text);
    background: var(--glass-bg-hover);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius);
    padding: var(--space-3) var(--space-8);
    cursor: pointer;
    transition: background var(--transition), border-color var(--transition);
}

/* hover: see @media (hover: hover) guard */

.game-end {
    padding: var(--space-12) 0;
    text-align: center;
}

.game-final-score {
    font-family: var(--font-display);
    font-size: var(--text-6xl);
    font-weight: 700;
    margin-bottom: var(--space-1);
    letter-spacing: -0.04em;
}

.game-final-label {
    font-size: var(--text-base);
    color: var(--text-dim);
    margin-bottom: var(--space-6);
}

/* ===== Le Jeu — Viewport-fixed image pairs ===== */
#view-game { overflow: hidden; }

.jeu-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: calc(100vh - 52px);
    padding: var(--space-6);
    gap: 0;
    position: relative;
}

.jeu-pair {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-2);
    max-width: 100%;
    max-height: calc(100vh - 140px);
    min-height: 0;
    flex: 1;
    align-content: center;
    transition: opacity 300ms var(--ease-out-quart), transform 300ms var(--ease-out-quart);
}

.jeu-pair-exit {
    opacity: 0;
    transform: scale(0.97);
}

.jeu-pair-enter {
    opacity: 0;
    transform: scale(0.97);
}

.jeu-card {
    border-radius: var(--radius-lg);
    overflow: hidden;
    min-height: 0;
}

.jeu-img {
    width: 100%;
    height: 100%;
    aspect-ratio: 3/2;
    object-fit: cover;
    display: block;
}

/* Fixed glass bar at bottom */
.jeu-bar {
    position: fixed;
    bottom: var(--space-6);
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: var(--space-5);
    padding: var(--space-2_5) var(--space-5);
    background: rgba(120, 120, 128, 0.08);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-full);
    backdrop-filter: saturate(180%) blur(20px);
    -webkit-backdrop-filter: saturate(180%) blur(20px);
    z-index: 10;
}

.jeu-btn {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: none;
    background: transparent;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    line-height: 1;
    transition: transform var(--duration-fast) var(--ease-spring);
}

/* hover: see @media (hover: hover) guard */

.jeu-btn:active {
    transform: scale(0.9);
}

/* ===== Faces (Les Visages) — Viewport-fixed with elevated container ===== */
#view-faces { overflow: hidden; }

.faces-container {
    display: flex;
    flex-direction: column;
    height: calc(100vh - 52px);
    padding: var(--space-5);
    gap: var(--space-4);
}

.faces-filter-bar {
    display: flex;
    justify-content: center;
    gap: var(--space-2);
    flex-shrink: 0;
    flex-wrap: wrap;
}

.faces-filter-btn {
    font-family: var(--font);
    font-size: var(--text-sm);
    color: var(--text-dim);
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-full);
    padding: var(--space-1_5) var(--space-4_5);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: var(--space-1_5);
    transition: background var(--transition), border-color var(--transition), color var(--transition);
}

/* hover: see @media (hover: hover) guard */

.faces-filter-btn.active {
    color: var(--text);
    background: var(--fill-secondary);
    border-color: var(--glass-border-hover);
}

.faces-filter-count {
    font-size: var(--text-2xs);
    font-family: var(--font-mono);
    color: var(--text-muted);
}

.faces-card {
    flex: 1;
    min-height: 0;
    border-radius: var(--radius-lg);
    overflow: hidden;
    display: flex;
    flex-wrap: wrap;
    align-content: center;
    justify-content: center;
    gap: 2px;
    padding: var(--space-3);
    background: var(--bg-elevated);
    box-shadow: var(--shadow-elevated);
}

.face-card {
    width: var(--face-size, 80px);
    height: var(--face-size, 80px);
    border-radius: var(--radius-xs);
    overflow: hidden;
    border: 1px solid var(--glass-border);
    cursor: pointer;
    transition: transform var(--duration-fast) var(--ease-spring), border-color var(--transition);
}

/* hover: see @media (hover: hover) guard */

.face-crop-canvas {
    width: 100%;
    height: 100%;
    display: block;
}

/* ===== Compass (La Boussole) — CSS Grid cross layout ===== */
#view-compass {
    overflow: hidden;
}

.compass-grid {
    display: grid;
    grid-template-areas:
        ".     north  ."
        "west  center east"
        ".     south  .";
    grid-template-columns: 1fr 5fr 1fr;
    grid-template-rows: 1fr 5fr 1fr;
    gap: 4px;
    height: calc(100vh - 52px);
    padding: var(--space-5);
    background: var(--bg);
}

/* Arms — shared */
.compass-arm {
    position: relative;
    overflow: hidden;
    cursor: pointer;
    border-radius: var(--radius-sm);
    opacity: 0;
}

/* Direction-specific enter transforms */
.compass-north { transform: translateY(-20px); }
.compass-south { transform: translateY(20px); }
.compass-east  { transform: translateX(20px); }
.compass-west  { transform: translateX(-20px); }

.compass-arm.compass-arm-enter {
    opacity: 1;
    transform: translate(0, 0);
    transition: opacity 400ms var(--ease-out-quart), transform 400ms var(--ease-out-expo);
}

.compass-arm-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    opacity: 0.35;
    transition: opacity var(--duration-normal) var(--ease-out-quart);
}

.compass-arm-img.img-loaded {
    opacity: 0.35;
}

/* hover: see @media (hover: hover) guard */

.compass-arm-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--space-1);
    pointer-events: none;
}

.compass-arm-label {
    font-size: var(--text-2xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: rgba(255, 255, 255, 0.6);
}

.compass-arm-trait {
    font-size: var(--text-sm);
    color: rgba(255, 255, 255, 0.9);
    font-weight: 500;
}

.compass-arm-empty {
    background: var(--bg-elevated);
    border-radius: var(--radius-sm);
}

/* Center hero image */
.compass-center {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 0;
    min-height: 0;
    overflow: hidden;
    border-radius: var(--radius);
}

.compass-center-img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    display: block;
    border-radius: var(--radius);
}

/* Random button */
.compass-random {
    position: fixed;
    bottom: var(--space-6);
    right: var(--space-6);
    font-family: var(--font);
    font-size: var(--text-caption);
    color: var(--text-dim);
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius);
    padding: var(--space-1_5) var(--space-3_5);
    cursor: pointer;
    z-index: 10;
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    transition: background var(--transition), border-color var(--transition), color var(--transition);
}

/* hover: see @media (hover: hover) guard */

/* ===== Observatory (L'Observatoire) ===== */
.observatory-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
    gap: var(--space-4);
    padding: var(--space-6);
}

.obs-panel {
    background: var(--bg-elevated);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius);
    padding: var(--space-5);
}

.obs-panel-title {
    font-size: var(--text-caption);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-dim);
    margin-bottom: var(--space-4);
    font-weight: 600;
}

.obs-panel-content {
    display: flex;
    flex-direction: column;
    gap: var(--space-1_5);
}

.obs-bar-row {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-caption);
}

.obs-bar-label {
    color: var(--text);
    min-width: 100px;
    font-size: var(--text-caption);
}

.obs-bar {
    height: 8px;
    background: var(--fill-quaternary);
    border-radius: 4px;
    flex: 1;
    max-width: 200px;
}

/* Neutral fill instead of purple tint */
.obs-bar-style { background: var(--fill-tertiary); }

.obs-bar-count {
    font-size: var(--text-xs);
    color: var(--text-muted);
    min-width: 30px;
    text-align: right;
    font-variant-numeric: tabular-nums;
}

.obs-histogram {
    display: flex;
    align-items: flex-end;
    gap: var(--space-0_5);
    height: 100px;
}

.obs-hist-bar {
    flex: 1;
    background: var(--fill-tertiary);
    border-radius: 2px 2px 0 0;
    min-height: 1px;
    transition: background var(--transition);
}

/* hover: see @media (hover: hover) guard */

.obs-inline-count {
    font-size: var(--text-2xs);
    color: var(--text-muted);
    margin-left: var(--space-0_5);
}

.obs-outlier-row {
    display: flex;
    align-items: center;
    gap: var(--space-2_5);
    padding: var(--space-1_5) 0;
}

.obs-outlier-thumb {
    width: 72px;
    height: 72px;
    border-radius: var(--radius-sm);
    object-fit: cover;
}

.obs-outlier-label {
    font-size: var(--text-caption);
    color: var(--text-dim);
}

/* ===== Map (La Carte) ===== */
.map-container {
    padding: var(--space-6);
}

.map-header {
    font-size: var(--text-sm);
    color: var(--text-dim);
    margin-bottom: var(--space-4);
}

.map-canvas {
    width: 100%;
    max-width: 1200px;
    border-radius: var(--radius);
    border: 1px solid var(--glass-border);
    cursor: crosshair;
}

.map-strip {
    display: flex;
    gap: var(--space-2);
    margin-top: var(--space-4);
    overflow-x: auto;
    padding-bottom: var(--space-2);
}

.map-strip-card {
    flex-shrink: 0;
    width: 180px;
    height: 120px;
    border-radius: var(--radius-sm);
    overflow: hidden;
    border: 1px solid var(--glass-border);
    cursor: pointer;
    transition: border-color var(--transition), transform var(--transition), box-shadow var(--transition);
}

/* hover: see @media (hover: hover) guard */

.map-strip-card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}


/* ===== NYU — Multi-view experience ===== */
#view-nyu { overflow: hidden; }

.nyu-shell {
    position: relative;
    height: calc(100vh - 52px);
    overflow: hidden;
}

.nyu-viewport {
    height: 100%;
    overflow: hidden;
}

/* Nav bar — floating glass pill at bottom */
.nyu-nav {
    position: fixed;
    bottom: var(--space-6);
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: var(--space-1);
    padding: var(--space-2) var(--space-3);
    background: rgba(230, 230, 230, 0.35);
    backdrop-filter: saturate(150%) blur(40px);
    -webkit-backdrop-filter: saturate(150%) blur(40px);
    border: 1px solid var(--glass-border-hover);
    border-radius: var(--radius-full);
    box-shadow: var(--shadow-float);
    z-index: 50;
}

:root.dark .nyu-nav {
    background: rgba(28, 28, 30, 0.6);
}

.nyu-nav-btn {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: none;
    background: transparent;
    cursor: pointer;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.55;
    transition: opacity var(--transition), background var(--transition), box-shadow var(--transition);
    position: relative;
}

/* hover: see @media (hover: hover) guard */

.nyu-nav-btn.active {
    opacity: 1;
    background: rgba(255, 255, 255, 0.9);
    box-shadow: var(--shadow-sm);
}

.nyu-nav-btn.active::after {
    content: '';
    position: absolute;
    bottom: -3px;
    left: 50%;
    transform: translateX(-50%);
    width: 4px;
    height: 4px;
    border-radius: 50%;
    background: var(--text);
}

:root.dark .nyu-nav-btn.active {
    background: rgba(255, 255, 255, 0.15);
}

/* Counter */
.nyu-counter {
    font-size: var(--text-sm);
    color: var(--text-muted);
    font-variant-numeric: tabular-nums;
    letter-spacing: 0.02em;
    text-align: center;
    padding: var(--space-4) 0;
}

/* ===== Reel ===== */
.nyu-reel {
    display: flex;
    align-items: center;
    height: 100%;
    overflow-x: auto;
    overflow-y: hidden;
    scroll-snap-type: x mandatory;
    gap: var(--space-8);
    padding: 0 max(var(--space-6), calc(50vw - 250px));
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
}

.nyu-reel::-webkit-scrollbar { display: none; }

.nyu-reel-item {
    scroll-snap-align: center;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-lg);
    overflow: hidden;
}

.nyu-reel-item img {
    max-height: 80vh;
    max-width: min(600px, 85vw);
    object-fit: contain;
    display: block;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-deck);
}

/* ===== Grid ===== */
.nyu-vp-grid { overflow-y: auto; }

.nyu-grid {
    padding: var(--space-1);
    padding-bottom: 100px;
}

.nyu-grid-row {
    display: flex;
    gap: var(--space-1);
    margin-bottom: var(--space-1);
}

.nyu-grid-row[data-type="hero"] .nyu-grid-cell { height: 55vh; }
.nyu-grid-row[data-type="pair"] .nyu-grid-cell { height: 38vh; }
.nyu-grid-row[data-type="triplet"] .nyu-grid-cell { height: 28vh; }

.nyu-grid-cell {
    flex: 1;
    overflow: hidden;
    border-radius: var(--radius-sm);
    cursor: pointer;
    min-width: 0;
}

.nyu-grid-cell img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform var(--duration-slow) var(--ease-out-expo);
}

/* hover: see @media (hover: hover) guard */

/* ===== Deck ===== */
.nyu-vp-deck {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.nyu-accent {
    position: absolute;
    inset: 0;
    pointer-events: none;
    transition: background 800ms var(--ease-out-quart);
}

.nyu-stack {
    position: relative;
    width: min(85vw, 700px);
    aspect-ratio: 3/2;
    cursor: pointer;
}

.nyu-card {
    position: absolute;
    inset: 0;
    border-radius: var(--radius-xl);
    overflow: hidden;
    transform-origin: center bottom;
    transform:
        translateY(calc(var(--card-index) * -14px))
        scale(calc(1 - var(--card-index) * 0.05));
    opacity: calc(1 - var(--card-index) * 0.15);
    transition: transform 400ms var(--ease-spring),
                opacity 400ms var(--ease-out-quart);
    box-shadow: var(--shadow-deck);
}

.nyu-card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.nyu-card-exit {
    transform: translateX(120%) rotate(8deg) !important;
    opacity: 0 !important;
    transition: transform 350ms var(--ease-out-expo),
                opacity 300ms var(--ease-out-quart) !important;
}

.nyu-card-exit-left {
    transform: translateX(-120%) rotate(-8deg) !important;
    opacity: 0 !important;
    transition: transform 350ms var(--ease-out-expo),
                opacity 300ms var(--ease-out-quart) !important;
}

/* ===== Canvas ===== */
.nyu-canvas {
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    transition: background 1s var(--ease-out-quart);
    padding: var(--space-10);
}

.nyu-canvas-img-wrap {
    display: flex;
    align-items: center;
    justify-content: center;
    flex: 1;
    min-height: 0;
    width: 100%;
}

.nyu-canvas-img {
    max-width: 90%;
    max-height: 75vh;
    object-fit: contain;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-deck);
    cursor: pointer;
    transition: transform var(--duration-fast) var(--ease-spring);
}

/* hover: see @media (hover: hover) guard */

.nyu-canvas-counter { color: var(--text-dim); }

/* ===== Overview — Assembled mosaic ===== */
.nyu-vp-overview {
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.nyu-mosaic {
    display: grid;
    grid-template-columns: repeat(var(--m-cols), 1fr);
    grid-template-rows: repeat(var(--m-rows), 1fr);
    width: min(78vh, 78vw);
    height: min(78vh, 78vw);
    gap: 1px;
}

.nyu-mosaic.assembled {
    animation: mosaic-settle 2.4s var(--ease-out-quart) 1.6s both;
}

@keyframes mosaic-settle {
    0%   { transform: scale(1); }
    40%  { transform: scale(1.006); }
    100% { transform: scale(1); }
}

.nyu-mosaic-cell {
    overflow: hidden;
    cursor: pointer;
    contain: layout style paint;
    transform: translate(var(--sx), var(--sy)) rotate(var(--sr)) scale(0);
    opacity: 0;
    transition: transform 1.2s var(--ease-spring),
                opacity 0.6s var(--ease-out-quart);
    transition-delay: var(--d);
    will-change: transform, opacity;
}

.nyu-mosaic.assembled .nyu-mosaic-cell {
    transform: translate(0, 0) rotate(0deg) scale(1);
    opacity: 1;
}

.nyu-mosaic-cell img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform var(--duration-normal) var(--ease-spring),
                opacity var(--duration-normal) var(--ease-out-quart);
}

/* hover: see @media (hover: hover) guard */

/* ===== Confetti — Vertical nav + viewport mosaic ===== */
#view-confetti {
    height: calc(100vh - 52px);
    overflow: hidden;
}

/* Shell: flex row, full viewport */
.confetti-shell {
    display: flex;
    height: 100%;
    overflow: hidden;
}

/* Left column: nav + bomb stacked vertically, centered */
.confetti-left {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--space-4);
    flex-shrink: 0;
}

/* Bomb button */
.confetti-bomb {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: none;
    background: var(--fill-secondary);
    cursor: pointer;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform var(--duration-normal) var(--ease-spring),
                background var(--transition),
                box-shadow var(--transition);
    flex-shrink: 0;
}

/* hover: see @media (hover: hover) guard */

.confetti-bomb:active {
    transform: scale(0.92);
}

/* Vertical emoji nav on left — centered with mosaic */
.confetti-nav {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--space-1);
    padding: var(--space-3) var(--space-2) var(--space-3) var(--space-4);
    overflow-y: auto;
    flex-shrink: 0;
}

.confetti-nav::-webkit-scrollbar { display: none; }

.confetti-nav-btn {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: none;
    background: transparent;
    cursor: pointer;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.45;
    transition: opacity var(--transition), background var(--transition), box-shadow var(--transition);
    flex-shrink: 0;
}

/* hover: see @media (hover: hover) guard */

.confetti-nav-btn.active {
    opacity: 1;
    background: var(--fill-secondary);
    box-shadow: var(--shadow-sm);
}

/* Viewport: flex center for mosaic */
.confetti-viewport {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    min-width: 0;
}

/* Label at bottom center */
.confetti-label {
    position: absolute;
    bottom: var(--space-6);
    left: 50%;
    transform: translateX(-50%);
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--text-muted);
    letter-spacing: 0.02em;
    pointer-events: none;
}

/* ===== Confetti Mosaic ===== */
.confetti-mosaic {
    display: grid;
    grid-template-columns: repeat(var(--m-cols), 1fr);
    grid-template-rows: repeat(var(--m-rows), 1fr);
    width: min(75vh, 75vw);
    height: min(75vh, 75vw);
    gap: 2px;
    cursor: pointer;
}

/* Settle pulse after assembly */
.confetti-mosaic.assembled {
    animation: confetti-settle 2s var(--ease-out-quart) 1.4s both;
}

@keyframes confetti-settle {
    0%   { transform: scale(1); }
    35%  { transform: scale(1.008); }
    100% { transform: scale(1); }
}

/* Cell: scattered state (default) */
.confetti-cell {
    position: relative;
    overflow: hidden;
    contain: layout style paint;
    transform: translate(var(--sx), var(--sy)) rotate(var(--sr)) scale(0);
    opacity: 0;
    transition: transform 1.2s var(--ease-spring),
                opacity 0.6s var(--ease-out-quart);
    transition-delay: var(--d);
    will-change: transform, opacity;
}

/* Cell: assembled state */
.confetti-mosaic.assembled .confetti-cell {
    transform: translate(0, 0) rotate(0deg) scale(1);
    opacity: 1;
}

/* Cell: scattering out (fast burst) */
.confetti-mosaic.scattering .confetti-cell {
    transform: translate(var(--sx), var(--sy)) rotate(var(--sr)) scale(0);
    opacity: 0;
    transition: transform 0.45s var(--ease-out-expo),
                opacity 0.3s var(--ease-out-quart);
    transition-delay: var(--d-out);
}

.confetti-cell {
    border-radius: 3px;
}

.confetti-cell img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform var(--duration-normal) var(--ease-spring);
}

/* Soft gradient overlay — disappears on hover to reveal */
.confetti-cell::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgba(0,0,0,0.12) 0%, rgba(0,0,0,0.04) 40%, rgba(0,0,0,0.18) 100%);
    pointer-events: none;
    transition: opacity var(--duration-normal) var(--ease-out-quart);
    border-radius: 3px;
}

/* hover: see @media (hover: hover) guard */

/* Cell: floating state (blow — lift to nearby random spot) */
.confetti-mosaic.floating .confetti-cell {
    transform: translate(var(--fx), var(--fy)) rotate(var(--fr));
    opacity: 0.85;
    transition: transform 0.5s var(--ease-out-expo),
                opacity 0.3s var(--ease-out-quart);
    transition-delay: var(--fd);
}

/* ===== Confetti Glass Preview ===== */
.confetti-preview {
    position: fixed;
    inset: 0;
    z-index: 200;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s var(--ease-out-quart);
    pointer-events: none;
}

.confetti-preview.open {
    opacity: 1;
    pointer-events: auto;
}

.confetti-preview-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.75);
    backdrop-filter: saturate(180%) blur(30px);
    -webkit-backdrop-filter: saturate(180%) blur(30px);
}

.confetti-preview-img {
    position: relative;
    max-width: 85vw;
    max-height: 85vh;
    object-fit: contain;
    border-radius: var(--radius-lg);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    transform: scale(0.92);
    transition: transform 0.4s var(--ease-out-expo);
}

.confetti-preview.open .confetti-preview-img {
    transform: scale(1);
}

/* ===== Lightbox — Always dark overlay ===== */
.lightbox {
    position: fixed;
    inset: 0;
    z-index: 200;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 1;
    transition: opacity var(--duration-normal) var(--ease-out-quart);
}

.lightbox.hidden {
    opacity: 0;
    pointer-events: none;
}

.lightbox-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.92);
    backdrop-filter: saturate(180%) blur(20px);
    -webkit-backdrop-filter: saturate(180%) blur(20px);
}

.lightbox-content {
    position: relative;
    max-width: 90vw;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    transform: scale(1) translateY(0);
    transition: transform var(--duration-slow) var(--ease-out-expo),
                opacity var(--duration-normal) var(--ease-out-quart);
}

.lightbox.hidden .lightbox-content {
    transform: scale(0.95) translateY(12px);
    opacity: 0;
}

.lightbox-close {
    position: absolute;
    top: -44px;
    right: 0;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: none;
    border: none;
    color: rgba(255, 255, 255, 0.7);
    font-size: 24px;
    cursor: pointer;
    font-family: var(--font);
    transition: color var(--transition);
}

/* hover: see @media (hover: hover) guard */

.lightbox-img {
    max-width: 90vw;
    max-height: 75vh;
    object-fit: contain;
    border-radius: var(--radius);
}

.lightbox-meta {
    padding: var(--space-4) 0;
    max-width: 600px;
    text-align: center;
}

.lightbox-alt {
    font-size: var(--text-sm);
    color: rgba(255, 255, 255, 0.7);
    font-style: italic;
    margin-bottom: var(--space-2_5);
    line-height: 1.6;
}

.lightbox-tags {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: var(--space-1_5);
    margin-bottom: var(--space-2);
}

/* Force light text in lightbox (always dark backdrop) */
.lightbox-tags .glass-tag {
    color: rgba(255, 255, 255, 0.85);
    border-color: rgba(255, 255, 255, 0.15);
    background: rgba(255, 255, 255, 0.06);
}

.lightbox-palette {
    display: flex;
    justify-content: center;
    gap: var(--space-1_5);
}

.lightbox-palette .palette-dot {
    border-color: rgba(255, 255, 255, 0.15);
}

/* ===== Loading — simple text indicator ===== */
.loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--space-4);
    height: calc(100vh - 52px);
    color: var(--text-muted);
    font-size: var(--text-sm);
    font-family: var(--font-display);
}

.loading.error {
    color: var(--color-error);
}

/* ===== Scrollbar ===== */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb {
    background: var(--fill-tertiary);
    border-radius: 3px;
}
::-webkit-scrollbar-thumb:hover {
    background: var(--fill-primary);
}

/* ===== Utility: Clickable Images ===== */
.clickable-img { cursor: pointer; }

/* ===== Utility: Color Swatch (small inline dot) ===== */
.color-swatch-sm {
    display: inline-block;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    margin-right: var(--space-2);
    vertical-align: middle;
}

/* ===== Utility: Empty State ===== */
.empty-state {
    padding: var(--space-10);
    color: var(--text-muted);
    text-align: center;
}

/* ===== Hover Guard — only apply hover effects on devices with pointer ===== */
@media (hover: hover) and (pointer: fine) {
    .logo:hover { opacity: 0.6; }
    .theme-toggle:hover { color: var(--text); border-color: var(--glass-border-hover); }
    .tab:hover { color: var(--text); background: var(--glass-bg); }
    .side-menu-item:hover { color: var(--text); background: var(--glass-bg-hover); }
    .glass-tag:hover { background: var(--glass-bg-hover); border-color: var(--glass-border-hover); }
    .glass-tag.tag-vibe:hover, .glass-tag.tag-grading:hover, .glass-tag.tag-time:hover,
    .glass-tag.tag-setting:hover, .glass-tag.tag-scene:hover, .glass-tag.tag-emotion:hover,
    .glass-tag.tag-camera:hover, .glass-tag.tag-style:hover { border-color: var(--glass-border-hover); }
    .faces-container .glass-tag.tag-emotion:hover { border-color: color-mix(in srgb, var(--system-pink) 60%, transparent); }
    .filter-bar .clear-btn:hover { color: var(--text); border-color: var(--glass-border-hover); background: var(--glass-bg); }
    .sort-btn:hover { color: var(--text); background: var(--glass-bg); }
    .sort-size-btn:hover { color: var(--text); background: var(--glass-bg); }
    .grid-item:hover img { transform: scale(1.03); }
    .grid-item:hover .grid-overlay { opacity: 1; }
    .drift-neighbor:hover { border-color: var(--glass-border-hover); transform: translateY(-3px); box-shadow: var(--shadow-sm); }
    .drift-neighbor:hover .drift-score { background: var(--text); }
    .drift-btn:hover { color: var(--text); background: var(--glass-bg-hover); border-color: var(--glass-border-hover); }
    .drift-breadcrumb-item:hover { border-color: var(--glass-border-hover); transform: scale(1.15); }
    .couleurs-band:hover { opacity: 0.75; flex: 2; }
    .bento-nav:hover { color: var(--text); background: var(--glass-bg-hover); border-color: var(--glass-border-hover); }
    .bento-nav-prev:hover { transform: translateY(-50%) scale(1.1); }
    .bento-nav-next:hover { transform: translateY(-50%) scale(1.1); }
    .bento-regen:hover { background: var(--glass-bg-hover); border-color: var(--glass-border-hover); transform: scale(1.1); }
    .game-start-btn:hover { background: var(--fill-primary); border-color: var(--glass-border-hover); }
    .jeu-btn:hover { transform: scale(1.25); }
    .faces-filter-btn:hover { color: var(--text); background: var(--glass-bg-hover); border-color: var(--glass-border-hover); }
    .face-card:hover { transform: scale(1.12); z-index: 2; box-shadow: var(--shadow-sm); }
    .compass-arm:hover .compass-arm-img, .compass-arm:hover .compass-arm-img.img-loaded { opacity: 0.7; }
    .compass-random:hover { color: var(--text); background: var(--glass-bg-hover); border-color: var(--glass-border-hover); }
    .obs-hist-bar:hover { background: var(--fill-primary); }
    .map-strip-card:hover { border-color: var(--glass-border-hover); transform: translateY(-2px); box-shadow: var(--shadow-sm); }
    .nyu-nav-btn:hover { opacity: 1; }
    .nyu-grid-cell:hover img { transform: scale(1.03); }
    .nyu-canvas-img:hover { transform: scale(1.01); }
    .nyu-mosaic-cell:hover img { transform: scale(1.25); opacity: 1; }
    .confetti-bomb:hover { transform: scale(1.12); background: var(--fill-tertiary); box-shadow: var(--shadow-sm); }
    .confetti-nav-btn:hover { opacity: 0.85; }
    .confetti-cell:hover::after { opacity: 0; }
    .confetti-cell:hover img { transform: scale(1.3); }
    .lightbox-close:hover { color: rgb(255, 255, 255); }
}

/* ===== dvh fallbacks for all viewport-height containers ===== */
.view { min-height: calc(100vh - 52px); min-height: calc(100dvh - 52px); }
.drift-container { min-height: calc(100vh - 52px); min-height: calc(100dvh - 52px); }
.couleurs-wrap { height: calc(100vh - 52px); height: calc(100dvh - 52px); }
.bento-wrap { height: calc(100vh - 52px); height: calc(100dvh - 52px); }
.bento-grid { height: calc(100vh - 180px); height: calc(100dvh - 180px); }
.jeu-container { height: calc(100vh - 52px); height: calc(100dvh - 52px); }
.jeu-pair { max-height: calc(100vh - 140px); max-height: calc(100dvh - 140px); }
.faces-container { height: calc(100vh - 52px); height: calc(100dvh - 52px); }
.compass-grid { height: calc(100vh - 52px); height: calc(100dvh - 52px); }
.nyu-shell { height: calc(100vh - 52px); height: calc(100dvh - 52px); }
#view-confetti { height: calc(100vh - 52px); height: calc(100dvh - 52px); }
.loading { height: calc(100vh - 52px); height: calc(100dvh - 52px); }

/* ===== Responsive — Tablet (max-width: 768px) ===== */
@media (max-width: 768px) {
    /* Font floor — nothing smaller than 13px on mobile */
    :root {
        --text-2xs: 13px;
        --text-xs: 13px;
        --text-caption: 13px;
        --text-sm: 14px;
    }

    /* Header: keep row, tighten */
    #header {
        padding: var(--space-2_5) var(--space-4);
        padding-top: calc(var(--space-2_5) + env(safe-area-inset-top));
    }

    .side-menu { left: var(--space-3); right: var(--space-3); min-width: auto; }

    /* Drift/Similarity */
    .drift-container { padding: var(--space-5) var(--space-4); }
    .drift-neighbors { grid-template-columns: repeat(2, 1fr); gap: var(--space-2); }
    .drift-center { margin-bottom: var(--space-6); }

    .grid-container { padding: var(--space-1); }

    /* Bento: reduce padding, full-width grid */
    .bento-wrap { padding: var(--space-3); }
    .bento-grid { height: calc(100dvh - 120px); max-width: calc(100vw - 24px); }
    .bento-nav { width: 44px; height: 44px; font-size: 20px; }
    .bento-nav-prev { left: var(--space-2); }
    .bento-nav-next { right: var(--space-2); }
    .bento-regen { bottom: var(--space-4); right: var(--space-4); width: 44px; height: 44px; }

    /* Game */
    .jeu-pair { gap: var(--space-1); }
    .jeu-bar { bottom: var(--space-4); bottom: calc(var(--space-4) + env(safe-area-inset-bottom)); }

    /* Couleurs */
    .couleurs-wrap { padding: var(--space-3); gap: var(--space-2_5); }
    .couleurs-spectrum { height: 24px; }

    /* Faces */
    .faces-container { padding: var(--space-3); gap: var(--space-2_5); }
    .faces-filter-bar { gap: var(--space-1); }
    .faces-filter-btn { padding: var(--space-1) var(--space-3); font-size: var(--text-sm); }

    /* Compass: stack vertically on tablet */
    .compass-grid {
        grid-template-areas:
            "north  north"
            "west   east"
            "center center"
            "south  south";
        grid-template-columns: 1fr 1fr;
        grid-template-rows: auto 1fr 3fr auto;
        padding: var(--space-3);
    }
    .compass-random { bottom: var(--space-4); right: var(--space-4); }

    /* NYU */
    .nyu-nav { bottom: var(--space-4); bottom: calc(var(--space-4) + env(safe-area-inset-bottom)); padding: var(--space-1_5) var(--space-2_5); }
    .nyu-nav-btn { width: 44px; height: 44px; font-size: 18px; }
    .nyu-reel { gap: var(--space-4); padding: 0 var(--space-4); }
    .nyu-reel-item img { max-width: 90vw; }
    .nyu-grid-row[data-type="hero"] .nyu-grid-cell { height: 40vh; height: 40dvh; }
    .nyu-grid-row[data-type="pair"] .nyu-grid-cell { height: 28vh; height: 28dvh; }
    .nyu-grid-row[data-type="triplet"] .nyu-grid-cell { height: 20vh; height: 20dvh; }
    .nyu-mosaic { width: min(90dvh, 90vw); height: min(90dvh, 90vw); }
    .nyu-stack { width: min(90vw, 700px); }
    .nyu-canvas { padding: var(--space-5); }
    .nyu-canvas-img { max-width: 95%; max-height: 70dvh; }

    /* Confetti */
    .confetti-shell { flex-direction: column; }
    .confetti-left { flex-direction: row; gap: var(--space-2); padding: var(--space-2); }
    .confetti-nav { flex-direction: row; overflow-x: auto; overflow-y: hidden; padding: var(--space-2) var(--space-3); }
    .confetti-nav-btn { width: 44px; height: 44px; font-size: 16px; }
    .confetti-bomb { width: 44px; height: 44px; font-size: 18px; }
    .confetti-mosaic { width: min(85dvh, 88vw); height: min(85dvh, 88vw); }
    .confetti-label { font-size: var(--text-sm); bottom: var(--space-3); }

    /* Lightbox */
    .lightbox-content { max-width: 95vw; }
    .lightbox-img { max-width: 95vw; max-height: 70dvh; }
    .lightbox-close { top: -44px; font-size: 28px; }

    /* Observatory */
    .observatory-container { grid-template-columns: 1fr; padding: var(--space-4); }

    /* Sort bar */
    .sort-bar { padding: var(--space-3) var(--space-3); }
    .sort-bar-inner { gap: 0; }
    .sort-btn { padding: var(--space-1_5) var(--space-2_5); font-size: var(--text-sm); }
    .sort-grid-wrap { padding: 0 var(--space-3) var(--space-12); }

    /* Filter bar */
    .filter-bar { padding: var(--space-2_5) var(--space-4); }
}

/* ===== Responsive — Phone (max-width: 480px) ===== */
@media (max-width: 480px) {
    #header { padding: var(--space-2) var(--space-3); padding-top: calc(var(--space-2) + env(safe-area-inset-top)); }
    .header-exp-name { font-size: var(--text-sm); }
    .logo { font-size: var(--text-base); }

    /* Drift/Similarity: single column neighbors on phone */
    .drift-container { padding: var(--space-4) var(--space-3); }
    .drift-neighbors { grid-template-columns: 1fr; gap: var(--space-2); }
    .drift-neighbor img { aspect-ratio: 16/9; }
    .drift-controls { flex-wrap: wrap; gap: var(--space-2); }

    /* Bento: minimal padding */
    .bento-wrap { padding: var(--space-2); }
    .bento-grid { height: calc(100dvh - 80px); max-width: calc(100vw - 16px); }

    /* Game: stack images vertically on phone */
    .jeu-pair { grid-template-columns: 1fr; gap: var(--space-1); }
    .jeu-img { aspect-ratio: 16/9; }

    /* Compass: simplified single-column */
    .compass-grid {
        grid-template-areas:
            "center"
            "north"
            "south"
            "west"
            "east";
        grid-template-columns: 1fr;
        grid-template-rows: 3fr repeat(4, 1fr);
        gap: 3px;
        padding: var(--space-2);
    }

    /* Faces: even tighter */
    .faces-container { padding: var(--space-2); gap: var(--space-2); }
    .faces-filter-bar { gap: 2px; justify-content: flex-start; overflow-x: auto; flex-wrap: nowrap; padding-bottom: var(--space-1); }
    .faces-filter-btn { flex-shrink: 0; }

    /* Confetti: tighter nav */
    .confetti-nav-btn { width: 44px; height: 44px; font-size: 14px; }
    .confetti-bomb { width: 44px; height: 44px; }
    .confetti-mosaic { width: min(80dvh, 92vw); height: min(80dvh, 92vw); }

    /* Sort */
    .sort-bar-inner { flex-wrap: wrap; border-radius: var(--radius-lg); justify-content: center; }
    .sort-sep { display: none; }
    .sort-size-btn { width: 44px; height: 44px; }

    /* Pendulum: stack vertically */
    .pendulum-pair { flex-direction: column !important; }
}

/* ===== Content Visibility — off-screen sections don't render ===== */
.view:not(.active) {
    content-visibility: hidden;
}

/* ===== Reduced Motion — respect accessibility preference ===== */
@media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }
    .grid-item:hover img { transform: none; }
    .drift-neighbor:hover { transform: none; box-shadow: none; }
    .glass-tag:hover { transform: none; }
    .compass-arm:hover .compass-arm-img { opacity: 0.35; }
    .face-card:hover { transform: none; box-shadow: none; }
    .map-strip-card:hover { transform: none; box-shadow: none; }
    .nyu-card { transition-duration: 0.01ms !important; }
    .nyu-card-exit, .nyu-card-exit-left { transition-duration: 0.01ms !important; }
    .nyu-mosaic-cell { transition-duration: 0.01ms !important; }
    .nyu-mosaic.assembled { animation-duration: 0.01ms !important; }
    .confetti-cell { transition-duration: 0.01ms !important; }
    .confetti-mosaic.assembled { animation-duration: 0.01ms !important; }
    .confetti-mosaic.scattering .confetti-cell { transition-duration: 0.01ms !important; }
    .confetti-mosaic.floating .confetti-cell { transition-duration: 0.01ms !important; }
    .confetti-preview { transition-duration: 0.01ms !important; }
    .confetti-preview-img { transition-duration: 0.01ms !important; }
}
